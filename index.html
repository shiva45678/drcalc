<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton's AI Medical Calculators</title>
    <style>
        /* --- ROOT VARIABLES --- */
        :root {
            --primary: #20B2AA;
            --primary-dark: #008B8B;
            --secondary: #e9ecef;
            --danger: #dc3545;
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }

        /* --- GLOBAL STYLES --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
             scroll-behavior: smooth; /* Smooth scrolling for any internal links */
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            font-size: 16px; /* Base font size */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* --- GRID & CARDS --- */
        .calculators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .calculator-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: block; /* For search */
        }

        .calculator-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card-header {
            background: var(--primary);
            color: white;
            padding: 12px 15px;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .card-header .number {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .card-body {
            padding: 15px;
            display: none;
        }

        .card-body.active {
            display: block;
            /* Animation for smooth opening */
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* --- FORMS & INPUTS --- */
        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: white;
        }
        select {
             background-image: linear-gradient(45deg, transparent 50%, gray 50%), linear-gradient(135deg, gray 50%, transparent 50%);
             background-position: calc(100% - 20px) calc(1em + 2px), calc(100% - 15px) calc(1em + 2px);
             background-size: 5px 5px, 5px 5px;
             background-repeat: no-repeat;
             padding-right: 30px;
        }
         /* Focus style */
         input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(32, 178, 170, 0.2);
         }


        .row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .col {
            flex: 1;
            min-width: 80px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
            font-weight: 500;
        }

        button:hover {
            background-color: var(--primary-dark);
        }
         button:active {
             transform: scale(0.98); /* Click effect */
         }

        /* --- RESULTS & INTERPRETATION --- */
        .result-box {
            margin-top: 15px;
            padding: 12px;
            background-color: var(--secondary);
            border-radius: 4px;
            display: none;
            border-left: 4px solid var(--primary); /* Accent border */
        }

        .result-box.active {
            display: block;
             animation: fadeInResult 0.4s ease-in-out;
        }

         @keyframes fadeInResult {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        .result-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin-bottom: 8px;
            word-wrap: break-word;
        }
        .result-value.sub-result {
            font-size: 1.1rem; /* Make sub-results slightly smaller */
            margin-top: 10px;
            color: var(--dark);
            font-weight: normal;
             text-align: left; /* Align sub-results left */
             margin-bottom: 3px;
        }


        .result-interpretation {
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-align: center; /* Center main interpretation text */
        }
        .result-interpretation p { /* Target the p inside */
             margin-top: 5px;
        }
         /* Align sub-result interpretation text left */
         .result-value.sub-result + .result-interpretation {
            text-align: left;
         }


        .interpretation-level {
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        .interpretation-level.normal { background-color: var(--success); color: white; }
        .interpretation-level.warning { background-color: var(--warning); color: var(--dark); }
        .interpretation-level.danger { background-color: var(--danger); color: white; }
        .interpretation-level.info { background-color: var(--info); color: white; }

        .note {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px; /* Increased space */
            font-style: italic;
            border-top: 1px solid #ddd; /* Separator line */
            padding-top: 8px;
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            .container {
                padding: 10px; /* Slightly reduce container padding */
            }
            .calculator-search {
                padding: 10px; /* Slightly reduce search padding */
                font-size: 0.95rem;
            }
            .calculators-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .row {
                flex-direction: column;
                gap: 8px; /* Reduce gap for stacked elements */
                margin-bottom: 10px; /* Slightly reduce margin */
            }
             h1 { font-size: 1.8rem; }
            .subtitle { font-size: 1rem; }
             .card-header { font-size: 1rem; padding: 10px 12px; }
             .result-value { font-size: 1.4rem; }
             button { padding: 12px 15px; } /* Slightly larger tap target */
        }

        /* --- Checkbox/Radio --- */
        .checkbox-group, .radio-group {
            margin-bottom: 15px;
            border: 1px solid #eee; /* Add subtle border */
            padding: 10px;
            border-radius: 4px;
        }
         .checkbox-group > label, .radio-group > label { /* Style group labels */
             font-weight: bold;
             margin-bottom: 10px;
             display: block;
             color: var(--primary-dark);
         }
        .checkbox-option, .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer; /* Indicate clickable */
        }
        .checkbox-option input, .radio-option input {
            margin-right: 10px; /* More space */
            flex-shrink: 0;
            width: 1.2em;
            height: 1.2em;
            cursor: pointer;
        }
         .checkbox-option label, .radio-option label {
             margin-bottom: 0;
             font-weight: normal;
             font-size: 0.95rem;
             flex-grow: 1; /* Allow label to take space */
             cursor: pointer;
         }


        /* --- SEARCH & LOGO --- */
        .calculator-search {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        /* --- Error Messages --- */
        .error-message {
            color: var(--danger);
            font-size: 0.85em;
            margin-top: 3px;
            font-weight: 500;
        }

         /* --- GCS Specific Styling --- */
         #gcs-components {
             font-size: 0.95rem;
             color: var(--gray);
             text-align: center;
             margin-top: -5px;
             margin-bottom: 10px;
         }
    </style>
</head>
<body>
<a href="https://dr.newtons.in" target="_blank" style="display: inline-block; padding: 10px 20px; background-color: #f8fafc; color: rgb(10, 10, 10); text-decoration: none; border-radius: 5px; font-family: sans-serif; position: absolute; top: 10px; left: 10px; z-index: 1000;">
  Newtons AI
</a>
    <header>
        <div class="container">
            <h1>Newton's AI Medical Calculators</h1>
            <p class="subtitle">Essential clinical tools</p>
        </div>
    </header>

    <div class="container">
        <input type="text" id="calculatorSearch" class="calculator-search" placeholder="Search calculators by name or keyword...">

        <div class="calculators-grid">

            <!-- 1. BMI Calculator -->
            <div class="calculator-card" data-calculator-name="bmi body mass index bsa body surface area weight obesity">
                <div class="card-header"> <div class="number">1</div> BMI & BSA Calculator </div>
                <div class="card-body">
                     <p>Calculates Body Mass Index (BMI) and Body Surface Area (BSA).</p>
                    <div class="form-group"> <label for="bmi-weight">Weight:</label> <div class="row"> <div class="col"> <input type="number" id="bmi-weight" placeholder="Weight"> </div> <div class="col"> <select id="bmi-weight-unit"> <option value="kg">kg</option> <option value="lb">lb</option> </select> </div> </div> <div class="error-message" id="bmi-weight-error"></div> </div>
                    <div class="form-group"> <label for="bmi-height">Height:</label> <div class="row"> <div class="col"> <input type="number" id="bmi-height" placeholder="Height"> </div> <div class="col"> <select id="bmi-height-unit"> <option value="cm">cm</option> <option value="m">m</option> <option value="in">inches</option> <option value="ft">feet</option> </select> </div> </div> <div class="error-message" id="bmi-height-error"></div> </div>
                    <button id="calculate-bmi">Calculate</button>
                    <div class="result-box" id="bmi-result"> <div class="result-value" id="bmi-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="bmi-level"></div> <p id="bmi-interpretation"></p> </div> <div class="result-value sub-result" id="bsa-value"></div> <div class="result-interpretation"> <p>Body Surface Area (BSA) - Mosteller</p> </div> <div class="note"> Note: BMI may be less accurate in certain populations. </div> </div>
                </div>
            </div>

            <!-- 2. CrCl (Cockcroft-Gault) -->
             <div class="calculator-card" data-calculator-name="creatinine clearance cockcroft gault crcl kidney function renal dosing">
                <div class="card-header"> <div class="number">2</div> CrCl (Cockcroft-Gault) </div>
                <div class="card-body">
                     <p>Estimates creatinine clearance for medication dosing adjustments.</p>
                    <div class="form-group"> <label for="crcl-age">Age (years):</label> <input type="number" id="crcl-age" placeholder="Age"> <div class="error-message" id="crcl-age-error"></div> </div>
                    <div class="form-group"> <label for="crcl-gender">Gender:</label> <select id="crcl-gender"> <option value="male">Male</option> <option value="female">Female</option> </select> </div>
                    <div class="form-group"> <label for="crcl-weight">Weight:</label> <div class="row"> <div class="col"> <input type="number" id="crcl-weight" placeholder="Weight"> </div> <div class="col"> <select id="crcl-weight-unit"> <option value="kg">kg</option> <option value="lb">lb</option> </select> </div> </div> <div class="error-message" id="crcl-weight-error"></div> </div>
                    <div class="form-group"> <label for="crcl-scr">Serum Creatinine:</label> <div class="row"> <div class="col"> <input type="number" id="crcl-scr" placeholder="Serum Creatinine"> </div> <div class="col"> <select id="crcl-scr-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select> </div> </div> <div class="error-message" id="crcl-scr-error"></div> </div>
                    <button id="calculate-crcl">Calculate</button>
                    <div class="result-box" id="crcl-result"> <div class="result-value" id="crcl-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="crcl-level"></div> <p id="crcl-interpretation"></p> </div> <div class="note"> Note: Accuracy may be reduced in certain populations. Consider eGFR (CKD-EPI) for staging. </div> </div>
                </div>
            </div>

            <!-- 3. CHA₂DS₂-VASc -->
            <div class="calculator-card" data-calculator-name="chadsvasc chads vasc atrial fibrillation afib stroke risk anticoagulation">
                <div class="card-header"> <div class="number">3</div> CHA₂DS₂-VASc Score </div>
                <div class="card-body">
                     <p>Assesses stroke risk in atrial fibrillation to guide anticoagulation.</p>
                     <div class="checkbox-group">
                         <label>Select Applicable Conditions:</label>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-chf" value="1"> <label for="chads-chf">CHF/LV dysfunction (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-htn" value="1"> <label for="chads-htn">Hypertension (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-age75" value="2"> <label for="chads-age75">Age ≥ 75 years (2pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-diabetes" value="1"> <label for="chads-diabetes">Diabetes Mellitus (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-stroke" value="2"> <label for="chads-stroke">Stroke/TIA/TE (2pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-vascular" value="1"> <label for="chads-vascular">Vascular Disease (MI, PAD, Plaque) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-age65" value="1"> <label for="chads-age65">Age 65-74 years (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="chads-female" value="1"> <label for="chads-female">Female Sex (1pt)</label> </div>
                    </div>
                     <div class="error-message" id="chads-error"></div>
                    <button id="calculate-chads">Calculate</button>
                    <div class="result-box" id="chads-result"> <div class="result-value" id="chads-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="chads-level"></div> <p id="chads-interpretation"></p> </div> <div class="note"> Note: Consult guidelines for therapy based on score and sex. Consider HAS-BLED for bleeding risk. </div> </div>
                </div>
            </div>

            <!-- 4. CKD-EPI -->
            <div class="calculator-card" data-calculator-name="ckd-epi ckd epi egfr glomerular filtration rate kidney disease renal chronic staging">
                <div class="card-header"> <div class="number">4</div> eGFR (CKD-EPI 2021) </div>
                <div class="card-body">
                     <p>Estimates Glomerular Filtration Rate (eGFR) using the 2021 CKD-EPI race-free equation.</p>
                    <div class="form-group"> <label for="ckd-age">Age (years):</label> <input type="number" id="ckd-age" placeholder="Age"> <div class="error-message" id="ckd-age-error"></div> </div>
                    <div class="form-group"> <label for="ckd-gender">Sex assigned at birth:</label> <select id="ckd-gender"> <option value="male">Male</option> <option value="female">Female</option> </select> </div>
                    <div class="form-group"> <label for="ckd-scr">Serum Creatinine:</label> <div class="row"> <div class="col"> <input type="number" id="ckd-scr" placeholder="Serum Creatinine"> </div> <div class="col"> <select id="ckd-scr-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select> </div> </div> <div class="error-message" id="ckd-scr-error"></div> </div>
                    <button id="calculate-ckd">Calculate</button>
                    <div class="result-box" id="ckd-result"> <div class="result-value" id="ckd-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="ckd-level"></div> <p id="ckd-interpretation"></p> </div> <div class="note"> Note: Uses the CKD-EPI 2021 race-free equation for staging Chronic Kidney Disease. </div> </div>
                </div>
            </div>

            <!-- 5. Wells' DVT -->
             <div class="calculator-card" data-calculator-name="wells dvt deep vein thrombosis clot leg score probability risk stratification">
                <div class="card-header"> <div class="number">5</div> Wells' Score for DVT </div>
                <div class="card-body">
                     <p>Evaluates pretest probability of deep vein thrombosis (DVT).</p>
                     <div class="checkbox-group">
                         <label>Select Applicable Criteria:</label>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-cancer" value="1"> <label for="dvt-cancer">Active cancer (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-paralysis" value="1"> <label for="dvt-paralysis">Paralysis/paresis/cast (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-bedridden" value="1"> <label for="dvt-bedridden">Bedridden >3d / Surgery <12wk (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-tenderness" value="1"> <label for="dvt-tenderness">Localized tenderness (deep vein) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-swelling" value="1"> <label for="dvt-swelling">Entire leg swollen (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-calf" value="1"> <label for="dvt-calf">Calf swelling >3cm (vs other leg) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-pitting" value="1"> <label for="dvt-pitting">Pitting edema (symptomatic leg) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-collateral" value="1"> <label for="dvt-collateral">Collateral superficial veins (non-varicose) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-history" value="1"> <label for="dvt-history">Previous DVT (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="dvt-alternative" value="-2"> <label for="dvt-alternative">Alternative diagnosis likely (-2pts)</label> </div>
                    </div>
                    <button id="calculate-dvt">Calculate</button>
                    <div class="result-box" id="dvt-result"> <div class="result-value" id="dvt-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="dvt-level"></div> <p id="dvt-interpretation"></p> </div> <div class="note"> Note: Use with clinical judgment +/- D-dimer/imaging based on 2-tier risk (Score ≤1 unlikely, ≥2 likely). </div> </div>
                </div>
            </div>

             <!-- 6. Wells' PE -->
             <div class="calculator-card" data-calculator-name="wells pe pulmonary embolism clot lung chest pain shortness breath score probability risk stratification">
                <div class="card-header"> <div class="number">6</div> Wells' Score for PE </div>
                <div class="card-body">
                     <p>Evaluates pretest probability of pulmonary embolism (PE).</p>
                    <div class="checkbox-group">
                         <label>Select Applicable Criteria:</label>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-dvt" value="3"> <label for="pe-dvt">Clinical signs/symptoms of DVT (3pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-alternative" value="3"> <label for="pe-alternative">PE is #1 diagnosis OR equally likely (3pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-tachycardia" value="1.5"> <label for="pe-tachycardia">Heart rate > 100 bpm (1.5pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-immobilization" value="1.5"> <label for="pe-immobilization">Immobilization ≥3d / Surgery <4wk (1.5pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-dvt-history" value="1.5"> <label for="pe-dvt-history">Previous DVT/PE (1.5pts)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-hemoptysis" value="1"> <label for="pe-hemoptysis">Hemoptysis (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="pe-cancer" value="1"> <label for="pe-cancer">Malignancy (active/treatment <6mo/palliative) (1pt)</label> </div>
                    </div>
                    <button id="calculate-pe">Calculate</button>
                    <div class="result-box" id="pe-result"> <div class="result-value" id="pe-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="pe-level"></div> <p id="pe-interpretation"></p> </div> <div class="note"> Note: Use with PERC/D-dimer/imaging based on 2-tier risk (Score ≤4 unlikely, >4 likely). </div> </div>
                </div>
            </div>

            <!-- 7. Anion Gap -->
            <div class="calculator-card" data-calculator-name="anion gap ag metabolic acidosis mudpiles goldmark electrolytes sodium chloride bicarbonate albumin corrected">
                <div class="card-header"> <div class="number">7</div> Serum Anion Gap </div>
                <div class="card-body">
                    <p>Calculates the anion gap, useful in metabolic acidosis.</p>
                    <div class="form-group"> <label for="ag-sodium">Sodium (Na⁺) (mEq/L):</label> <input type="number" id="ag-sodium" placeholder="Na⁺"> <div class="error-message" id="ag-sodium-error"></div> </div>
                    <div class="form-group"> <label for="ag-chloride">Chloride (Cl⁻) (mEq/L):</label> <input type="number" id="ag-chloride" placeholder="Cl⁻"> <div class="error-message" id="ag-chloride-error"></div> </div>
                    <div class="form-group"> <label for="ag-bicarbonate">Bicarbonate (HCO₃⁻) (mEq/L):</label> <input type="number" id="ag-bicarbonate" placeholder="HCO₃⁻"> <div class="error-message" id="ag-bicarbonate-error"></div> </div>
                    <div class="form-group"> <label for="ag-albumin">Albumin (g/dL) (optional):</label> <input type="number" id="ag-albumin" placeholder="Albumin (optional)"> <div class="error-message" id="ag-albumin-error"></div> </div>
                    <button id="calculate-ag">Calculate</button>
                    <div class="result-box" id="ag-result"> <div class="result-value" id="ag-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="ag-level"></div> <p id="ag-interpretation"></p> </div> <div id="ag-corrected-section" style="display: none;"> <div class="result-value sub-result" id="ag-corrected-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="ag-corrected-level"></div> <p id="ag-corrected-interpretation"></p> <p>Albumin-Corrected AG</p> </div> </div> <div class="note"> Note: Normal range ~3-11 mEq/L. Correction recommended if albumin abnormal. </div> </div>
                </div>
            </div>

            <!-- 8. QTc -->
             <div class="calculator-card" data-calculator-name="qtc corrected qt interval ecg ekg electrocardiogram arrhythmia torsades bazett fridericia hodges framingham heart rate rr">
                <div class="card-header"> <div class="number">8</div> Corrected QT (QTc) </div>
                <div class="card-body">
                     <p>Calculates corrected QT interval for arrhythmia risk assessment.</p>
                    <div class="form-group"> <label for="qt-interval">QT Interval (ms):</label> <input type="number" id="qt-interval" placeholder="QT (ms)"> <div class="error-message" id="qt-interval-error"></div> </div>
                    <div class="form-group"> <label for="qt-rr-hr">Input Value:</label> <input type="number" id="qt-rr-hr" placeholder="Value"> <div class="error-message" id="qt-rr-hr-error"></div> </div>
                    <div class="form-group"> <label for="qt-input-type">Input Type:</label> <select id="qt-input-type"> <option value="rr">RR Interval (ms)</option> <option value="hr">Heart Rate (bpm)</option> </select> </div>
                    <div class="form-group"> <label for="qt-formula">Formula:</label> <select id="qt-formula"> <option value="bazett">Bazett</option> <option value="fridericia">Fridericia</option> <option value="framingham">Framingham</option> <option value="hodges">Hodges</option> </select> </div>
                    <button id="calculate-qtc">Calculate</button>
                    <div class="result-box" id="qtc-result"> <div class="result-value" id="qtc-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="qtc-level"></div> <p id="qtc-interpretation"></p> </div> <div class="note"> Note: Normal ranges vary. >450(M)/460(F) ms often prolonged, >500 ms high risk. Formula choice matters at extremes of HR. </div> </div>
                </div>
            </div>

            <!-- 9. Sodium Correction for Hyperglycemia -->
             <div class="calculator-card" data-calculator-name="sodium correction hyperglycemia glucose sugar diabetes electrolytes na corrected na dka hhs">
                 <div class="card-header"> <div class="number">9</div> Sodium Correction (Hyperglycemia) </div>
                 <div class="card-body">
                    <p>Adjusts serum sodium level for the effect of high blood glucose.</p>
                     <div class="form-group"> <label for="na-measured">Measured Serum Sodium (mEq/L):</label> <input type="number" id="na-measured" placeholder="Measured Na⁺"> <div class="error-message" id="na-measured-error"></div> </div>
                     <div class="form-group"> <label for="na-glucose">Serum Glucose:</label> <div class="row"> <div class="col"> <input type="number" id="na-glucose" placeholder="Glucose"> </div> <div class="col"> <select id="na-glucose-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select> </div> </div> <div class="error-message" id="na-glucose-error"></div> </div>
                     <button id="calculate-na-corrected">Calculate</button>
                     <div class="result-box" id="na-corrected-result"> <div class="result-value" id="na-corrected-value"></div> <div class="result-interpretation"> <p>Corrected Sodium (Katz Formula)</p> </div> <div class="note"> Note: Adds 1.6 mEq/L Na⁺ for every 100 mg/dL glucose over 100 mg/dL. Reflects true sodium status assuming hyperglycemia is corrected. </div> </div>
                 </div>
             </div>

            <!-- 10. Maintenance Fluids -->
             <div class="calculator-card" data-calculator-name="maintenance fluids iv fluids holliday segar dehydration hydration pediatrics weight volume rate">
                <div class="card-header"> <div class="number">10</div> Maintenance Fluids (Holliday-Segar) </div>
                <div class="card-body">
                    <p>Estimates daily maintenance fluid requirement based on weight.</p>
                     <div class="form-group"> <label for="fluids-weight">Weight:</label> <div class="row"> <div class="col"> <input type="number" id="fluids-weight" placeholder="Weight"> </div> <div class="col"> <select id="fluids-weight-unit"> <option value="kg">kg</option> <option value="lb">lb</option> </select> </div> </div> <div class="error-message" id="fluids-weight-error"></div> </div>
                     <button id="calculate-fluids">Calculate</button>
                     <div class="result-box" id="fluids-result"> <div class="result-value" id="fluids-daily-value"></div> <div class="result-interpretation"> <p>Total Daily Fluid (mL/day)</p> </div> <div class="result-value sub-result" id="fluids-hourly-value"></div> <div class="result-interpretation"> <p>Approximate Hourly Rate (mL/hr)</p> </div> <div class="note"> Note: Holliday-Segar method (100/50/20 rule per kg). Adjust based on clinical status (fever, losses, etc.). Capped at ~2400 mL/day. </div> </div>
                 </div>
             </div>

            <!-- 11. Ideal/Adjusted Body Weight -->
             <div class="calculator-card" data-calculator-name="ideal body weight ibw adjusted body weight abw dosing nutrition height gender devine bmi obesity">
                 <div class="card-header"> <div class="number">11</div> Ideal & Adjusted Body Weight </div>
                 <div class="card-body">
                     <p>Calculates Ideal Body Weight (IBW) and Adjusted Body Weight (ABW) for dosing or nutrition.</p>
                     <div class="form-group"> <label for="ibw-height">Height:</label> <div class="row"> <div class="col"> <input type="number" id="ibw-height" placeholder="Height"> </div> <div class="col"> <select id="ibw-height-unit"> <option value="cm">cm</option> <option value="in">inches</option> </select> </div> </div> <div class="error-message" id="ibw-height-error"></div> </div>
                     <div class="form-group"> <label for="ibw-gender">Gender:</label> <select id="ibw-gender"> <option value="male">Male</option> <option value="female">Female</option> </select> </div>
                      <div class="form-group"> <label for="ibw-actual-weight">Actual Weight (for ABW):</label> <div class="row"> <div class="col"> <input type="number" id="ibw-actual-weight" placeholder="Actual Weight (optional)"> </div> <div class="col"> <select id="ibw-actual-weight-unit"> <option value="kg">kg</option> <option value="lb">lb</option> </select> </div> </div> <div class="error-message" id="ibw-actual-weight-error"></div> </div>
                     <button id="calculate-ibw-abw">Calculate</button>
                     <div class="result-box" id="ibw-abw-result"> <div class="result-value" id="ibw-value"></div> <div class="result-interpretation"> <p>Ideal Body Weight (IBW) - Devine</p> </div> <div id="abw-section" style="display: none;"> <div class="result-value sub-result" id="abw-value"></div> <div class="result-interpretation"> <p>Adjusted Body Weight (ABW)</p> </div> </div> <div class="note"> Note: Devine formula (requires height ≥ 60 in). ABW = IBW + 0.4 * (Actual - IBW). Used for some drug dosing. </div> </div>
                 </div>
             </div>

             <!-- 12. LDL Calculated -->
             <div class="calculator-card" data-calculator-name="ldl calculated low density lipoprotein cholesterol lipids cardiovascular risk friedewald hdl triglycerides tc">
                <div class="card-header"> <div class="number">12</div> LDL Cholesterol (Calculated) </div>
                <div class="card-body">
                    <p>Estimates LDL cholesterol using the Friedewald equation.</p>
                     <div class="form-group"> <label for="ldl-tc">Total Cholesterol:</label> <input type="number" id="ldl-tc" placeholder="Total Cholesterol"> <div class="error-message" id="ldl-tc-error"></div> </div>
                     <div class="form-group"> <label for="ldl-hdl">HDL Cholesterol:</label> <input type="number" id="ldl-hdl" placeholder="HDL Cholesterol"> <div class="error-message" id="ldl-hdl-error"></div> </div>
                     <div class="form-group"> <label for="ldl-tg">Triglycerides:</label> <input type="number" id="ldl-tg" placeholder="Triglycerides"> <div class="error-message" id="ldl-tg-error"></div> </div>
                     <div class="form-group"> <label for="ldl-unit">Units:</label> <select id="ldl-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select> </div>
                    <button id="calculate-ldl">Calculate</button>
                    <div class="result-box" id="ldl-result"> <div class="result-value" id="ldl-value"></div> <div class="result-interpretation"> <p>Calculated LDL Cholesterol</p> </div> <div id="ldl-warning" class="error-message" style="display: none; text-align: center;"></div> <div class="note"> Note: Friedewald: LDL = TC - HDL - (TG/Divisor). Invalid if TG > 400 mg/dL (4.5 mmol/L) or non-fasting. </div> </div>
                </div>
            </div>

            <!-- 13. Centor Score -->
            <div class="calculator-card" data-calculator-name="centor score mcisaac sore throat pharyngitis strep throat streptococcus antibiotics tonsillitis fever cough">
                <div class="card-header"> <div class="number">13</div> Centor Score (Modified/McIsaac) </div>
                <div class="card-body">
                    <p>Estimates probability of Group A Strep pharyngitis to guide testing/treatment.</p>
                    <div class="checkbox-group">
                        <label>Clinical Criteria:</label>
                        <div class="checkbox-option"> <input type="checkbox" id="centor-temp" value="1"> <label for="centor-temp">Fever (>38°C / 100.4°F) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="centor-no-cough" value="1"> <label for="centor-no-cough">Absence of Cough (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="centor-nodes" value="1"> <label for="centor-nodes">Tender Anterior Cervical Lymphadenopathy (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="centor-exudate" value="1"> <label for="centor-exudate">Tonsillar Swelling or Exudates (1pt)</label> </div>
                    </div>
                     <div class="form-group"> <label for="centor-age">Age Group:</label> <select id="centor-age"> <option value="1">3-14 years (+1 pt)</option> <option value="0">15-44 years (0 pts)</option> <option value="-1">≥ 45 years (-1 pt)</option> </select> </div>
                    <button id="calculate-centor">Calculate</button>
                    <div class="result-box" id="centor-result"> <div class="result-value" id="centor-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="centor-level"></div> <p id="centor-interpretation"></p> </div> <div class="note"> Note: Score guides management (no test, test, empiric treatment). Consult local guidelines. </div> </div>
                </div>
            </div>

            <!-- 14. HAS-BLED Score -->
            <div class="calculator-card" data-calculator-name="has-bled hasbled bleeding risk anticoagulation atrial fibrillation afib warfarin doac noac hemorrhage stroke">
                <div class="card-header"> <div class="number">14</div> HAS-BLED Score </div>
                <div class="card-body">
                    <p>Estimates 1-year risk of major bleeding in patients on anticoagulation for AFib.</p>
                     <div class="checkbox-group">
                          <label>Select Applicable Risk Factors:</label>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-htn" value="1"> <label for="hasbled-htn">Hypertension (uncontrolled SBP >160) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-renal" value="1"> <label for="hasbled-renal">Abnormal Renal Fxn (dialysis, transplant, Cr >2.26/>200) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-liver" value="1"> <label for="hasbled-liver">Abnormal Liver Fxn (cirrhosis, Bili >2x ULN + Enz >3x ULN) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-stroke" value="1"> <label for="hasbled-stroke">Stroke history (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-bleeding" value="1"> <label for="hasbled-bleeding">Bleeding history or predisposition (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-inr" value="1"> <label for="hasbled-inr">Labile INR (TTR < 60% on warfarin) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-age" value="1"> <label for="hasbled-age">Elderly (Age > 65 years) (1pt)</label> </div>
                        <div class="checkbox-option"> <input type="checkbox" id="hasbled-drugs" value="1"> <label for="hasbled-drugs">Drugs (concomitant NSAIDs, antiplatelets) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="hasbled-alcohol" value="1"> <label for="hasbled-alcohol">Alcohol (≥ 8 drinks/week) (1pt)</label> </div>
                    </div>
                    <button id="calculate-hasbled">Calculate</button>
                    <div class="result-box" id="hasbled-result"> <div class="result-value" id="hasbled-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="hasbled-level"></div> <p id="hasbled-interpretation"></p> </div> <div class="note"> Note: Score ≥ 3 indicates high risk. Address modifiable risk factors. Does not preclude anticoagulation if indicated by CHA₂DS₂-VASc. </div> </div>
                </div>
            </div>

             <!-- 15. Free Water Deficit -->
             <div class="calculator-card" data-calculator-name="free water deficit fwd hypernatremia dehydration fluid management sodium electrolytes tbw serum na replacement">
                <div class="card-header"> <div class="number">15</div> Free Water Deficit </div>
                <div class="card-body">
                    <p>Estimates the amount of free water needed to correct hypernatremia.</p>
                    <div class="form-group"> <label for="fwd-current-na">Current Serum Sodium (mEq/L):</label> <input type="number" id="fwd-current-na" placeholder="Current Na⁺"> <div class="error-message" id="fwd-current-na-error"></div> </div>
                    <div class="form-group"> <label for="fwd-target-na">Target Serum Sodium (mEq/L):</label> <input type="number" id="fwd-target-na" value="140" placeholder="Target Na⁺ (e.g., 140)"> <div class="error-message" id="fwd-target-na-error"></div> </div>
                    <div class="form-group"> <label for="fwd-weight">Weight:</label> <div class="row"> <div class="col"> <input type="number" id="fwd-weight" placeholder="Weight"> </div> <div class="col"> <select id="fwd-weight-unit"> <option value="kg">kg</option> <option value="lb">lb</option> </select> </div> </div> <div class="error-message" id="fwd-weight-error"></div> </div>
                     <div class="form-group"> <label for="fwd-tbw-factor">Total Body Water % (Estimate):</label> <select id="fwd-tbw-factor"> <option value="0.6">0.6 (Adult Male < 65)</option> <option value="0.5">0.5 (Adult Female < 65 / Elderly Male ≥ 65)</option> <option value="0.45">0.45 (Elderly Female ≥ 65)</option> <option value="0.55">0.55 (General Adult Estimate)</option> </select> </div>
                    <button id="calculate-fwd">Calculate</button>
                    <div class="result-box" id="fwd-result"> <div class="result-value" id="fwd-value"></div> <div class="result-interpretation"> <p>Estimated Free Water Deficit (Liters)</p> </div> <div class="note"> Note: FWD = TBW x [(Current Na / Target Na) - 1]. Replace deficit slowly (e.g., ≤ 10-12 mEq/L Na⁺ correction per 24h) monitoring Na⁺ closely. Consider ongoing losses. </div> </div>
                </div>
            </div>

             <!-- 16. Serum Osmolality -->
             <div class="calculator-card" data-calculator-name="serum osmolality osmolarity electrolytes sodium glucose bun urea gap confusion toxin alcohol ethanol calculated osmolar">
                 <div class="card-header"> <div class="number">16</div> Serum Osmolality (Calculated) </div>
                 <div class="card-body">
                     <p>Calculates serum osmolality, useful in evaluating hyponatremia, toxins, etc.</p>
                     <div class="form-group"> <label for="osm-na">Sodium (Na⁺) (mEq/L):</label> <input type="number" id="osm-na" placeholder="Na⁺"> <div class="error-message" id="osm-na-error"></div> </div>
                     <div class="form-group"> <label for="osm-glucose">Glucose:</label> <div class="row"> <div class="col"><input type="number" id="osm-glucose" placeholder="Glucose"></div> <div class="col"><select id="osm-glucose-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select> </div> </div> <div class="error-message" id="osm-glucose-error"></div> </div>
                     <div class="form-group"> <label for="osm-bun">BUN / Urea:</label> <div class="row"> <div class="col"><input type="number" id="osm-bun" placeholder="BUN or Urea"></div> <div class="col"><select id="osm-bun-unit"> <option value="mg/dL-bun">BUN (mg/dL)</option> <option value="mmol/L-urea">Urea (mmol/L)</option> <option value="mg/dL-urea">Urea (mg/dL)</option></select> </div> </div> <div class="error-message" id="osm-bun-error"></div> </div>
                      <div class="form-group"> <label for="osm-ethanol">Ethanol (mg/dL) (Optional):</label> <input type="number" id="osm-ethanol" placeholder="Ethanol (optional)"> <div class="error-message" id="osm-ethanol-error"></div> </div>
                     <button id="calculate-osm">Calculate</button>
                     <div class="result-box" id="osm-result"> <div class="result-value" id="osm-calc-value"></div> <div class="result-interpretation"> <p>Calculated Osmolality (mOsm/kg)</p> </div> <div class="note"> Note: Formula: 2*Na + Gluc(mg/dL)/18 + BUN(mg/dL)/2.8 (+ EtOH(mg/dL)/4.6 if provided). Normal ~275-295 mOsm/kg. Compare with measured osmolality for Osm Gap (>10-15 suggests unmeasured osmoles). </div> </div>
                 </div>
             </div>

             <!-- 17. Calcium Correction for Hypoalbuminemia (NEW) -->
             <div class="calculator-card" data-calculator-name="calcium correction albumin hypoalbuminemia corrected calcium ca electrolytes bone metabolism">
                 <div class="card-header"> <div class="number">17</div> Calcium Correction (Albumin) </div>
                 <div class="card-body">
                     <p>Adjusts total serum calcium for low albumin levels.</p>
                     <div class="form-group">
                         <label for="ca-measured">Measured Total Calcium:</label>
                         <div class="row">
                             <div class="col"> <input type="number" id="ca-measured" placeholder="Measured Ca"> </div>
                             <div class="col"> <select id="ca-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select> </div>
                         </div>
                         <div class="error-message" id="ca-measured-error"></div>
                     </div>
                     <div class="form-group">
                         <label for="ca-albumin">Serum Albumin:</label>
                         <div class="row">
                             <div class="col"> <input type="number" id="ca-albumin" placeholder="Albumin"> </div>
                             <div class="col"> <select id="ca-albumin-unit"> <option value="g/dL">g/dL</option> <option value="g/L">g/L</option> </select> </div>
                         </div>
                         <div class="error-message" id="ca-albumin-error"></div>
                     </div>
                     <button id="calculate-ca-corrected">Calculate</button>
                     <div class="result-box" id="ca-corrected-result">
                         <div class="result-value" id="ca-corrected-value"></div>
                         <div class="result-interpretation">
                             <div class="interpretation-level" id="ca-level"></div>
                             <p id="ca-interpretation">Corrected Total Calcium</p>
                         </div>
                         <div class="note"> Note: Formula: Corrected Ca (mg/dL) = Measured Ca (mg/dL) + 0.8 * (4.0 - Albumin (g/dL)). Estimates physiologically active calcium. Ionized calcium is the gold standard if available. </div>
                     </div>
                 </div>
             </div>

            <!-- 18. Glasgow Coma Scale (GCS) (NEW) -->
             <div class="calculator-card" data-calculator-name="glasgow coma scale gcs consciousness trauma head injury neurology score neurological assessment eye verbal motor">
                 <div class="card-header"> <div class="number">18</div> Glasgow Coma Scale (GCS) </div>
                 <div class="card-body">
                     <p>Assesses level of consciousness after head injury or in altered mental status.</p>
                     <div class="form-group">
                         <label for="gcs-eye">Eye Opening Response (E):</label>
                         <select id="gcs-eye">
                             <option value="4">4 - Spontaneous</option>
                             <option value="3">3 - To voice</option>
                             <option value="2">2 - To pain</option>
                             <option value="1">1 - None</option>
                         </select>
                     </div>
                     <div class="form-group">
                         <label for="gcs-verbal">Verbal Response (V):</label>
                         <select id="gcs-verbal">
                             <option value="5">5 - Oriented</option>
                             <option value="4">4 - Confused</option>
                             <option value="3">3 - Inappropriate words</option>
                             <option value="2">2 - Incomprehensible sounds</option>
                             <option value="1">1 - None</option>
                              <option value="0">T - Intubated (assign 1 for score, note 'T')</option>
                         </select>
                     </div>
                     <div class="form-group">
                         <label for="gcs-motor">Motor Response (M):</label>
                         <select id="gcs-motor">
                             <option value="6">6 - Obeys commands</option>
                             <option value="5">5 - Localizes pain</option>
                             <option value="4">4 - Withdraws from pain</option>
                             <option value="3">3 - Flexion to pain (decorticate)</option>
                             <option value="2">2 - Extension to pain (decerebrate)</option>
                             <option value="1">1 - None</option>
                         </select>
                     </div>
                     <button id="calculate-gcs">Calculate</button>
                     <div class="result-box" id="gcs-result">
                         <div class="result-value" id="gcs-value"></div>
                         <div id="gcs-components"></div>
                         <div class="result-interpretation">
                            <div class="interpretation-level" id="gcs-level"></div>
                            <p id="gcs-interpretation">Injury Severity</p>
                         </div>
                         <div class="note"> Note: Score ranges from 3 (deep coma) to 15 (fully awake). If intubated (T), verbal score is not assessable but often assigned 1 for total score calculation. </div>
                     </div>
                 </div>
             </div>

             <!-- 19. Alvarado Score (Previously 17) -->
             <div class="calculator-card" data-calculator-name="alvarado score appendicitis abdominal pain rlq mantrels diagnosis surgery">
                 <div class="card-header"> <div class="number">19</div> Alvarado Score for Appendicitis </div>
                 <div class="card-body">
                     <p>Clinical score to aid in diagnosis of acute appendicitis.</p>
                     <div class="checkbox-group"> <label>Symptoms (1 point each):</label> <div class="checkbox-option"> <input type="checkbox" id="alv-migratory" value="1"> <label for="alv-migratory">Migratory RLQ Pain</label> </div> <div class="checkbox-option"> <input type="checkbox" id="alv-anorexia" value="1"> <label for="alv-anorexia">Anorexia</label> </div> <div class="checkbox-option"> <input type="checkbox" id="alv-nausea" value="1"> <label for="alv-nausea">Nausea/Vomiting</label> </div> </div>
                     <div class="checkbox-group"> <label>Signs:</label> <div class="checkbox-option"> <input type="checkbox" id="alv-rlq-tender" value="2"> <label for="alv-rlq-tender">RLQ Tenderness (2 pts)</label> </div> <div class="checkbox-option"> <input type="checkbox" id="alv-rebound" value="1"> <label for="alv-rebound">Rebound Tenderness (1 pt)</label> </div> <div class="checkbox-option"> <input type="checkbox" id="alv-fever" value="1"> <label for="alv-fever">Elevated Temperature (>37.3°C / 99.1°F) (1 pt)</label> </div> </div>
                     <div class="checkbox-group"> <label>Laboratory:</label> <div class="checkbox-option"> <input type="checkbox" id="alv-leukocytosis" value="2"> <label for="alv-leukocytosis">Leukocytosis (>10,000/mm³) (2 pts)</label> </div> <div class="checkbox-option"> <input type="checkbox" id="alv-left-shift" value="1"> <label for="alv-left-shift">Neutrophil Left Shift (>75%) (1 pt)</label> </div> </div>
                     <button id="calculate-alvarado">Calculate</button>
                     <div class="result-box" id="alvarado-result"> <div class="result-value" id="alvarado-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="alvarado-level"></div> <p id="alvarado-interpretation"></p> </div> <div class="note"> Note: Score ≤ 4 unlikely, 5-6 possible, ≥ 7 probable appendicitis. Clinical judgment and imaging often required. </div> </div>
                 </div>
             </div>

             <!-- 20. Light's Criteria (Previously 18) -->
             <div class="calculator-card" data-calculator-name="light's criteria lights pleural effusion fluid exudate transudate protein ldh thoracentesis pulmonology ratio">
                 <div class="card-header"> <div class="number">20</div> Light's Criteria for Pleural Effusion </div>
                 <div class="card-body">
                     <p>Differentiates between exudative and transudative pleural effusions.</p>
                     <div class="form-group"> <label for="light-pf-prot">Pleural Fluid Protein (g/dL):</label> <input type="number" id="light-pf-prot" placeholder="PF Protein"> <div class="error-message" id="light-pf-prot-error"></div> </div>
                      <div class="form-group"> <label for="light-serum-prot">Serum Protein (g/dL):</label> <input type="number" id="light-serum-prot" placeholder="Serum Protein"> <div class="error-message" id="light-serum-prot-error"></div> </div>
                     <div class="form-group"> <label for="light-pf-ldh">Pleural Fluid LDH (IU/L):</label> <input type="number" id="light-pf-ldh" placeholder="PF LDH"> <div class="error-message" id="light-pf-ldh-error"></div> </div>
                     <div class="form-group"> <label for="light-serum-ldh">Serum LDH (IU/L):</label> <input type="number" id="light-serum-ldh" placeholder="Serum LDH"> <div class="error-message" id="light-serum-ldh-error"></div> </div>
                      <div class="form-group"> <label for="light-serum-ldh-uln">Serum LDH Upper Limit of Normal (IU/L):</label> <input type="number" id="light-serum-ldh-uln" placeholder="Serum LDH ULN"> <div class="error-message" id="light-serum-ldh-uln-error"></div> </div>
                     <button id="calculate-light">Calculate</button>
                     <div class="result-box" id="light-result"> <div class="result-value" id="light-criteria-met"></div> <div class="result-interpretation"> <div class="interpretation-level" id="light-level"></div> <p id="light-interpretation"></p> </div> <div class="result-value sub-result" id="light-ratio-prot"></div> <div class="result-value sub-result" id="light-ratio-ldh"></div> <div class="result-value sub-result" id="light-ratio-ldh-uln"></div> <div class="note"> Note: Exudate if ANY are met: PF/Serum Prot > 0.5, PF/Serum LDH > 0.6, OR PF LDH > 2/3 Serum LDH ULN. Otherwise, transudate. </div> </div>
                 </div>
             </div>

             <!-- 21. Mean Arterial Pressure (MAP) -->
             <div class="calculator-card" data-calculator-name="map mean arterial pressure blood pressure sbp dbp hemodynamics perfusion">
                 <div class="card-header"> <div class="number">21</div> Mean Arterial Pressure (MAP) </div>
                 <div class="card-body">
                     <p>Calculates Mean Arterial Pressure (MAP) from systolic and diastolic blood pressure.</p>
                     <div class="form-group"> <label for="map-sbp">Systolic BP (mmHg):</label> <input type="number" id="map-sbp" placeholder="SBP"> <div class="error-message" id="map-sbp-error"></div> </div>
                     <div class="form-group"> <label for="map-dbp">Diastolic BP (mmHg):</label> <input type="number" id="map-dbp" placeholder="DBP"> <div class="error-message" id="map-dbp-error"></div> </div>
                     <button id="calculate-map">Calculate</button>
                     <div class="result-box" id="map-result"> <div class="result-value" id="map-value"></div> <div class="result-interpretation"> <p>Mean Arterial Pressure (mmHg)</p> </div> <div class="note"> Note: MAP = DBP + 1/3 * (SBP - DBP). Target MAP often > 65 mmHg for adequate organ perfusion. </div> </div>
                 </div>
             </div>

             <!-- 22. MDRD GFR Equation -->
             <div class="calculator-card" data-calculator-name="mdrd gfr glomerular filtration rate kidney disease renal chronic staging creatinine age race black african american">
                 <div class="card-header"> <div class="number">22</div> eGFR (MDRD) </div>
                 <div class="card-body">
                     <p>Estimates GFR using the original MDRD Study equation.</p>
                     <div class="form-group"> <label for="mdrd-scr">Serum Creatinine:</label> <div class="row"> <div class="col"> <input type="number" id="mdrd-scr" placeholder="Serum Creatinine"> </div> <div class="col"> <select id="mdrd-scr-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select> </div> </div> <div class="error-message" id="mdrd-scr-error"></div> </div>
                     <div class="form-group"> <label for="mdrd-age">Age (years):</label> <input type="number" id="mdrd-age" placeholder="Age"> <div class="error-message" id="mdrd-age-error"></div> </div>
                     <div class="form-group"> <label for="mdrd-gender">Gender:</label> <select id="mdrd-gender"> <option value="male">Male</option> <option value="female">Female</option> </select> </div>
                     <div class="form-group"> <label for="mdrd-race">Race:</label> <select id="mdrd-race"> <option value="nonblack">Non-Black</option> <option value="black">Black/African American</option> </select> </div>
                     <button id="calculate-mdrd">Calculate</button>
                     <div class="result-box" id="mdrd-result"> <div class="result-value" id="mdrd-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="mdrd-level"></div> <p id="mdrd-interpretation"></p> </div> <div class="note"> Note: MDRD equation is less accurate > 60 mL/min/1.73m². CKD-EPI is generally preferred. </div> </div>
                 </div>
             </div>

             <!-- 23. Fractional Excretion of Sodium (FENa) -->
             <div class="calculator-card" data-calculator-name="fena fractional excretion sodium kidney failure aki acute injury prerenal intrinsic renal urine electrolytes creatinine">
                 <div class="card-header"> <div class="number">23</div> Fractional Excretion of Na (FENa) </div>
                 <div class="card-body">
                     <p>Helps differentiate prerenal AKI from intrinsic AKI (ATN).</p>
                     <div class="form-group"> <label for="fena-una">Urine Sodium (mEq/L):</label> <input type="number" id="fena-una" placeholder="Urine Na⁺"> <div class="error-message" id="fena-una-error"></div> </div>
                     <div class="form-group"> <label for="fena-pna">Plasma/Serum Sodium (mEq/L):</label> <input type="number" id="fena-pna" placeholder="Plasma Na⁺"> <div class="error-message" id="fena-pna-error"></div> </div>
                     <div class="form-group"> <label for="fena-ucr">Urine Creatinine:</label> <div class="row"> <div class="col"> <input type="number" id="fena-ucr" placeholder="Urine Cr"> </div> <div class="col"> <select id="fena-cr-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select> </div> </div> <div class="error-message" id="fena-ucr-error"></div> </div>
                     <div class="form-group"> <label for="fena-pcr">Plasma/Serum Creatinine:</label> <input type="number" id="fena-pcr" placeholder="Plasma Cr (same units as Urine Cr)"> <div class="error-message" id="fena-pcr-error"></div> </div>
                     <button id="calculate-fena">Calculate</button>
                     <div class="result-box" id="fena-result"> <div class="result-value" id="fena-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="fena-level"></div> <p id="fena-interpretation"></p> </div> <div class="note"> Note: FENa = (U<sub>Na</sub> * P<sub>Cr</sub>) / (P<sub>Na</sub> * U<sub>Cr</sub>) * 100. <1% suggests prerenal, >2% suggests ATN. Less reliable with diuretics. </div> </div>
                 </div>
             </div>

             <!-- 24. FIB-4 Index -->
             <div class="calculator-card" data-calculator-name="fib-4 fib4 fibrosis liver scarring cirrhosis hepatitis c hcv hbv ast alt platelets age noninvasive">
                 <div class="card-header"> <div class="number">24</div> FIB-4 Index for Liver Fibrosis </div>
                 <div class="card-body">
                     <p>Estimates liver fibrosis severity in chronic liver disease (e.g., HCV, HBV, NAFLD).</p>
                     <div class="form-group"> <label for="fib4-age">Age (years):</label> <input type="number" id="fib4-age" placeholder="Age"> <div class="error-message" id="fib4-age-error"></div> </div>
                     <div class="form-group"> <label for="fib4-ast">AST (IU/L):</label> <input type="number" id="fib4-ast" placeholder="AST"> <div class="error-message" id="fib4-ast-error"></div> </div>
                     <div class="form-group"> <label for="fib4-plt">Platelet Count (x10⁹/L or K/µL):</label> <input type="number" id="fib4-plt" placeholder="Platelets (e.g., 150)"> <div class="error-message" id="fib4-plt-error"></div> </div>
                     <div class="form-group"> <label for="fib4-alt">ALT (IU/L):</label> <input type="number" id="fib4-alt" placeholder="ALT"> <div class="error-message" id="fib4-alt-error"></div> </div>
                     <button id="calculate-fib4">Calculate</button>
                     <div class="result-box" id="fib4-result"> <div class="result-value" id="fib4-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="fib4-level"></div> <p id="fib4-interpretation"></p> </div> <div class="note"> Note: FIB-4 = (Age * AST) / (Platelets * √ALT). <1.45 low risk advanced fibrosis, >3.25 high risk. Intermediate requires further eval. Cutoffs may vary. </div> </div>
                 </div>
             </div>

             <!-- 25. ABCD² Score -->
             <div class="calculator-card" data-calculator-name="abcd2 abcd score tia transient ischemic attack stroke risk neurology prediction">
                 <div class="card-header"> <div class="number">25</div> ABCD² Score for TIA Risk </div>
                 <div class="card-body">
                     <p>Estimates short-term stroke risk after a Transient Ischemic Attack (TIA).</p>
                     <div class="checkbox-group"> <label>Criteria:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="abcd2-age" value="1"> <label for="abcd2-age">Age ≥ 60 years (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="abcd2-bp" value="1"> <label for="abcd2-bp">Blood Pressure ≥ 140/90 mmHg (1pt)</label> </div>
                     </div>
                     <div class="form-group"> <label for="abcd2-clinical">Clinical Features:</label> <select id="abcd2-clinical"> <option value="2">Unilateral weakness (2pts)</option> <option value="1">Speech disturbance without weakness (1pt)</option> <option value="0">Other symptoms (0pts)</option> </select> </div>
                     <div class="form-group"> <label for="abcd2-duration">Duration of Symptoms:</label> <select id="abcd2-duration"> <option value="2">≥ 60 minutes (2pts)</option> <option value="1">10-59 minutes (1pt)</option> <option value="0">< 10 minutes (0pts)</option> </select> </div>
                     <div class="checkbox-group"> <div class="checkbox-option"> <input type="checkbox" id="abcd2-diabetes" value="1"> <label for="abcd2-diabetes">Diabetes Mellitus history (1pt)</label> </div> </div>
                     <button id="calculate-abcd2">Calculate</button>
                     <div class="result-box" id="abcd2-result"> <div class="result-value" id="abcd2-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="abcd2-level"></div> <p id="abcd2-interpretation"></p> </div> <div class="note"> Note: Score predicts 2-day stroke risk: 0-3 (Low ~1%), 4-5 (Moderate ~4%), 6-7 (High ~8%). Guides urgency of evaluation/admission. </div> </div>
                 </div>
             </div>

             <!-- 26. Morphine Milligram Equivalents (MME) -->
             <div class="calculator-card" data-calculator-name="mme morphine milligram equivalents opioid conversion pain management chronic pain dose calculator hydrocodone oxycodone fentanyl hydromorphone methadone buprenorphine tramadol codeine">
                 <div class="card-header"> <div class="number">26</div> Morphine Milligram Equivalents (MME) </div>
                 <div class="card-body">
                     <p>Calculates total daily opioid dose in MME. Add each opioid separately.</p>
                     <div id="mme-entries">
                         <div class="mme-entry">
                             <div class="form-group">
                                 <label>Opioid:</label>
                                 <select class="mme-opioid">
                                     <option value="0">-- Select Opioid --</option>
                                     <option value="1">Codeine</option>
                                     <option value="1.5">Tramadol</option>
                                     <option value="1">Hydrocodone</option>
                                     <option value="1.5">Oxycodone</option>
                                     <option value="1">Morphine (Oral)</option>
                                     <option value="4">Hydromorphone (Oral)</option>
                                     <option value="7.2">Oxymorphone (Oral)</option>
                                     <option value="2.4">Fentanyl (Transdermal mcg/hr)</option> <!-- Special handling -->
                                     <option value="4">Methadone 1-20mg/day</option>
                                     <option value="8">Methadone 21-40mg/day</option>
                                     <option value="10">Methadone 41-60mg/day</option>
                                     <option value="12">Methadone 61-80mg/day</option>
                                     <!-- Add others as needed -->
                                 </select>
                             </div>
                             <div class="form-group">
                                 <label>Daily Dose (mg, or mcg/hr for Fentanyl patch):</label>
                                 <input type="number" class="mme-dose" placeholder="Dose">
                             </div>
                             <button type="button" class="mme-remove-entry" style="width:auto; background-color: var(--gray); margin-top: 0; margin-bottom: 10px;">Remove</button>
                             <hr style="margin-bottom: 10px;">
                         </div>
                     </div>
                     <button type="button" id="mme-add-entry" style="background-color: var(--info); margin-bottom: 10px;">Add Another Opioid</button>
                     <button id="calculate-mme">Calculate Total MME</button>
                     <div class="result-box" id="mme-result">
                         <div class="result-value" id="mme-value"></div>
                         <div class="result-interpretation">
                             <div class="interpretation-level" id="mme-level"></div>
                             <p id="mme-interpretation">Total Daily MME</p>
                         </div>
                         <div class="note"> Note: CDC Guideline: Use caution ≥50 MME/day, avoid ≥90 MME/day. Conversions are estimates and require clinical judgment, especially for methadone/fentanyl. Patch conversion: (mcg/hr * 2.4). </div>
                     </div>
                 </div>
             </div>

             <!-- 27. Steroid Conversion -->
             <div class="calculator-card" data-calculator-name="steroid conversion corticosteroids prednisone methylprednisolone dexamethasone hydrocortisone cortisone equivalent dose anti inflammatory">
                 <div class="card-header"> <div class="number">27</div> Steroid Conversion </div>
                 <div class="card-body">
                     <p>Converts between different corticosteroid doses based on relative anti-inflammatory potency.</p>
                     <div class="form-group">
                         <label for="steroid-from">Convert From:</label>
                         <select id="steroid-from">
                             <option value="5">Prednisone</option>
                             <option value="5">Prednisolone</option>
                             <option value="4">Methylprednisolone</option>
                             <option value="0.75">Dexamethasone</option>
                             <option value="20">Hydrocortisone</option>
                             <option value="25">Cortisone</option>
                             <option value="0.6">Betamethasone</option>
                             <option value="4">Triamcinolone</option>
                         </select>
                     </div>
                     <div class="form-group">
                         <label for="steroid-dose">Dose (mg):</label>
                         <input type="number" id="steroid-dose" placeholder="Dose in mg">
                         <div class="error-message" id="steroid-dose-error"></div>
                     </div>
                     <div class="form-group">
                         <label for="steroid-to">Convert To:</label>
                         <select id="steroid-to">
                             <option value="5">Prednisone</option>
                             <option value="5">Prednisolone</option>
                             <option value="4">Methylprednisolone</option>
                             <option value="0.75">Dexamethasone</option>
                             <option value="20">Hydrocortisone</option>
                             <option value="25">Cortisone</option>
                             <option value="0.6">Betamethasone</option>
                             <option value="4">Triamcinolone</option>
                         </select>
                     </div>
                     <button id="calculate-steroid">Convert</button>
                     <div class="result-box" id="steroid-result">
                         <div class="result-value" id="steroid-converted-dose"></div>
                         <div class="result-interpretation">
                             <p id="steroid-conversion-details"></p>
                         </div>
                         <div class="note"> Note: Based on anti-inflammatory equivalencies (e.g., Prednisone 5mg ≈ Hydrocortisone 20mg). Mineralocorticoid effects vary. Clinical judgment required. </div>
                     </div>
                 </div>
             </div>

             <!-- 28. Child-Pugh Score -->
             <div class="calculator-card" data-calculator-name="child-pugh childs score cirrhosis liver disease mortality prognosis encephalopathy ascites bilirubin albumin inr pt">
                 <div class="card-header"> <div class="number">28</div> Child-Pugh Score for Cirrhosis </div>
                 <div class="card-body">
                     <p>Estimates severity and prognosis of chronic liver disease, primarily cirrhosis.</p>
                     <div class="form-group"> <label for="cp-encephalopathy">Hepatic Encephalopathy Grade:</label> <select id="cp-encephalopathy"> <option value="1">None (Grade 0) (1pt)</option> <option value="2">Grade 1-2 (Mild/Moderate) (2pts)</option> <option value="3">Grade 3-4 (Severe) (3pts)</option> </select> </div>
                     <div class="form-group"> <label for="cp-ascites">Ascites:</label> <select id="cp-ascites"> <option value="1">None (1pt)</option> <option value="2">Slight/Moderate (Diuretic Responsive) (2pts)</option> <option value="3">Tense/Large (Diuretic Refractory) (3pts)</option> </select> </div>
                     <div class="form-group"> <label for="cp-bilirubin">Total Bilirubin:</label> <div class="row"> <div class="col"> <input type="number" id="cp-bilirubin" placeholder="Bilirubin"> </div> <div class="col"> <select id="cp-bilirubin-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select> </div> </div> <div class="error-message" id="cp-bilirubin-error"></div> </div>
                     <div class="form-group"> <label for="cp-albumin">Serum Albumin:</label> <div class="row"> <div class="col"> <input type="number" id="cp-albumin" placeholder="Albumin"> </div> <div class="col"> <select id="cp-albumin-unit"> <option value="g/dL">g/dL</option> <option value="g/L">g/L</option> </select> </div> </div> <div class="error-message" id="cp-albumin-error"></div> </div>
                     <div class="form-group"> <label for="cp-inr">INR (or Prothrombin Time):</label> <input type="number" id="cp-inr" placeholder="INR (e.g., 1.5)"> <div class="error-message" id="cp-inr-error"></div> <label style="font-size: 0.8em; margin-top: 3px;">(If using PT seconds, enter value and see note)</label> </div>
                     <button id="calculate-child-pugh">Calculate</button>
                     <div class="result-box" id="child-pugh-result"> <div class="result-value" id="child-pugh-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="child-pugh-level"></div> <p id="child-pugh-interpretation"></p> </div> <div class="note"> Note: Points: Bili <2/<34 (1), 2-3/34-51 (2), >3/>51 (3). Alb >3.5/>35 (1), 2.8-3.5/28-35 (2), <2.8/<28 (3). INR <1.7 (1), 1.7-2.3 (2), >2.3 (3). (Approx PT: <4s (1), 4-6s (2), >6s prolongation (3)). Class A (5-6), B (7-9), C (10-15). </div> </div>
                 </div>
             </div>

             <!-- 29. CURB-65 Score -->
             <div class="calculator-card" data-calculator-name="curb-65 curb65 pneumonia severity cap community acquired mortality risk admission outpatient inpatient confusion urea bun respiratory rate blood pressure age">
                 <div class="card-header"> <div class="number">29</div> CURB-65 Score for Pneumonia </div>
                 <div class="card-body">
                     <p>Predicts mortality in community-acquired pneumonia (CAP) to guide site-of-care decisions.</p>
                     <div class="checkbox-group"> <label>Select Applicable Criteria (1 point each):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="curb-confusion" value="1"> <label for="curb-confusion">Confusion (New disorientation)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="curb-bun" value="1"> <label for="curb-bun">Urea > 7 mmol/L (or BUN > 19 mg/dL)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="curb-rr" value="1"> <label for="curb-rr">Respiratory Rate ≥ 30 breaths/min</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="curb-bp" value="1"> <label for="curb-bp">Blood Pressure (SBP < 90 mmHg or DBP ≤ 60 mmHg)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="curb-age" value="1"> <label for="curb-age">Age ≥ 65 years</label> </div>
                     </div>
                     <button id="calculate-curb65">Calculate</button>
                     <div class="result-box" id="curb65-result"> <div class="result-value" id="curb65-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="curb65-level"></div> <p id="curb65-interpretation"></p> </div> <div class="note"> Note: Score 0-1 (Low risk, outpatient), 2 (Moderate risk, consider inpatient), ≥3 (High risk, inpatient +/- ICU). Consider PSI/PORT score for more detail. </div> </div>
                 </div>
             </div>

             <!-- 30. PERC Rule -->
             <div class="calculator-card" data-calculator-name="perc rule pulmonary embolism rule out criteria low risk chest pain shortness breath d dimer imaging age hr o2 sat surgery hemoptysis estrogen dvt">
                 <div class="card-header"> <div class="number">30</div> PERC Rule for PE </div>
                 <div class="card-body">
                     <p>Helps rule out Pulmonary Embolism (PE) in low-risk patients without further testing (e.g., D-dimer).</p>
                     <div class="checkbox-group"> <label>Check if ANY of the following criteria are PRESENT:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-age" value="1"> <label for="perc-age">Age ≥ 50 years</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-hr" value="1"> <label for="perc-hr">Heart Rate ≥ 100 bpm</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-o2" value="1"> <label for="perc-o2">O₂ Saturation < 95% on room air</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-hemoptysis" value="1"> <label for="perc-hemoptysis">Hemoptysis</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-estrogen" value="1"> <label for="perc-estrogen">Exogenous Estrogen use</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-surgery" value="1"> <label for="perc-surgery">Surgery/Trauma requiring hospitalization within 4 weeks</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-dvt-pe" value="1"> <label for="perc-dvt-pe">Prior DVT or PE</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="perc-swelling" value="1"> <label for="perc-swelling">Unilateral leg swelling</label> </div>
                     </div>
                     <button id="calculate-perc">Evaluate PERC Rule</button>
                     <div class="result-box" id="perc-result"> <div class="result-value" id="perc-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="perc-level"></div> <p id="perc-interpretation"></p> </div> <div class="note"> Note: Only apply if clinical gestalt for PE is low (e.g., <15%). If ALL criteria are ABSENT (Score=0), PE is effectively ruled out. If ANY criterion is PRESENT (Score>0), PERC rule is POSITIVE and cannot rule out PE; proceed with further testing (e.g., D-dimer, Wells'). </div> </div>
                 </div>
             </div>

             <!-- 31. PHQ-9 -->
             <div class="calculator-card" data-calculator-name="phq-9 phq9 patient health questionnaire depression screening severity mental health mood anhedonia sleep energy appetite concentration suicide">
                 <div class="card-header"> <div class="number">31</div> PHQ-9 Depression Screen </div>
                 <div class="card-body">
                     <p>Screens for and assesses severity of depression based on DSM-V criteria.</p>
                     <p style="font-size: 0.9em; margin-bottom: 10px;">Over the last 2 weeks, how often have you been bothered by any of the following problems?</p>
                     <div class="phq9-item"> <label>1. Little interest or pleasure in doing things</label> <select id="phq9-1"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>2. Feeling down, depressed, or hopeless</label> <select id="phq9-2"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>3. Trouble falling/staying asleep, or sleeping too much</label> <select id="phq9-3"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>4. Feeling tired or having little energy</label> <select id="phq9-4"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>5. Poor appetite or overeating</label> <select id="phq9-5"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>6. Feeling bad about yourself - or that you are a failure or have let yourself or your family down</label> <select id="phq9-6"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>7. Trouble concentrating on things, such as reading the newspaper or watching television</label> <select id="phq9-7"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item"> <label>8. Moving or speaking so slowly that other people could have noticed? Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual</label> <select id="phq9-8"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <div class="phq9-item" style="border: 2px solid var(--danger); padding: 5px; border-radius: 4px; margin-top: 5px;"> <label style="color: var(--danger); font-weight: bold;">9. Thoughts that you would be better off dead, or of hurting yourself in some way</label> <select id="phq9-9"> <option value="0">0 - Not at all</option> <option value="1">1 - Several days</option> <option value="2">2 - More than half the days</option> <option value="3">3 - Nearly every day</option> </select> </div>
                     <button id="calculate-phq9">Calculate Score</button>
                     <div class="result-box" id="phq9-result"> <div class="result-value" id="phq9-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="phq9-level"></div> <p id="phq9-interpretation"></p> </div> <div id="phq9-suicide-warning" class="error-message" style="text-align: center; font-weight: bold; display: none;"></div> <div class="note"> Note: Score 1-4 (Minimal), 5-9 (Mild), 10-14 (Moderate), 15-19 (Mod. Severe), 20-27 (Severe). Positive response to Q9 requires urgent safety assessment. </div> </div>
                 </div>
             </div>

             <!-- 32. STOP-BANG Score -->
             <div class="calculator-card" data-calculator-name="stop-bang stopbang osa obstructive sleep apnea snoring tired observed pressure bmi age neck gender screening risk">
                 <div class="card-header"> <div class="number">32</div> STOP-BANG Score for OSA Risk </div>
                 <div class="card-body">
                     <p>Screens for risk of moderate to severe Obstructive Sleep Apnea (OSA).</p>
                     <div class="checkbox-group"> <label>Select if PRESENT (1 point each):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-snoring" value="1"> <label for="stopbang-snoring"><b>S</b>noring (Loudly)?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-tired" value="1"> <label for="stopbang-tired"><b>T</b>ired (Often feel tired/fatigued during daytime)?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-observed" value="1"> <label for="stopbang-observed"><b>O</b>bserved (Anyone observed you stop breathing during sleep)?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-pressure" value="1"> <label for="stopbang-pressure"><b>P</b>ressure (High blood pressure - treated or untreated)?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-bmi" value="1"> <label for="stopbang-bmi"><b>B</b>MI > 35 kg/m²?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-age" value="1"> <label for="stopbang-age"><b>A</b>ge > 50 years?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-neck" value="1"> <label for="stopbang-neck"><b>N</b>eck Circumference Large? (>40cm / ~16in)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="stopbang-gender" value="1"> <label for="stopbang-gender"><b>G</b>ender Male?</label> </div>
                     </div>
                     <button id="calculate-stopbang">Calculate</button>
                     <div class="result-box" id="stopbang-result"> <div class="result-value" id="stopbang-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="stopbang-level"></div> <p id="stopbang-interpretation"></p> </div> <div class="note"> Note: Score 0-2 (Low risk), 3-4 (Intermediate risk), 5-8 (High risk) of moderate-severe OSA. Consider referral/sleep study based on risk. </div> </div>
                 </div>
             </div>

             <!-- 33. CIWA-Ar -->
             <div class="calculator-card" data-calculator-name="ciwa-ar ciwa alcohol withdrawal scale assessment severity delirium tremens dt benzodiazepine treatment monitoring nausea tremor sweats anxiety agitation orientation hallucinations headache">
                 <div class="card-header"> <div class="number">33</div> CIWA-Ar Alcohol Withdrawal Scale </div>
                 <div class="card-body">
                     <p>Assesses severity of alcohol withdrawal to guide treatment (e.g., benzodiazepines).</p>
                     <div class="form-group"> <label>Nausea and Vomiting:</label> <select id="ciwa-nausea"> <option value="0">0 - None</option> <option value="1">1 - Mild nausea, no vomiting</option> <option value="4">4 - Intermittent nausea</option> <option value="7">7 - Constant nausea, frequent dry heaves/vomiting</option> </select> </div>
                     <div class="form-group"> <label>Tremor (Arms extended, fingers spread):</label> <select id="ciwa-tremor"> <option value="0">0 - No tremor</option> <option value="1">1 - Not visible, but felt fingertip-to-fingertip</option> <option value="4">4 - Moderate, with arms extended</option> <option value="7">7 - Severe, even with arms not extended</option> </select> </div>
                     <div class="form-group"> <label>Paroxysmal Sweats:</label> <select id="ciwa-sweats"> <option value="0">0 - No sweats</option> <option value="1">1 - Barely perceptible sweating, palms moist</option> <option value="4">4 - Beads of sweat obvious on forehead</option> <option value="7">7 - Drenching sweats</option> </select> </div>
                     <div class="form-group"> <label>Anxiety:</label> <select id="ciwa-anxiety"> <option value="0">0 - No anxiety, at ease</option> <option value="1">1 - Mildly anxious</option> <option value="4">4 - Moderately anxious, or guarded</option> <option value="7">7 - Equivalent to panic attack state</option> </select> </div>
                     <div class="form-group"> <label>Agitation:</label> <select id="ciwa-agitation"> <option value="0">0 - Normal activity</option> <option value="1">1 - Somewhat normal activity</option> <option value="2">2 - Moderately fidgety and restless</option> <option value="4">4 - Paces back and forth / Thrashes about</option> </select> </div>
                     <div class="form-group"> <label>Tactile Disturbances:</label> <select id="ciwa-tactile"> <option value="0">0 - None</option> <option value="1">1 - Very mild itching, pins/needles, burning, numbness</option> <option value="2">2 - Mild itching, pins/needles, burning, numbness</option> <option value="3">3 - Moderate itching, pins/needles, burning, numbness</option> <option value="4">4 - Moderately severe hallucinations</option> <option value="5">5 - Severe hallucinations</option> <option value="6">6 - Extremely severe hallucinations</option> <option value="7">7 - Continuous hallucinations</option> </select> </div>
                     <div class="form-group"> <label>Auditory Disturbances:</label> <select id="ciwa-auditory"> <option value="0">0 - None</option> <option value="1">1 - Very mild harshness or ability to frighten</option> <option value="2">2 - Mild harshness or ability to frighten</option> <option value="3">3 - Moderate harshness or ability to frighten</option> <option value="4">4 - Moderately severe hallucinations</option> <option value="5">5 - Severe hallucinations</option> <option value="6">6 - Extremely severe hallucinations</option> <option value="7">7 - Continuous hallucinations</option> </select> </div>
                     <div class="form-group"> <label>Visual Disturbances:</label> <select id="ciwa-visual"> <option value="0">0 - None</option> <option value="1">1 - Very mild sensitivity</option> <option value="2">2 - Mild sensitivity</option> <option value="3">3 - Moderate sensitivity</option> <option value="4">4 - Moderately severe hallucinations</option> <option value="5">5 - Severe hallucinations</option> <option value="6">6 - Extremely severe hallucinations</option> <option value="7">7 - Continuous hallucinations</option> </select> </div>
                     <div class="form-group"> <label>Headache, Fullness in Head:</label> <select id="ciwa-headache"> <option value="0">0 - Not present</option> <option value="1">1 - Very mild</option> <option value="2">2 - Mild</option> <option value="3">3 - Moderate</option> <option value="4">4 - Moderately severe</option> <option value="5">5 - Severe</option> <option value="6">6 - Very severe</option> <option value="7">7 - Extremely severe</option> </select> </div>
                     <div class="form-group"> <label>Orientation and Clouding of Sensorium:</label> <select id="ciwa-orientation"> <option value="0">0 - Oriented</option> <option value="1">1 - Cannot do serial additions</option> <option value="2">2 - Disoriented to date</option> <option value="3">3 - Disoriented to place</option> <option value="4">4 - Disoriented to person</option> </select> </div>
                     <button id="calculate-ciwa">Calculate Score</button>
                     <div class="result-box" id="ciwa-result"> <div class="result-value" id="ciwa-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="ciwa-level"></div> <p id="ciwa-interpretation"></p> </div> <div class="note"> Note: Score <8-10 (Mild withdrawal, supportive care), 10-18 (Moderate, consider BZD), ≥19 (Severe, likely requires BZD). Max score 67. Follow protocol for reassessment frequency. </div> </div>
                 </div>
             </div>

             <!-- 34. HEART Score -->
             <div class="calculator-card" data-calculator-name="heart score chest pain mace major adverse cardiac event risk stratification ed emergency department history ecg age risk factors troponin">
                 <div class="card-header"> <div class="number">34</div> HEART Score for MACE </div>
                 <div class="card-body">
                     <p>Predicts 6-week risk of Major Adverse Cardiac Events (MACE) in ED patients with chest pain.</p>
                     <div class="form-group"> <label><b>H</b>istory:</label> <select id="heart-history"> <option value="0">Slightly suspicious (0pts)</option> <option value="1">Moderately suspicious (1pt)</option> <option value="2">Highly suspicious (2pts)</option> </select> </div>
                     <div class="form-group"> <label><b>E</b>CG:</label> <select id="heart-ecg"> <option value="0">Normal (0pts)</option> <option value="1">Non-specific repolarization disturbance (1pt)</option> <option value="2">Significant ST deviation (2pts)</option> </select> </div>
                     <div class="form-group"> <label><b>A</b>ge:</label> <select id="heart-age"> <option value="0">< 45 years (0pts)</option> <option value="1">45-64 years (1pt)</option> <option value="2">≥ 65 years (2pts)</option> </select> </div>
                     <div class="form-group"> <label><b>R</b>isk Factors (Select all applicable, max 2 points):</label>
                         <div class="checkbox-group" style="padding: 5px; border: none;">
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-htn"> <label for="heart-rf-htn">Hypertension</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-chol"> <label for="heart-rf-chol">Hypercholesterolemia</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-dm"> <label for="heart-rf-dm">Diabetes Mellitus</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-obesity"> <label for="heart-rf-obesity">Obesity (BMI > 30)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-smoking"> <label for="heart-rf-smoking">Smoking (Current or within 3 mo)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-fhx"> <label for="heart-rf-fhx">Family History (Parent/sibling < 65)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="heart-rf-athero"> <label for="heart-rf-athero">Atherosclerotic Disease (Prior MI, PCI/CABG, CVA/TIA, PAD)</label> </div>
                         </div>
                     </div>
                     <div class="form-group"> <label><b>T</b>roponin:</label> <select id="heart-troponin"> <option value="0">≤ Normal limit (0pts)</option> <option value="1">>1x to 3x Normal limit (1pt)</option> <option value="2">> 3x Normal limit (2pts)</option> </select> </div>
                     <button id="calculate-heart">Calculate Score</button>
                     <div class="result-box" id="heart-result"> <div class="result-value" id="heart-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="heart-level"></div> <p id="heart-interpretation"></p> </div> <div class="note"> Note: Score 0-3 (Low risk, ~1-2% MACE, consider discharge), 4-6 (Intermediate risk, ~12-17% MACE, admit for observation), 7-10 (High risk, ~50-65% MACE, early invasive strategy). MACE = MI, PCI, CABG, death. </div> </div>
                 </div>
             </div>

             <!-- 35. Revised Cardiac Risk Index (RCRI) -->
             <div class="calculator-card" data-calculator-name="rcri revised cardiac risk index lee index pre-operative preoperative surgery risk cardiac complications mi heart failure death ihd cvd cva renal insulin diabetes creatinine">
                 <div class="card-header"> <div class="number">35</div> Revised Cardiac Risk Index (RCRI) </div>
                 <div class="card-body">
                     <p>Estimates risk of major cardiac complications (MI, pulm edema, VF/cardiac arrest, complete heart block) after noncardiac surgery.</p>
                     <div class="checkbox-group"> <label>Select Applicable Risk Factors (1 point each):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-surgery" value="1"> <label for="rcri-surgery">High-Risk Surgery (Intraperitoneal, intrathoracic, suprainguinal vascular)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-ihd" value="1"> <label for="rcri-ihd">History of Ischemic Heart Disease (MI, +stress test, current angina, use of nitrates, Q waves)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-chf" value="1"> <label for="rcri-chf">History of Congestive Heart Failure</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-cvd" value="1"> <label for="rcri-cvd">History of Cerebrovascular Disease (Stroke or TIA)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-insulin" value="1"> <label for="rcri-insulin">Preoperative treatment with Insulin</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="rcri-renal" value="1"> <label for="rcri-renal">Preoperative Serum Creatinine > 2.0 mg/dL (> 177 µmol/L)</label> </div>
                     </div>
                     <button id="calculate-rcri">Calculate</button>
                     <div class="result-box" id="rcri-result"> <div class="result-value" id="rcri-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="rcri-level"></div> <p id="rcri-interpretation"></p> </div> <div class="note"> Note: Risk of major cardiac complication: 0 pts (~0.4%), 1 pt (~0.9%), 2 pts (~6.6%), ≥3 pts (~11%). Guides preoperative evaluation/management. </div> </div>
                 </div>
             </div>

             <!-- 36. Padua Prediction Score -->
             <div class="calculator-card" data-calculator-name="padua prediction score vte venous thromboembolism dvt pe prophylaxis hospitalized medical patients risk assessment cancer mobility thrombophilia obesity hormone trauma surgery heart respiratory failure infection rheumatic bmi">
                 <div class="card-header"> <div class="number">36</div> Padua Score for VTE Risk </div>
                 <div class="card-body">
                     <p>Assesses risk of Venous Thromboembolism (VTE) in hospitalized medical patients to guide prophylaxis.</p>
                     <div class="checkbox-group"> <label>Select Applicable Risk Factors:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-cancer" value="3"> <label for="padua-cancer">Active Cancer (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-prev-vte" value="3"> <label for="padua-prev-vte">Previous VTE (excluding superficial vein thrombosis) (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-mobility" value="3"> <label for="padua-mobility">Reduced Mobility (Anticipated ≥3 days bedrest w/o bathroom privileges) (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-thrombophilia" value="3"> <label for="padua-thrombophilia">Known Thrombophilic condition (e.g., Factor V Leiden, Prothrombin mutation, ATIII, Protein C/S def, APLS) (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-trauma-surgery" value="2"> <label for="padua-trauma-surgery">Recent (<1 month) Trauma and/or Surgery (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-age" value="1"> <label for="padua-age">Age ≥ 70 years (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-heart-resp" value="1"> <label for="padua-heart-resp">Heart and/or Respiratory Failure (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-mi-stroke" value="1"> <label for="padua-mi-stroke">Acute MI or Ischemic Stroke (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-infection-rheum" value="1"> <label for="padua-infection-rheum">Acute Infection and/or Rheumatalogic Disorder (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-obesity" value="1"> <label for="padua-obesity">Obesity (BMI ≥ 30 kg/m²) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="padua-hormone" value="1"> <label for="padua-hormone">Ongoing Hormonal Treatment (1pt)</label> </div>
                     </div>
                     <button id="calculate-padua">Calculate</button>
                     <div class="result-box" id="padua-result"> <div class="result-value" id="padua-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="padua-level"></div> <p id="padua-interpretation"></p> </div> <div class="note"> Note: Score < 4 (Low VTE risk, prophylaxis generally not needed), Score ≥ 4 (High VTE risk, pharmacologic prophylaxis recommended unless contraindicated). </div> </div>
                 </div>
             </div>

             <!-- 37. Canadian CT Head Rule -->
             <div class="calculator-card" data-calculator-name="canadian ct head rule cchr head injury trauma concussion minor gcs amnesia vomiting age mechanism skull fracture basilar sign rule out imaging scan emergency medicine">
                 <div class="card-header"> <div class="number">37</div> Canadian CT Head Rule </div>
                 <div class="card-body">
                     <p>Identifies minor head injury patients who do NOT require CT imaging. Applicable for GCS 13-15 after trauma.</p>
                     <div class="checkbox-group"> <label>High Risk Factors (Need CT if ANY present):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-gcs" value="1"> <label for="cchr-gcs">GCS score < 15 at 2 hours post-injury</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-skull" value="1"> <label for="cchr-skull">Suspected open or depressed skull fracture</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-basilar" value="1"> <label for="cchr-basilar">Any sign of basilar skull fracture (hemotympanum, 'raccoon eyes', CSF otorrhea/rhinorrhea, Battle's sign)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-vomit" value="1"> <label for="cchr-vomit">≥ 2 episodes of vomiting</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-age" value="1"> <label for="cchr-age">Age ≥ 65 years</label> </div>
                     </div>
                     <div class="checkbox-group"> <label>Medium Risk Factors (Need CT if ANY present):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-amnesia" value="1"> <label for="cchr-amnesia">Amnesia before impact ≥ 30 minutes</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="cchr-mechanism" value="1"> <label for="cchr-mechanism">Dangerous mechanism (pedestrian struck, occupant ejected, fall > 3 feet / 5 stairs)</label> </div>
                     </div>
                     <button id="calculate-cchr">Evaluate Rule</button>
                     <div class="result-box" id="cchr-result"> <div class="result-value" id="cchr-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="cchr-level"></div> <p id="cchr-interpretation"></p> </div> <div class="note"> Note: For minor head injury (GCS 13-15, witnessed LOC/amnesia/disorientation). If ANY factor is present, CT is indicated. If ALL factors are absent, CT is not required. Excludes anticoagulation, seizure post-injury. </div> </div>
                 </div>
             </div>

             <!-- 38. Glasgow-Blatchford Bleeding Score (GBS) -->
             <div class="calculator-card" data-calculator-name="glasgow blatchford bleeding score gbs upper gi bleed ugib hematemesis melena risk stratification outpatient management admission intervention transfusion bun hemoglobin bp heart rate syncope liver disease cardiac failure">
                 <div class="card-header"> <div class="number">38</div> Glasgow-Blatchford Score (GBS) </div>
                 <div class="card-body">
                     <p>Stratifies risk in upper GI bleeding (UGIB) to identify low-risk patients suitable for outpatient management.</p>
                     <div class="form-group"> <label>Blood Urea Nitrogen (BUN):</label> <div class="row"> <div class="col"><input type="number" id="gbs-bun" placeholder="BUN"></div> <div class="col"><select id="gbs-bun-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select></div> </div> <div class="error-message" id="gbs-bun-error"></div> </div>
                     <div class="form-group"> <label>Hemoglobin (g/dL) - Male:</label> <input type="number" id="gbs-hb-male" placeholder="Hb (Male)"> <div class="error-message" id="gbs-hb-male-error"></div> </div>
                     <div class="form-group"> <label>Hemoglobin (g/dL) - Female:</label> <input type="number" id="gbs-hb-female" placeholder="Hb (Female)"> <div class="error-message" id="gbs-hb-female-error"></div> </div>
                     <div class="form-group"> <label>Systolic Blood Pressure (mmHg):</label> <input type="number" id="gbs-sbp" placeholder="SBP"> <div class="error-message" id="gbs-sbp-error"></div> </div>
                     <div class="form-group"> <label>Other Markers (Select all applicable):</label>
                         <div class="checkbox-group" style="padding: 5px; border: none;">
                             <div class="checkbox-option"> <input type="checkbox" id="gbs-hr" value="1"> <label for="gbs-hr">Pulse ≥ 100 bpm (1pt)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="gbs-melena" value="1"> <label for="gbs-melena">Presentation with Melena (1pt)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="gbs-syncope" value="2"> <label for="gbs-syncope">Presentation with Syncope (2pts)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="gbs-liver" value="2"> <label for="gbs-liver">History of Hepatic Disease (2pts)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="gbs-cardiac" value="2"> <label for="gbs-cardiac">History of Cardiac Failure (2pts)</label> </div>
                         </div>
                     </div>
                     <button id="calculate-gbs">Calculate Score</button>
                     <div class="result-box" id="gbs-result"> <div class="result-value" id="gbs-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="gbs-level"></div> <p id="gbs-interpretation"></p> </div> <div class="note"> Note: Score 0 identifies low-risk patients (very low risk of needing intervention/transfusion/death) who may be suitable for outpatient management. Higher scores indicate increased risk. BUN points: 18-22/6.5-7.9 (2), 22-28/8-9.9 (3), 28-70/10-24.9 (4), >70/>25 (6). Hb Male points: 12-13 (1), 10-12 (3), <10 (6). Hb Female points: 10-12 (1), <10 (6). SBP points: 100-109 (1), 90-99 (2), <90 (3). </div> </div>
                 </div>
             </div>

             <!-- 39. PECARN Pediatric Head Injury -->
             <div class="calculator-card" data-calculator-name="pecarn pediatric head injury trauma algorithm concussion child infant toddler ct scan imaging rule out gcs ams loc skull fracture hematoma mechanism">
                 <div class="card-header"> <div class="number">39</div> PECARN Head Injury Rule </div>
                 <div class="card-body">
                     <p>Predicts risk of clinically important Traumatic Brain Injury (ciTBI) in children after minor head trauma to guide CT use.</p>
                     <div class="form-group">
                         <label for="pecarn-age-group">Patient Age Group:</label>
                         <select id="pecarn-age-group">
                             <option value="under2">Age < 2 Years</option>
                             <option value="over2">Age ≥ 2 Years</option>
                         </select>
                     </div>

                     <!-- Fields for Age < 2 -->
                     <div id="pecarn-under2-fields" class="pecarn-age-group-fields">
                         <div class="checkbox-group"> <label>Criteria for CT (Age < 2):</label>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-gcs" value="1"> <label for="pecarn-u2-gcs">Altered Mental Status (GCS < 15, Agitation, Somnolence, Repetitive questioning, Slow response)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-skull" value="1"> <label for="pecarn-u2-skull">Palpable Skull Fracture</label> </div>
                         </div>
                         <div class="checkbox-group" style="border-color: var(--warning);"> <label style="color: var(--warning);">Observation vs CT Factors (Age < 2):</label>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-loc" value="1"> <label for="pecarn-u2-loc">Loss of Consciousness ≥ 5 seconds</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-mechanism" value="1"> <label for="pecarn-u2-mechanism">Severe Mechanism of Injury (Fall >3ft, Head struck by high-impact object, MVA with ejection/rollover/death, Pedestrian/Bicyclist without helmet struck by vehicle)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-hematoma" value="1"> <label for="pecarn-u2-hematoma">Non-frontal Scalp Hematoma</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-u2-behavior" value="1"> <label for="pecarn-u2-behavior">Not Acting Normally Per Parent</label> </div>
                         </div>
                     </div>

                     <!-- Fields for Age >= 2 -->
                     <div id="pecarn-over2-fields" class="pecarn-age-group-fields" style="display: none;">
                         <div class="checkbox-group"> <label>Criteria for CT (Age ≥ 2):</label>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-gcs" value="1"> <label for="pecarn-o2-gcs">Altered Mental Status (GCS < 15, Agitation, Somnolence, Repetitive questioning, Slow response)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-basilar" value="1"> <label for="pecarn-o2-basilar">Signs of Basilar Skull Fracture</label> </div>
                         </div>
                          <div class="checkbox-group" style="border-color: var(--warning);"> <label style="color: var(--warning);">Observation vs CT Factors (Age ≥ 2):</label>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-loc" value="1"> <label for="pecarn-o2-loc">Loss of Consciousness</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-mechanism" value="1"> <label for="pecarn-o2-mechanism">Severe Mechanism of Injury (Fall >5ft, Head struck by high-impact object, MVA with ejection/rollover/death, Pedestrian/Bicyclist without helmet struck by vehicle)</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-vomiting" value="1"> <label for="pecarn-o2-vomiting">Vomiting</label> </div>
                             <div class="checkbox-option"> <input type="checkbox" id="pecarn-o2-headache" value="1"> <label for="pecarn-o2-headache">Severe Headache</label> </div>
                         </div>
                     </div>

                     <button id="calculate-pecarn">Evaluate PECARN Rule</button>
                     <div class="result-box" id="pecarn-result"> <div class="result-value" id="pecarn-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="pecarn-level"></div> <p id="pecarn-interpretation"></p> </div> <div class="note"> Note: For minor blunt head trauma within 24h, GCS ≥ 14. If ANY "Criteria for CT" met -> CT recommended. If NONE met, but ANY "Observation vs CT Factors" met -> Observation vs CT based on clinical judgment/shared decision making. If NO factors met -> CT not recommended (ciTBI risk <0.05%). </div> </div>
                 </div>
             </div>

             <!-- 40. Caprini Score -->
             <div class="calculator-card" data-calculator-name="caprini score vte venous thromboembolism dvt pe risk assessment surgical patients prophylaxis score bmi age mobility malignancy history thrombophilia varicose veins chf sepsis pneumonia ibd central line surgery anesthesia">
                 <div class="card-header"> <div class="number">40</div> Caprini Score for VTE Risk (2005) </div>
                 <div class="card-body">
                     <p>Stratifies VTE risk in surgical patients to guide prophylaxis decisions.</p>
                     <div class="caprini-section">
                         <label>Patient Demographics & History (Select all applicable):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-age41" value="1"> <label for="caprini-age41">Age 41-60 years (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-age61" value="2"> <label for="caprini-age61">Age 61-74 years (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-age75" value="3"> <label for="caprini-age75">Age ≥ 75 years (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-bmi25" value="1"> <label for="caprini-bmi25">BMI > 25 kg/m² (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-hx-minor-surg" value="1"> <label for="caprini-hx-minor-surg">History of minor surgery (<1 mo) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-hx-major-surg" value="2"> <label for="caprini-hx-major-surg">History of major surgery (<1 mo) (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-varicose" value="1"> <label for="caprini-varicose">Varicose veins (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-ibd" value="1"> <label for="caprini-ibd">History of IBD (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-swelling" value="1"> <label for="caprini-swelling">Swollen legs (current) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-preg" value="1"> <label for="caprini-preg">Pregnancy or postpartum (<1 mo) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-ocp-hrt" value="1"> <label for="caprini-ocp-hrt">Oral contraceptives or HRT (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-sepsis" value="1"> <label for="caprini-sepsis">Sepsis (<1 mo) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-pneumonia" value="1"> <label for="caprini-pneumonia">Serious lung disease incl. pneumonia (<1 mo) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-pulm-func" value="1"> <label for="caprini-pulm-func">Abnormal pulmonary function (COPD) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-mi" value="1"> <label for="caprini-mi">Acute MI (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-chf" value="1"> <label for="caprini-chf">CHF (<1 mo) (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-bedrest" value="1"> <label for="caprini-bedrest">History of bedrest > 72h (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-cast" value="2"> <label for="caprini-cast">Plaster cast immobilization (<1 mo) (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-central-line" value="2"> <label for="caprini-central-line">Central venous access (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-malignancy" value="2"> <label for="caprini-malignancy">History or current Malignancy (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-hx-vte" value="3"> <label for="caprini-hx-vte">History of DVT/PE (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-fhx-vte" value="3"> <label for="caprini-fhx-vte">Family history of DVT/PE (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-factorV" value="3"> <label for="caprini-factorV">Factor V Leiden positive (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-prothrombin" value="3"> <label for="caprini-prothrombin">Prothrombin 20210A positive (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-lupus-ac" value="3"> <label for="caprini-lupus-ac">Lupus anticoagulant positive (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-anticardiolipin" value="3"> <label for="caprini-anticardiolipin">Anticardiolipin antibody positive (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-hit" value="3"> <label for="caprini-hit">Heparin-induced thrombocytopenia (HIT) (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-other-thrombo" value="3"> <label for="caprini-other-thrombo">Other congenital or acquired thrombophilia (3pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-stroke" value="5"> <label for="caprini-stroke">History of stroke (<1 mo) (5pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-paralysis" value="5"> <label for="caprini-paralysis">Paralysis (paraplegia) (5pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-spinal-cord" value="5"> <label for="caprini-spinal-cord">Spinal cord injury (<1 mo) (5pts)</label> </div>
                     </div>
                     <div class="caprini-section">
                         <label>Current Procedure / Condition:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-proc-minor" value="1"> <label for="caprini-proc-minor">Minor surgery planned (1pt)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-proc-major45" value="2"> <label for="caprini-proc-major45">Major open surgery (>45 min) (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-proc-lap" value="2"> <label for="caprini-proc-lap">Laparoscopic surgery (>45 min) (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-proc-arthro" value="2"> <label for="caprini-proc-arthro">Arthroscopic surgery (2pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-proc-hip-pelvis-leg" value="5"> <label for="caprini-proc-hip-pelvis-leg">Elective arthroplasty (hip/knee) or Hip, pelvis, leg fracture (5pts)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="caprini-confine-bed" value="2"> <label for="caprini-confine-bed">Confined to bed (>72 hours) (2pts)</label> </div>
                     </div>
                     <button id="calculate-caprini">Calculate Score</button>
                     <div class="result-box" id="caprini-result"> <div class="result-value" id="caprini-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="caprini-level"></div> <p id="caprini-interpretation"></p> </div> <div class="note"> Note: Risk Categories: 0 (Very Low, ~0.5%), 1-2 (Low, ~1.5%), 3-4 (Moderate, ~3%), ≥5 (High, ~6%). Guides type/duration of VTE prophylaxis (e.g., mechanical, pharmacologic). Consult institutional guidelines. </div> </div>
                 </div>
             </div>

             <!-- 41. SIRS, Sepsis, Septic Shock Criteria -->
             <div class="calculator-card" data-calculator-name="sirs sepsis septic shock criteria systemic inflammatory response syndrome infection organ dysfunction hypotension lactate vasopressors definition diagnosis critical care icu">
                 <div class="card-header"> <div class="number">41</div> SIRS, Sepsis, Septic Shock Criteria </div>
                 <div class="card-body">
                     <p>Defines Systemic Inflammatory Response Syndrome (SIRS), Sepsis, and Septic Shock (based on Sepsis-2 definitions).</p>
                     <div class="checkbox-group"> <label>SIRS Criteria (Need ≥2):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="sirs-temp"> <label for="sirs-temp">Temperature > 38°C (100.4°F) or < 36°C (96.8°F)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="sirs-hr"> <label for="sirs-hr">Heart Rate > 90 bpm</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="sirs-rr"> <label for="sirs-rr">Respiratory Rate > 20 breaths/min or PaCO₂ < 32 mmHg</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="sirs-wbc"> <label for="sirs-wbc">WBC > 12,000/mm³, < 4,000/mm³, or > 10% bands</label> </div>
                     </div>
                     <div class="checkbox-group"> <label>Sepsis Definition:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="sepsis-sirs"> <label for="sepsis-sirs">Meets ≥2 SIRS criteria</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="sepsis-infection"> <label for="sepsis-infection">Confirmed or Suspected Infection Source</label> </div>
                     </div>
                      <div class="checkbox-group"> <label>Severe Sepsis Definition (Sepsis + ≥1 Organ Dysfunction):</label>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-hypotension"> <label for="severe-sepsis-hypotension">Sepsis-induced hypotension (SBP < 90, MAP < 70, or SBP drop > 40)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-lactate"> <label for="severe-sepsis-lactate">Lactate > Upper limit of normal</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-urine"> <label for="severe-sepsis-urine">Urine output < 0.5 mL/kg/hr for > 2 hrs despite fluid resuscitation</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-ali"> <label for="severe-sepsis-ali">Acute lung injury with PaO₂/FiO₂ < 250 (no pneumonia) or < 200 (with pneumonia)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-creat"> <label for="severe-sepsis-creat">Creatinine > 2.0 mg/dL or increase > 0.5 mg/dL</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-bili"> <label for="severe-sepsis-bili">Bilirubin > 2 mg/dL</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-plt"> <label for="severe-sepsis-plt">Platelet count < 100,000/µL</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="severe-sepsis-inr"> <label for="severe-sepsis-inr">INR > 1.5 or aPTT > 60 sec</label> </div>
                     </div>
                     <div class="checkbox-group"> <label>Septic Shock Definition:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="shock-severe-sepsis"> <label for="shock-severe-sepsis">Meets Severe Sepsis criteria</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="shock-hypotension"> <label for="shock-hypotension">Sepsis-induced hypotension persisting despite adequate fluid resuscitation</label> </div>
                     </div>
                     <button id="evaluate-sepsis">Evaluate Criteria</button>
                     <div class="result-box" id="sepsis-result"> <div class="result-value" id="sepsis-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="sepsis-level"></div> <p id="sepsis-interpretation"></p> </div> <div class="note"> Note: Based on 2001 SCCM/ESICM/ACCP/ATS/SIS definitions (Sepsis-2). Sepsis-3 (2016) uses SOFA/qSOFA and defines sepsis as life-threatening organ dysfunction caused by dysregulated host response to infection, and septic shock as sepsis with persistent hypotension requiring vasopressors AND lactate > 2 mmol/L despite fluid resuscitation. </div> </div>
                 </div>
             </div>

             <!-- 42. Pregnancy Due Dates Calculator -->
             <div class="calculator-card" data-calculator-name="pregnancy due date calculator edd estimated delivery conception lmp last menstrual period gestational age weeks ultrasound obgyn obstetrics">
                 <div class="card-header"> <div class="number">42</div> Pregnancy Due Date Calculator </div>
                 <div class="card-body">
                     <p>Calculates Estimated Due Date (EDD), Gestational Age, and Conception Date.</p>
                     <div class="form-group">
                         <label for="preg-method">Calculate based on:</label>
                         <select id="preg-method">
                             <option value="lmp">Last Menstrual Period (LMP)</option>
                             <option value="conception">Date of Conception</option>
                             <option value="edd">Estimated Due Date (EDD)</option>
                             <option value="ultrasound">Ultrasound Dating</option>
                         </select>
                     </div>
                     <div id="preg-lmp-input" class="preg-input-group">
                         <label for="preg-lmp-date">LMP Date:</label>
                         <input type="date" id="preg-lmp-date">
                         <div class="error-message" id="preg-lmp-date-error"></div>
                     </div>
                     <div id="preg-conception-input" class="preg-input-group" style="display: none;">
                         <label for="preg-conception-date">Conception Date:</label>
                         <input type="date" id="preg-conception-date">
                         <div class="error-message" id="preg-conception-date-error"></div>
                     </div>
                     <div id="preg-edd-input" class="preg-input-group" style="display: none;">
                         <label for="preg-edd-date">EDD:</label>
                         <input type="date" id="preg-edd-date">
                         <div class="error-message" id="preg-edd-date-error"></div>
                     </div>
                      <div id="preg-ultrasound-input" class="preg-input-group" style="display: none;">
                         <label for="preg-us-date">Ultrasound Date:</label>
                         <input type="date" id="preg-us-date">
                         <div class="error-message" id="preg-us-date-error"></div>
                         <label for="preg-us-weeks">Gestational Age at Ultrasound:</label>
                         <div class="row">
                            <div class="col"><input type="number" id="preg-us-weeks" placeholder="Weeks"></div>
                            <div class="col"><input type="number" id="preg-us-days" placeholder="Days (0-6)"></div>
                         </div>
                         <div class="error-message" id="preg-us-ga-error"></div>
                     </div>
                     <div class="form-group">
                         <label for="preg-today-date">Today's Date (for GA calculation):</label>
                         <input type="date" id="preg-today-date">
                     </div>
                     <button id="calculate-preg-dates">Calculate</button>
                     <div class="result-box" id="preg-result">
                         <div class="result-value sub-result" id="preg-edd-result"></div>
                         <div class="result-value sub-result" id="preg-ga-result"></div>
                         <div class="result-value sub-result" id="preg-conception-result"></div>
                         <div class="note"> Note: LMP calculation assumes a 28-day cycle with ovulation on day 14 (Naegele's rule: LMP + 280 days). Conception date adds 266 days. Ultrasound dating is often most accurate, especially in early pregnancy. All dates are estimates. </div>
                     </div>
                 </div>
             </div>

             <!-- 43. NIH Stroke Scale/Score (NIHSS) -->
             <div class="calculator-card" data-calculator-name="nihss nih stroke scale score neurology assessment severity prognosis ischemic stroke hemorrhage">
                 <div class="card-header"> <div class="number">43</div> NIH Stroke Scale (NIHSS) </div>
                 <div class="card-body">
                     <p>Quantifies stroke severity. Sum of scores for each item (Max 42).</p>
                     <div class="form-group"> <label>1a. Level of Consciousness (LOC):</label> <select id="nihss-1a"> <option value="0">0 - Alert</option> <option value="1">1 - Not alert, but arousable by minor stimulation</option> <option value="2">2 - Not alert, requires repeated stimulation</option> <option value="3">3 - Unresponsive or responds only with reflex motor</option> </select> </div>
                     <div class="form-group"> <label>1b. LOC Questions (Month, Age):</label> <select id="nihss-1b"> <option value="0">0 - Answers both correctly</option> <option value="1">1 - Answers one correctly</option> <option value="2">2 - Answers neither correctly</option> </select> </div>
                     <div class="form-group"> <label>1c. LOC Commands (Open/close eyes, Grip/release hand):</label> <select id="nihss-1c"> <option value="0">0 - Performs both correctly</option> <option value="1">1 - Performs one correctly</option> <option value="2">2 - Performs neither correctly</option> </select> </div>
                     <div class="form-group"> <label>2. Best Gaze:</label> <select id="nihss-2"> <option value="0">0 - Normal</option> <option value="1">1 - Partial gaze palsy</option> <option value="2">2 - Forced deviation</option> </select> </div>
                     <div class="form-group"> <label>3. Visual Fields:</label> <select id="nihss-3"> <option value="0">0 - No visual loss</option> <option value="1">1 - Partial hemianopia</option> <option value="2">2 - Complete hemianopia</option> <option value="3">3 - Bilateral hemianopia (blindness)</option> </select> </div>
                     <div class="form-group"> <label>4. Facial Palsy:</label> <select id="nihss-4"> <option value="0">0 - Normal</option> <option value="1">1 - Minor paralysis</option> <option value="2">2 - Partial paralysis</option> <option value="3">3 - Complete paralysis (one or both sides)</option> </select> </div>
                     <div class="form-group"> <label>5. Motor Arm (Left):</label> <select id="nihss-5a"> <option value="0">0 - No drift</option> <option value="1">1 - Drift</option> <option value="2">2 - Some effort against gravity</option> <option value="3">3 - No effort against gravity</option> <option value="4">4 - No movement</option> <option value="9">Untestable (e.g., amputation)</option> </select> </div>
                     <div class="form-group"> <label>5. Motor Arm (Right):</label> <select id="nihss-5b"> <option value="0">0 - No drift</option> <option value="1">1 - Drift</option> <option value="2">2 - Some effort against gravity</option> <option value="3">3 - No effort against gravity</option> <option value="4">4 - No movement</option> <option value="9">Untestable (e.g., amputation)</option> </select> </div>
                     <div class="form-group"> <label>6. Motor Leg (Left):</label> <select id="nihss-6a"> <option value="0">0 - No drift</option> <option value="1">1 - Drift</option> <option value="2">2 - Some effort against gravity</option> <option value="3">3 - No effort against gravity</option> <option value="4">4 - No movement</option> <option value="9">Untestable (e.g., amputation)</option> </select> </div>
                     <div class="form-group"> <label>6. Motor Leg (Right):</label> <select id="nihss-6b"> <option value="0">0 - No drift</option> <option value="1">1 - Drift</option> <option value="2">2 - Some effort against gravity</option> <option value="3">3 - No effort against gravity</option> <option value="4">4 - No movement</option> <option value="9">Untestable (e.g., amputation)</option> </select> </div>
                     <div class="form-group"> <label>7. Limb Ataxia:</label> <select id="nihss-7"> <option value="0">0 - Absent</option> <option value="1">1 - Present in one limb</option> <option value="2">2 - Present in two limbs</option> <option value="9">Untestable (e.g., paralysis)</option> </select> </div>
                     <div class="form-group"> <label>8. Sensory:</label> <select id="nihss-8"> <option value="0">0 - Normal</option> <option value="1">1 - Mild-to-moderate loss</option> <option value="2">2 - Severe-to-total loss</option> </select> </div>
                     <div class="form-group"> <label>9. Best Language:</label> <select id="nihss-9"> <option value="0">0 - No aphasia</option> <option value="1">1 - Mild-to-moderate aphasia</option> <option value="2">2 - Severe aphasia</option> <option value="3">3 - Mute, global aphasia</option> </select> </div>
                     <div class="form-group"> <label>10. Dysarthria:</label> <select id="nihss-10"> <option value="0">0 - Normal articulation</option> <option value="1">1 - Mild-to-moderate dysarthria</option> <option value="2">2 - Severe dysarthria (unintelligible or mute)</option> <option value="9">Untestable (e.g., intubated)</option> </select> </div>
                     <div class="form-group"> <label>11. Extinction and Inattention (Neglect):</label> <select id="nihss-11"> <option value="0">0 - No abnormality</option> <option value="1">1 - Visual, tactile, auditory, spatial, or personal inattention</option> <option value="2">2 - Profound hemi-inattention or extinction</option> </select> </div>
                     <button id="calculate-nihss">Calculate NIHSS Score</button>
                     <div class="result-box" id="nihss-result"> <div class="result-value" id="nihss-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="nihss-level"></div> <p id="nihss-interpretation"></p> </div> <div class="note"> Note: Score interpretation: 0=No stroke, 1-4=Minor, 5-15=Moderate, 16-20=Moderate-Severe, 21-42=Severe. Untestable items (9) are excluded from the sum. Requires certified training for accurate use. </div> </div>
                 </div>
             </div>

             <!-- 44. SOFA Score -->
             <div class="calculator-card" data-calculator-name="sofa sequential organ failure assessment score icu critical care mortality sepsis organ dysfunction respiratory pao2 fio2 coagulation platelets liver bilirubin cardiovascular map hypotension cns gcs renal creatinine urine output">
                 <div class="card-header"> <div class="number">44</div> SOFA Score </div>
                 <div class="card-body">
                     <p>Assesses organ dysfunction/failure severity in ICU patients. Higher score indicates higher mortality.</p>
                     <div class="form-group"> <label>Respiration (PaO₂/FiO₂ ratio):</label> <input type="number" id="sofa-pao2-fio2" placeholder="PaO₂/FiO₂ (e.g., 350)"> <div class="error-message" id="sofa-pao2-fio2-error"></div> <label style="font-size: 0.8em; margin-top: 3px;">(Use PaO₂ in mmHg, FiO₂ as fraction e.g., 0.4 for 40%)</label> <div class="checkbox-option"> <input type="checkbox" id="sofa-mech-vent"> <label for="sofa-mech-vent">Receiving Mechanical Ventilation / CPAP?</label> </div> </div>
                     <div class="form-group"> <label>Coagulation (Platelets x10³/µL):</label> <input type="number" id="sofa-platelets" placeholder="Platelets (e.g., 150)"> <div class="error-message" id="sofa-platelets-error"></div> </div>
                     <div class="form-group"> <label>Liver (Bilirubin):</label> <div class="row"> <div class="col"><input type="number" id="sofa-bilirubin" placeholder="Bilirubin"></div> <div class="col"><select id="sofa-bilirubin-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select></div> </div> <div class="error-message" id="sofa-bilirubin-error"></div> </div>
                     <div class="form-group"> <label>Cardiovascular (Hypotension / Vasopressors):</label> <select id="sofa-cardio"> <option value="0">MAP ≥ 70 mmHg (0pts)</option> <option value="1">MAP < 70 mmHg (1pt)</option> <option value="2">Dopamine ≤ 5 µg/kg/min OR Dobutamine (any dose) (2pts)</option> <option value="3">Dopamine > 5 µg/kg/min OR Epinephrine ≤ 0.1 µg/kg/min OR Norepinephrine ≤ 0.1 µg/kg/min (3pts)</option> <option value="4">Dopamine > 15 µg/kg/min OR Epinephrine > 0.1 µg/kg/min OR Norepinephrine > 0.1 µg/kg/min (4pts)</option> </select> <input type="number" id="sofa-map" placeholder="Enter MAP if no pressors" style="margin-top: 5px;"> <div class="error-message" id="sofa-map-error"></div> </div>
                     <div class="form-group"> <label>Central Nervous System (Glasgow Coma Scale):</label> <input type="number" id="sofa-gcs" placeholder="GCS (3-15)"> <div class="error-message" id="sofa-gcs-error"></div> </div>
                     <div class="form-group"> <label>Renal (Creatinine or Urine Output):</label> <div class="row"> <div class="col"><input type="number" id="sofa-creatinine" placeholder="Creatinine"></div> <div class="col"><select id="sofa-creatinine-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select></div> </div> <div class="error-message" id="sofa-creatinine-error"></div> <label style="margin-top: 5px;">OR Urine Output (mL/day):</label> <input type="number" id="sofa-urine" placeholder="Urine Output (mL/day)"> <div class="error-message" id="sofa-urine-error"></div> </div>
                     <button id="calculate-sofa">Calculate SOFA Score</button>
                     <div class="result-box" id="sofa-result"> <div class="result-value" id="sofa-value"></div> <div class="result-interpretation"> <p id="sofa-interpretation">Total SOFA Score</p> </div> <div class="note"> Note: Score ranges 0-24. Used to track organ dysfunction over time in ICU. Change in SOFA score is prognostic. Sepsis-3 uses change ≥2 points. See specific criteria for points per category. </div> </div>
                 </div>
             </div>

             <!-- 45. MELD-Na Score -->
             <div class="calculator-card" data-calculator-name="meld-na meldna model end stage liver disease sodium unos optn transplant cirrhosis mortality bilirubin inr creatinine dialysis">
                 <div class="card-header"> <div class="number">45</div> MELD-Na Score (UNOS/OPTN) </div>
                 <div class="card-body">
                     <p>Quantifies end-stage liver disease severity for transplant listing, incorporating sodium.</p>
                     <div class="form-group"> <label>Serum Creatinine (mg/dL):</label> <input type="number" id="meld-creat" placeholder="Creatinine (mg/dL)"> <div class="error-message" id="meld-creat-error"></div> </div>
                     <div class="form-group"> <label>Serum Bilirubin (mg/dL):</label> <input type="number" id="meld-bili" placeholder="Bilirubin (mg/dL)"> <div class="error-message" id="meld-bili-error"></div> </div>
                     <div class="form-group"> <label>INR:</label> <input type="number" id="meld-inr" placeholder="INR"> <div class="error-message" id="meld-inr-error"></div> </div>
                     <div class="form-group"> <label>Serum Sodium (mEq/L):</label> <input type="number" id="meld-sodium" placeholder="Sodium (mEq/L)"> <div class="error-message" id="meld-sodium-error"></div> </div>
                     <div class="checkbox-group"> <div class="checkbox-option"> <input type="checkbox" id="meld-dialysis"> <label for="meld-dialysis">Dialysis twice in the past 7 days?</label> </div> </div>
                     <button id="calculate-meld-na">Calculate MELD-Na</button>
                     <div class="result-box" id="meld-na-result"> <div class="result-value" id="meld-na-value"></div> <div class="result-interpretation"> <p id="meld-na-interpretation">MELD-Na Score</p> </div> <div class="note"> Note: Uses UNOS/OPTN 2016 formula. Values capped/floored: Cr ≥1.2 floored to 1.2 if dialysis, max 4.0; Bili/INR floored to 1.0; Na 125-137 mEq/L. Score range 6-40. Predicts 3-month mortality. </div> </div>
                 </div>
             </div>

             <!-- 46. ABG Analyzer -->
             <div class="calculator-card" data-calculator-name="abg arterial blood gas analyzer interpretation ph pco2 hco3 bicarbonate acidosis alkalosis respiratory metabolic compensation anion gap delta ratio winter's formula">
                 <div class="card-header"> <div class="number">46</div> ABG Analyzer </div>
                 <div class="card-body">
                     <p>Interprets Arterial Blood Gas results.</p>
                     <div class="form-group"> <label for="abg-ph">pH:</label> <input type="number" step="0.01" id="abg-ph" placeholder="pH (e.g., 7.40)"> <div class="error-message" id="abg-ph-error"></div> </div>
                     <div class="form-group"> <label for="abg-pco2">PaCO₂ (mmHg):</label> <input type="number" id="abg-pco2" placeholder="PaCO₂"> <div class="error-message" id="abg-pco2-error"></div> </div>
                     <div class="form-group"> <label for="abg-hco3">HCO₃⁻ (mEq/L):</label> <input type="number" id="abg-hco3" placeholder="Bicarbonate"> <div class="error-message" id="abg-hco3-error"></div> </div>
                     <div class="form-group"> <label for="abg-na">Sodium (mEq/L) (Optional, for AG):</label> <input type="number" id="abg-na" placeholder="Na⁺"> <div class="error-message" id="abg-na-error"></div> </div>
                     <div class="form-group"> <label for="abg-cl">Chloride (mEq/L) (Optional, for AG):</label> <input type="number" id="abg-cl" placeholder="Cl⁻"> <div class="error-message" id="abg-cl-error"></div> </div>
                     <button id="calculate-abg">Analyze ABG</button>
                     <div class="result-box" id="abg-result">
                         <div class="result-value" id="abg-primary-disorder"></div>
                         <div class="result-interpretation" id="abg-compensation"></div>
                         <div id="abg-anion-gap-section" style="display: none;">
                             <div class="result-value sub-result" id="abg-anion-gap-value"></div>
                             <div class="result-interpretation" id="abg-anion-gap-interp"></div>
                         </div>
                          <div id="abg-delta-ratio-section" style="display: none;">
                             <div class="result-value sub-result" id="abg-delta-ratio-value"></div>
                             <div class="result-interpretation" id="abg-delta-ratio-interp"></div>
                         </div>
                         <div id="abg-winters-section" style="display: none;">
                             <div class="result-value sub-result" id="abg-winters-value"></div>
                             <div class="result-interpretation" id="abg-winters-interp"></div>
                         </div>
                         <div class="note"> Note: Interpretation based on standard ranges (pH 7.35-7.45, PaCO₂ 35-45, HCO₃⁻ 22-26). Compensation rules applied (e.g., Winter's formula for metabolic acidosis). Anion Gap = Na - (Cl + HCO₃). Delta Ratio = (AG - 12) / (24 - HCO₃). </div>
                     </div>
                 </div>
             </div>

             <!-- 47. ASCVD Risk Calculator (2013 AHA/ACC) -->
             <div class="calculator-card" data-calculator-name="ascvd atherosclerotic cardiovascular disease risk calculator aha acc 2013 pooled cohort equations pce 10 year mi stroke death cholesterol bp diabetes smoking age gender race">
                 <div class="card-header"> <div class="number">47</div> ASCVD Risk Score (2013) </div>
                 <div class="card-body">
                     <p>Estimates 10-year risk of hard ASCVD (MI, stroke, CHD/stroke death) using Pooled Cohort Equations.</p>
                     <div class="form-group"> <label for="ascvd-age">Age (years, 40-79):</label> <input type="number" id="ascvd-age" placeholder="Age"> <div class="error-message" id="ascvd-age-error"></div> </div>
                     <div class="form-group"> <label for="ascvd-gender">Gender:</label> <select id="ascvd-gender"> <option value="female">Female</option> <option value="male">Male</option> </select> </div>
                     <div class="form-group"> <label for="ascvd-race">Race:</label> <select id="ascvd-race"> <option value="white">White</option> <option value="aa">African American</option> <option value="other">Other (Use White coeffs)</option> </select> </div>
                     <div class="form-group"> <label for="ascvd-tc">Total Cholesterol (mg/dL):</label> <input type="number" id="ascvd-tc" placeholder="Total Chol"> <div class="error-message" id="ascvd-tc-error"></div> </div>
                     <div class="form-group"> <label for="ascvd-hdl">HDL Cholesterol (mg/dL):</label> <input type="number" id="ascvd-hdl" placeholder="HDL Chol"> <div class="error-message" id="ascvd-hdl-error"></div> </div>
                     <div class="form-group"> <label for="ascvd-sbp">Systolic Blood Pressure (mmHg):</label> <input type="number" id="ascvd-sbp" placeholder="SBP"> <div class="error-message" id="ascvd-sbp-error"></div> </div>
                     <div class="checkbox-group" style="padding: 5px; border: none;">
                         <div class="checkbox-option"> <input type="checkbox" id="ascvd-bp-treated"> <label for="ascvd-bp-treated">On treatment for High Blood Pressure?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="ascvd-diabetes"> <label for="ascvd-diabetes">History of Diabetes?</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="ascvd-smoker"> <label for="ascvd-smoker">Current Smoker?</label> </div>
                     </div>
                     <button id="calculate-ascvd">Calculate 10-Year Risk</button>
                     <div class="result-box" id="ascvd-result">
                         <div class="result-value" id="ascvd-value"></div>
                         <div class="result-interpretation">
                             <div class="interpretation-level" id="ascvd-level"></div>
                             <p id="ascvd-interpretation">10-Year ASCVD Risk</p>
                         </div>
                         <div class="result-value sub-result" id="ascvd-lifetime-value" style="display: none;"></div>
                         <div class="result-interpretation" id="ascvd-lifetime-interp" style="display: none;"></div>
                         <div class="note"> Note: Based on 2013 ACC/AHA Guideline Pooled Cohort Equations. Validated for ages 40-79, White and African American individuals without prior ASCVD. Risk thresholds for statin therapy: Low (<5%), Borderline (5-<7.5%), Intermediate (7.5-<20%), High (≥20%). Consider risk enhancers/discussion. </div>
                     </div>
                 </div>
             </div>

             <!-- 48. PSI/PORT Score -->
             <div class="calculator-card" data-calculator-name="psi port score pneumonia severity index community acquired cap mortality risk admission outpatient inpatient age nursing home cancer liver chf cvd renal ams rr sbp temp ph bun sodium glucose hematocrit pao2 pleural effusion">
                 <div class="card-header"> <div class="number">48</div> PSI/PORT Score for Pneumonia </div>
                 <div class="card-body">
                     <p>Estimates mortality for adult patients with community-acquired pneumonia (CAP) to guide site-of-care decisions.</p>
                     <div class="form-group"> <label>Age (years):</label> <input type="number" id="psi-age" placeholder="Age"> <div class="error-message" id="psi-age-error"></div> </div>
                     <div class="form-group"> <label>Gender:</label> <select id="psi-gender"> <option value="male">Male</option> <option value="female">Female</option> </select> </div>
                     <div class="checkbox-group"> <label>Demographics:</label> <div class="checkbox-option"> <input type="checkbox" id="psi-nursing-home"> <label for="psi-nursing-home">Nursing Home Resident (+10)</label> </div> </div>
                     <div class="checkbox-group"> <label>Comorbidities:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-cancer"> <label for="psi-cancer">Neoplastic Disease (+30)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-liver"> <label for="psi-liver">Liver Disease (+20)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-chf"> <label for="psi-chf">Congestive Heart Failure (+10)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-cvd"> <label for="psi-cvd">Cerebrovascular Disease (+10)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-renal"> <label for="psi-renal">Renal Disease (+10)</label> </div>
                     </div>
                     <div class="checkbox-group"> <label>Physical Exam Findings:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-ams"> <label for="psi-ams">Altered Mental Status (+20)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-rr"> <label for="psi-rr">Respiratory Rate ≥ 30/min (+20)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-sbp"> <label for="psi-sbp">Systolic BP < 90 mmHg (+20)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-temp"> <label for="psi-temp">Temperature < 35°C (95°F) or ≥ 40°C (104°F) (+15)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-hr"> <label for="psi-hr">Pulse ≥ 125/min (+10)</label> </div>
                     </div>
                     <div class="form-group"> <label>Laboratory/Imaging Findings:</label>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-ph"> <label for="psi-ph">Arterial pH < 7.35 (+30)</label> </div>
                         <div class="form-group" style="margin-left: 20px;"> <label>BUN:</label> <div class="row"> <div class="col"><input type="number" id="psi-bun" placeholder="BUN"></div> <div class="col"><select id="psi-bun-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select></div> </div> <label style="font-size: 0.8em;">(≥30 mg/dL or ≥11 mmol/L Urea adds +20)</label> <div class="error-message" id="psi-bun-error"></div> </div>
                         <div class="form-group" style="margin-left: 20px;"> <label>Sodium (mEq/L):</label> <input type="number" id="psi-sodium" placeholder="Na⁺"> <label style="font-size: 0.8em;">(< 130 mEq/L adds +20)</label> <div class="error-message" id="psi-sodium-error"></div> </div>
                         <div class="form-group" style="margin-left: 20px;"> <label>Glucose:</label> <div class="row"> <div class="col"><input type="number" id="psi-glucose" placeholder="Glucose"></div> <div class="col"><select id="psi-glucose-unit"> <option value="mg/dL">mg/dL</option> <option value="mmol/L">mmol/L</option> </select></div> </div> <label style="font-size: 0.8em;">(≥250 mg/dL or ≥14 mmol/L adds +10)</label> <div class="error-message" id="psi-glucose-error"></div> </div>
                         <div class="form-group" style="margin-left: 20px;"> <label>Hematocrit (%):</label> <input type="number" id="psi-hct" placeholder="Hct"> <label style="font-size: 0.8em;">(< 30% adds +10)</label> <div class="error-message" id="psi-hct-error"></div> </div>
                         <div class="form-group" style="margin-left: 20px;"> <label>PaO₂ (mmHg) or O₂ Sat (%):</label> <input type="number" id="psi-pao2" placeholder="PaO₂ (mmHg)"> <label style="font-size: 0.8em;">(< 60 mmHg adds +10)</label> <div class="error-message" id="psi-pao2-error"></div> <input type="number" id="psi-sat" placeholder="O₂ Sat (%)" style="margin-top: 5px;"> <label style="font-size: 0.8em;">(Use if PaO₂ unavailable. < 90% adds +10)</label> <div class="error-message" id="psi-sat-error"></div> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="psi-pleural-effusion"> <label for="psi-pleural-effusion">Pleural Effusion on CXR (+10)</label> </div>
                     </div>
                     <button id="calculate-psi">Calculate PSI Score</button>
                     <div class="result-box" id="psi-result"> <div class="result-value" id="psi-value"></div> <div class="result-interpretation"> <div class="interpretation-level" id="psi-level"></div> <p id="psi-interpretation"></p> </div> <div class="note"> Note: Risk Class / Mortality / Recommendation: I (≤50, 0.1%, Outpt), II (51-70, 0.6%, Outpt), III (71-90, 0.9-2.8%, Outpt/Obs), IV (91-130, 8.2-9.3%, Inpt), V (>130, 27-29.2%, Inpt/ICU). Age points = Age (male) or Age-10 (female). </div> </div>
                 </div>
             </div>

             <!-- 49. Sodium Correction Rate -->
             <div class="calculator-card" data-calculator-name="sodium correction rate hyponatremia hypernatremia fluid management iv fluids rate volume change serum na adrogue madias formula dextrose saline free water deficit">
                 <div class="card-header"> <div class="number">49</div> Sodium Correction Rate </div>
                 <div class="card-body">
                     <p>Estimates the change in serum sodium after 1L of IV fluid (Adrogue-Madias formula) and calculates infusion rate for desired correction speed.</p>
                     <div class="form-group"> <label for="nacorr-current-na">Current Serum Na⁺ (mEq/L):</label> <input type="number" id="nacorr-current-na" placeholder="Current Na⁺"> <div class="error-message" id="nacorr-current-na-error"></div> </div>
                     <div class="form-group"> <label for="nacorr-target-na">Target Serum Na⁺ (mEq/L):</label> <input type="number" id="nacorr-target-na" placeholder="Target Na⁺ (e.g., 130)"> <div class="error-message" id="nacorr-target-na-error"></div> </div>
                     <div class="form-group"> <label for="nacorr-weight">Weight (kg):</label> <input type="number" id="nacorr-weight" placeholder="Weight (kg)"> <div class="error-message" id="nacorr-weight-error"></div> </div>
                     <div class="form-group"> <label for="nacorr-gender">Gender (for TBW estimate):</label> <select id="nacorr-gender"> <option value="male">Male</option> <option value="female">Female</option> <option value="elderly_male">Elderly Male (≥65)</option> <option value="elderly_female">Elderly Female (≥65)</option> </select> </div>
                     <div class="form-group"> <label for="nacorr-fluid-type">IV Fluid Type:</label>
                         <select id="nacorr-fluid-type">
                             <option value="154">0.9% NaCl (Normal Saline)</option>
                             <option value="513">3% NaCl (Hypertonic Saline)</option>
                             <option value="77">0.45% NaCl (Half Normal)</option>
                             <option value="0">D5W (5% Dextrose in Water)</option>
                             <option value="130">Lactated Ringer's (LR)</option>
                             <option value="custom">Custom Na+K (mEq/L)</option>
                         </select>
                         <input type="number" id="nacorr-custom-na-k" placeholder="Enter Na+K in fluid (mEq/L)" style="display: none; margin-top: 5px;">
                     </div>
                     <div class="form-group"> <label for="nacorr-rate-hours">Desired Correction Time (hours):</label> <input type="number" id="nacorr-rate-hours" placeholder="Hours (e.g., 24)"> <div class="error-message" id="nacorr-rate-hours-error"></div> <label style="font-size: 0.8em; margin-top: 3px;">(Max recommended rate often ≤ 8-10 mEq/L per 24h for hyponatremia)</label> </div>
                     <button id="calculate-nacorr">Calculate</button>
                     <div class="result-box" id="nacorr-result">
                         <div class="result-value sub-result" id="nacorr-tbw-result"></div>
                         <div class="result-value sub-result" id="nacorr-change-per-liter"></div>
                         <div class="result-value sub-result" id="nacorr-infusion-rate"></div>
                         <div class="result-value sub-result" id="nacorr-total-volume" style="display: none;"></div>
                         <div class="note"> Note: Change in Na⁺ ≈ (Infusate [Na+K] - Serum Na⁺) / (TBW + 1). TBW ≈ Weight * (0.6 Male, 0.5 Female/Elderly Male, 0.45 Elderly Female). This is an estimate; frequent Na⁺ monitoring is crucial. Risk of ODS with rapid correction of chronic hyponatremia. </div>
                     </div>
                 </div>
             </div>

             <!-- 50. GRACE ACS Risk Score -->
             <div class="calculator-card" data-calculator-name="grace acs risk score acute coronary syndrome mortality prediction mi myocardial infarction unstable angina nstemi stemi age heart rate sbp creatinine cardiac arrest st deviation enzymes killip class">
                 <div class="card-header"> <div class="number">50</div> GRACE ACS Risk Score </div>
                 <div class="card-body">
                     <p>Estimates in-hospital and 6-month mortality for patients with Acute Coronary Syndrome (ACS).</p>
                     <div class="form-group"> <label>Age (years):</label> <input type="number" id="grace-age" placeholder="Age"> <div class="error-message" id="grace-age-error"></div> </div>
                     <div class="form-group"> <label>Heart Rate (bpm):</label> <input type="number" id="grace-hr" placeholder="Heart Rate"> <div class="error-message" id="grace-hr-error"></div> </div>
                     <div class="form-group"> <label>Systolic Blood Pressure (mmHg):</label> <input type="number" id="grace-sbp" placeholder="SBP"> <div class="error-message" id="grace-sbp-error"></div> </div>
                     <div class="form-group"> <label>Serum Creatinine:</label> <div class="row"> <div class="col"><input type="number" id="grace-creat" placeholder="Creatinine"></div> <div class="col"><select id="grace-creat-unit"> <option value="mg/dL">mg/dL</option> <option value="μmol/L">μmol/L</option> </select></div> </div> <div class="error-message" id="grace-creat-error"></div> </div>
                     <div class="form-group"> <label>Killip Class:</label> <select id="grace-killip"> <option value="0">I (No CHF signs) (0pts)</option> <option value="20">II (Rales, JVD, S3) (20pts)</option> <option value="39">III (Pulmonary edema) (39pts)</option> <option value="59">IV (Cardiogenic shock) (59pts)</option> </select> </div>
                     <div class="checkbox-group" style="padding: 5px; border: none;">
                         <div class="checkbox-option"> <input type="checkbox" id="grace-arrest"> <label for="grace-arrest">Cardiac Arrest at Admission? (+39)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="grace-st-deviation"> <label for="grace-st-deviation">ST Segment Deviation? (+28)</label> </div>
                         <div class="checkbox-option"> <input type="checkbox" id="grace-enzymes"> <label for="grace-enzymes">Elevated Cardiac Enzymes? (+14)</label> </div>
                     </div>
                     <button id="calculate-grace">Calculate GRACE Score</button>
                     <div class="result-box" id="grace-result">
                         <div class="result-value" id="grace-value"></div>
                         <div class="result-interpretation">
                             <p id="grace-interpretation">GRACE Score</p>
                         </div>
                         <div class="result-value sub-result" id="grace-in-hospital-mortality"></div>
                         <div class="result-interpretation" id="grace-in-hospital-interp"></div>
                         <div class="result-value sub-result" id="grace-6-month-mortality"></div>
                         <div class="result-interpretation" id="grace-6-month-interp"></div>
                         <div class="note"> Note: Score predicts risk. In-hospital mortality risk groups: Low (≤108, <1%), Intermediate (109-140, 1-3%), High (>140, >3%). 6-month mortality risk groups: Low (≤88, <3%), Intermediate (89-118, 3-8%), High (>118, >8%). Guides intensity of therapy/invasive strategy. </div>
                     </div>
                 </div>
             </div>

             <!-- 51. APACHE II Score -->
             <div class="calculator-card" data-calculator-name="apache ii apache2 acute physiology chronic health evaluation icu critical care mortality prediction score temperature map heart rate respiratory rate oxygenation ph sodium potassium creatinine hct wbc gcs age chronic health points">
                 <div class="card-header"> <div class="number">51</div> APACHE II Score </div>
                 <div class="card-body">
                     <p>Estimates ICU mortality based on Acute Physiology Score (APS), Age Points, and Chronic Health Points.</p>
                     <!-- Acute Physiology Score (APS) - 12 variables -->
                     <div class="form-group"> <label>Temperature (°C, Rectal):</label> <input type="number" step="0.1" id="apache-temp" placeholder="Temp (°C)"> <div class="error-message" id="apache-temp-error"></div> </div>
                     <div class="form-group"> <label>Mean Arterial Pressure (MAP, mmHg):</label> <input type="number" id="apache-map" placeholder="MAP"> <div class="error-message" id="apache-map-error"></div> </div>
                     <div class="form-group"> <label>Heart Rate (bpm):</label> <input type="number" id="apache-hr" placeholder="Heart Rate"> <div class="error-message" id="apache-hr-error"></div> </div>
                     <div class="form-group"> <label>Respiratory Rate (breaths/min):</label> <input type="number" id="apache-rr" placeholder="Resp Rate"> <div class="error-message" id="apache-rr-error"></div> </div>
                     <div class="form-group"> <label>Oxygenation (Choose one):</label>
                         <div style="margin-left: 15px;">
                             <label>A-aDO₂ (mmHg) if FiO₂ ≥ 0.5:</label> <input type="number" id="apache-aado2" placeholder="A-a Gradient"> <div class="error-message" id="apache-aado2-error"></div>
                             <label>PaO₂ (mmHg) if FiO₂ < 0.5:</label> <input type="number" id="apache-pao2" placeholder="PaO₂"> <div class="error-message" id="apache-pao2-error"></div>
                         </div>
                     </div>
                     <div class="form-group"> <label>Arterial pH:</label> <input type="number" step="0.01" id="apache-ph" placeholder="pH"> <div class="error-message" id="apache-ph-error"></div> </div>
                     <div class="form-group"> <label>Serum Sodium (mEq/L):</label> <input type="number" id="apache-sodium" placeholder="Na⁺"> <div class="error-message" id="apache-sodium-error"></div> </div>
                     <div class="form-group"> <label>Serum Potassium (mEq/L):</label> <input type="number" step="0.1" id="apache-potassium" placeholder="K⁺"> <div class="error-message" id="apache-potassium-error"></div> </div>
                     <div class="form-group"> <label>Serum Creatinine (mg/dL):</label> <input type="number" step="0.1" id="apache-creat" placeholder="Creatinine"> <div class="error-message" id="apache-creat-error"></div> <div class="checkbox-option"> <input type="checkbox" id="apache-arf"> <label for="apache-arf">Acute Renal Failure? (Doubles Cr points)</label> </div> </div>
                     <div class="form-group"> <label>Hematocrit (%):</label> <input type="number" step="0.1" id="apache-hct" placeholder="Hct"> <div class="error-message" id="apache-hct-error"></div> </div>
                     <div class="form-group"> <label>White Blood Cell Count (WBC, K/µL):</label> <input type="number" step="0.1" id="apache-wbc" placeholder="WBC (e.g., 15.0)"> <div class="error-message" id="apache-wbc-error"></div> </div>
                     <div class="form-group"> <label>Glasgow Coma Scale (GCS):</label> <input type="number" id="apache-gcs" placeholder="GCS (3-15)"> <div class="error-message" id="apache-gcs-error"></div> <label style="font-size: 0.8em;">Score = 15 - Actual GCS</label> </div>
                     <!-- Age Points -->
                     <div class="form-group"> <label>Age (years):</label> <input type="number" id="apache-age" placeholder="Age"> <div class="error-message" id="apache-age-error"></div> </div>
                     <!-- Chronic Health Points -->
                     <div class="form-group"> <label>Chronic Health Status:</label> <select id="apache-chronic"> <option value="0">No severe insufficiency</option> <option value="2">Post-Emergency Surgery</option> <option value="5">Post-Elective Surgery OR Nonoperative with severe insufficiency</option> </select> <label style="font-size: 0.8em;">(Severe: Liver cirrhosis, NYHA IV CHF, Severe COPD, Chronic Dialysis, Immunocompromised)</label> </div>

                     <button id="calculate-apache">Calculate APACHE II Score</button>
                     <div class="result-box" id="apache-result">
                         <div class="result-value" id="apache-value"></div>
                         <div class="result-interpretation">
                             <p id="apache-interpretation">APACHE II Score</p>
                         </div>
                         <div class="result-value sub-result" id="apache-mortality"></div>
                         <div class="result-interpretation" id="apache-mortality-interp"></div>
                         <div class="note"> Note: Uses worst value in first 24h ICU stay. Score = APS + Age Points + Chronic Health Points. Mortality estimate is approximate and varies by diagnosis. APS max 60, Age max 6, Chronic max 5. Total max 71. </div>
                     </div>
                 </div>
             </div>


            <!-- END OF CALCULATORS -->
        </div> <!-- /.calculators-grid -->
    </div> <!-- /.container -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calculatorCards = document.querySelectorAll('.calculator-card');
            const searchInput = document.getElementById('calculatorSearch');

            // --- Card Expansion/Collapse ---
            calculatorCards.forEach(card => {
                const header = card.querySelector('.card-header');
                const body = card.querySelector('.card-body');
                if (header && body) {
                    header.addEventListener('click', () => {
                        // Close other active cards OPTIONALLY
                        // document.querySelectorAll('.card-body.active').forEach(activeBody => {
                        //     if (activeBody !== body && activeBody.classList.contains('active')) {
                        //          activeBody.classList.remove('active');
                        //     }
                        // });
                        body.classList.toggle('active');
                         // Scroll card into view if opening and partially off-screen (optional)
                         // if (body.classList.contains('active')) {
                         //     setTimeout(() => { // Allow time for animation
                         //         card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                         //     }, 310);
                         // }
                    });
                }
            });

             // --- Search Functionality ---
             if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    let found = false;
                    calculatorCards.forEach(card => {
                        const cardName = (card.dataset.calculatorName || card.querySelector('.card-header')?.textContent || '').toLowerCase();
                        const isVisible = searchTerm === '' || cardName.includes(searchTerm);
                        card.style.display = isVisible ? 'block' : 'none';
                        if(isVisible) found = true;
                    });
                    // Optional: Add a "no results found" message
                    // const noResultsEl = document.getElementById('no-results'); // Need to add this div in HTML
                    // if(noResultsEl) noResultsEl.style.display = found ? 'none' : 'block';
                });
            }

            // --- Utility Functions ---
            function getValue(id) { const el = document.getElementById(id); return el ? el.value : null; }
            function getNumericValue(id) { const v = getValue(id); return v ? parseFloat(v) : NaN; }
            function setHtml(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; }
            function setInterpretation(levelId, interpId, levelClass, levelText, interpText) {
                const levelEl = document.getElementById(levelId);
                const interpEl = document.getElementById(interpId);
                if (levelEl) { levelEl.className = `interpretation-level ${levelClass}`; levelEl.textContent = levelText; }
                if (interpEl) { interpEl.textContent = interpText; }
            }
            function showResultBox(id) { const el = document.getElementById(id); if (el) el.classList.add('active'); }
            function hideResultBox(id) { const el = document.getElementById(id); if (el) el.classList.remove('active'); }
            function clearErrors(errorIds) { errorIds.forEach(id => setHtml(id, '')); }
            function displayError(id, message) { setHtml(id, message); }
            function isValidNumber(value) { return !isNaN(value); }
            function isValidPositiveNumber(value) { return isValidNumber(value) && value > 0; }
            function isValidNonNegativeNumber(value) { return isValidNumber(value) && value >= 0; }

            // --- Unit Conversion Constants ---
            const KG_PER_LB = 0.453592;
            const CM_PER_IN = 2.54;
            const M_PER_CM = 0.01;
            const M_PER_FT = 0.3048;
            const SCR_UMOL_PER_MG = 88.4;
            const GLUC_MG_PER_MMOL = 18.0182;
            const BUN_MG_PER_MMOL_UREA = 0.357; // Urea (mmol/L) = BUN (mg/dL) * 0.357
            const BUN_MG_PER_UREA_MG = 0.467; // BUN (mg/dL) = Urea (mg/dL) * 0.467
            const CHOL_MG_PER_MMOL = 38.67; // For TC, HDL, LDL
             const TG_MG_PER_MMOL = 88.57; // For Triglycerides
            const ETHANOL_MG_PER_DL_DIVISOR = 4.6; // For osmolality calc
            const CA_MG_PER_MMOL = 4.008; // More precise
            const ALB_G_PER_L_DIVISOR = 10; // g/L to g/dL


            // --- Calculation Logic ---

            // CALCULATORS 1-16 (Assumed correct from previous steps, only minor tweaks if needed)
            // ... (Include JS logic for calculators 1-16 here) ...
            // 1. BMI Calculator
             const calculateBmiBtn = document.getElementById('calculate-bmi'); if (calculateBmiBtn) { calculateBmiBtn.addEventListener('click', () => { clearErrors(['bmi-weight-error', 'bmi-height-error']); hideResultBox('bmi-result'); let weight = getNumericValue('bmi-weight'); const weightUnit = getValue('bmi-weight-unit'); let height = getNumericValue('bmi-height'); const heightUnit = getValue('bmi-height-unit'); let valid = true; if (!isValidPositiveNumber(weight)) { displayError('bmi-weight-error', 'Enter valid weight.'); valid = false; } if (!isValidPositiveNumber(height)) { displayError('bmi-height-error', 'Enter valid height.'); valid = false; } if (!valid) return; let weightKg = (weightUnit === 'lb') ? weight * KG_PER_LB : weight; let heightM = height; let heightCm = height; if (heightUnit === 'cm') { heightM = height * M_PER_CM; heightCm = height; } else if (heightUnit === 'in') { heightM = height * CM_PER_IN * M_PER_CM; heightCm = height * CM_PER_IN; } else if (heightUnit === 'ft') { heightM = height * M_PER_FT; heightCm = height * M_PER_FT * 100; } else { heightCm = height * 100; } const bmi = weightKg / (heightM * heightM); const bsa = Math.sqrt((heightCm * weightKg) / 3600); setHtml('bmi-value', `BMI: ${bmi.toFixed(1)} kg/m²`); setHtml('bsa-value', `BSA: ${bsa.toFixed(2)} m²`); let lvlClass = 'info', lvlText = 'N/A', interp = ''; if (bmi < 18.5) { lvlClass = 'warning'; lvlText = 'Underweight'; interp = 'BMI < 18.5'; } else if (bmi < 25) { lvlClass = 'normal'; lvlText = 'Normal'; interp = 'BMI 18.5-24.9'; } else if (bmi < 30) { lvlClass = 'warning'; lvlText = 'Overweight'; interp = 'BMI 25-29.9'; } else if (bmi < 35) { lvlClass = 'danger'; lvlText = 'Obesity I'; interp = 'BMI 30-34.9'; } else if (bmi < 40) { lvlClass = 'danger'; lvlText = 'Obesity II'; interp = 'BMI 35-39.9'; } else { lvlClass = 'danger'; lvlText = 'Obesity III'; interp = 'BMI ≥ 40'; } setInterpretation('bmi-level', 'bmi-interpretation', lvlClass, lvlText, interp); showResultBox('bmi-result'); }); }
            // 2. Creatinine Clearance (Cockcroft-Gault)
            const calculateCrclBtn = document.getElementById('calculate-crcl'); if (calculateCrclBtn) { calculateCrclBtn.addEventListener('click', () => { clearErrors(['crcl-age-error', 'crcl-weight-error', 'crcl-scr-error']); hideResultBox('crcl-result'); const age = getNumericValue('crcl-age'); const gender = getValue('crcl-gender'); let weight = getNumericValue('crcl-weight'); const weightUnit = getValue('crcl-weight-unit'); let scr = getNumericValue('crcl-scr'); const scrUnit = getValue('crcl-scr-unit'); let valid = true; if (!isValidPositiveNumber(age) || age < 18) { displayError('crcl-age-error', 'Valid age (≥18) required.'); valid = false; } if (!isValidPositiveNumber(weight)) { displayError('crcl-weight-error', 'Valid weight required.'); valid = false; } if (!isValidPositiveNumber(scr)) { displayError('crcl-scr-error', 'Valid SCr required.'); valid = false; } if (!valid) return; let weightKg = (weightUnit === 'lb') ? weight * KG_PER_LB : weight; let scrMgDl = (scrUnit === 'μmol/L') ? scr / SCR_UMOL_PER_MG : scr; if(scrMgDl <= 0) { displayError('crcl-scr-error', 'SCr must be positive.'); return; } let crcl = ((140 - age) * weightKg) / (72 * scrMgDl); if (gender === 'female') { crcl *= 0.85; } setHtml('crcl-value', `CrCl: ${crcl.toFixed(1)} mL/min`); let lvlClass = 'info', lvlText = 'Renal Function', interp = ''; if (crcl >= 90) { lvlClass = 'normal'; lvlText = 'Normal/High'; interp = 'Est. CrCl ≥ 90'; } else if (crcl >= 60) { lvlClass = 'normal'; lvlText = 'Mild ↓'; interp = 'Est. CrCl 60-89'; } else if (crcl >= 45) { lvlClass = 'warning'; lvlText = 'Mild-Mod ↓'; interp = 'Est. CrCl 45-59'; } else if (crcl >= 30) { lvlClass = 'warning'; lvlText = 'Mod-Sev ↓'; interp = 'Est. CrCl 30-44'; } else if (crcl >= 15) { lvlClass = 'danger'; lvlText = 'Severe ↓'; interp = 'Est. CrCl 15-29'; } else { lvlClass = 'danger'; lvlText = 'Failure'; interp = 'Est. CrCl < 15'; } setInterpretation('crcl-level', 'crcl-interpretation', lvlClass, lvlText, interp); showResultBox('crcl-result'); }); }
            // 3. CHA₂DS₂-VASc Score
            const calculateChadsBtn = document.getElementById('calculate-chads'); if (calculateChadsBtn) { calculateChadsBtn.addEventListener('click', () => { clearErrors(['chads-error']); hideResultBox('chads-result'); let score = 0; let age75 = false, age65 = false; const checkboxes = ['chads-chf', 'chads-htn', 'chads-age75', 'chads-diabetes', 'chads-stroke', 'chads-vascular', 'chads-age65', 'chads-female']; checkboxes.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) { if (id === 'chads-age75') age75 = true; if (id === 'chads-age65') age65 = true; score += parseFloat(cb.value); } }); if (age75 && age65) { score -= 1; displayError('chads-error', 'Note: Age ≥75 overrides 65-74.'); } setHtml('chads-value', `Score: ${score}`); let lvlClass = 'info', lvlText = 'Risk', interp = 'Consult guidelines.'; const female = document.getElementById('chads-female')?.checked; if ((!female && score === 0) || (female && score === 1)) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'Consider omitting therapy (Male 0, Female 1).'; } else if ((!female && score === 1) || (female && score === 2)) { lvlClass = 'warning'; lvlText = 'Intermediate'; interp = 'Consider OAC (Male 1, Female 2).'; } else { lvlClass = 'danger'; lvlText = 'High'; interp = 'OAC Recommended (Male ≥2, Female ≥3).'; } setInterpretation('chads-level', 'chads-interpretation', lvlClass, lvlText, interp); showResultBox('chads-result'); }); }
            // 4. CKD-EPI Equation (2021 Race-Free)
            const calculateCkdBtn = document.getElementById('calculate-ckd'); if (calculateCkdBtn) { calculateCkdBtn.addEventListener('click', () => { clearErrors(['ckd-age-error', 'ckd-scr-error']); hideResultBox('ckd-result'); const age = getNumericValue('ckd-age'); const gender = getValue('ckd-gender'); let scr = getNumericValue('ckd-scr'); const scrUnit = getValue('ckd-scr-unit'); let valid = true; if (!isValidPositiveNumber(age) || age < 18) { displayError('ckd-age-error', 'Valid age (≥18) required.'); valid = false; } if (!isValidPositiveNumber(scr)) { displayError('ckd-scr-error', 'Valid SCr required.'); valid = false; } if (!valid) return; let scrMgDl = (scrUnit === 'μmol/L') ? scr / SCR_UMOL_PER_MG : scr; if(scrMgDl <= 0) { displayError('ckd-scr-error', 'SCr must be positive.'); return; } let kappa = (gender === 'female') ? 0.7 : 0.9; let alpha = (gender === 'female') ? -0.241 : -0.302; let femaleFactor = (gender === 'female') ? 1.012 : 1.0; let egfr = 142 * Math.pow(Math.min(scrMgDl / kappa, 1.0), alpha) * Math.pow(Math.max(scrMgDl / kappa, 1.0), -1.200) * Math.pow(0.9938, age) * femaleFactor; setHtml('ckd-value', `eGFR: ${egfr.toFixed(0)} mL/min/1.73m²`); let lvlClass = 'info', lvlText = 'Stage', interp = ''; if (egfr >= 90) { lvlClass = 'normal'; lvlText = 'G1'; interp = 'Normal/High eGFR (≥90). CKD if damage markers present.'; } else if (egfr >= 60) { lvlClass = 'normal'; lvlText = 'G2'; interp = 'Mildly ↓ (60-89). CKD if damage markers present.'; } else if (egfr >= 45) { lvlClass = 'warning'; lvlText = 'G3a'; interp = 'Mild-Mod ↓ (45-59).'; } else if (egfr >= 30) { lvlClass = 'warning'; lvlText = 'G3b'; interp = 'Mod-Sev ↓ (30-44).'; } else if (egfr >= 15) { lvlClass = 'danger'; lvlText = 'G4'; interp = 'Severely ↓ (15-29).'; } else { lvlClass = 'danger'; lvlText = 'G5'; interp = 'Kidney Failure (<15).'; } setInterpretation('ckd-level', 'ckd-interpretation', lvlClass, lvlText, interp); showResultBox('ckd-result'); }); }
            // 5. Wells' Criteria for DVT
            const calculateDvtBtn = document.getElementById('calculate-dvt'); if (calculateDvtBtn) { calculateDvtBtn.addEventListener('click', () => { hideResultBox('dvt-result'); let score = 0; const checkboxes = ['dvt-cancer', 'dvt-paralysis', 'dvt-bedridden', 'dvt-tenderness', 'dvt-swelling', 'dvt-calf', 'dvt-pitting', 'dvt-collateral', 'dvt-history', 'dvt-alternative']; checkboxes.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) score += parseFloat(cb.value); }); setHtml('dvt-value', `Score: ${score}`); let lvlClass = 'info', lvlText = 'Probability', interp = ''; if (score <= 1) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'DVT Unlikely (Score ≤ 1). Consider D-dimer.'; } else { lvlClass = 'danger'; lvlText = 'High'; interp = 'DVT Likely (Score ≥ 2). Consider imaging.'; } setInterpretation('dvt-level', 'dvt-interpretation', lvlClass, lvlText, interp); showResultBox('dvt-result'); }); }
            // 6. Wells' Criteria for PE
             const calculatePeBtn = document.getElementById('calculate-pe'); if (calculatePeBtn) { calculatePeBtn.addEventListener('click', () => { hideResultBox('pe-result'); let score = 0; const checkboxes = ['pe-dvt', 'pe-alternative', 'pe-tachycardia', 'pe-immobilization', 'pe-dvt-history', 'pe-hemoptysis', 'pe-cancer']; checkboxes.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) score += parseFloat(cb.value); }); setHtml('pe-value', `Score: ${score.toFixed(1)}`); let lvlClass = 'info', lvlText = 'Probability', interp = ''; if (score <= 4.0) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'PE Unlikely (Score ≤ 4.0). Consider PERC or D-dimer.'; } else { lvlClass = 'danger'; lvlText = 'High'; interp = 'PE Likely (Score > 4.0). Consider imaging.'; } setInterpretation('pe-level', 'pe-interpretation', lvlClass, lvlText, interp); showResultBox('pe-result'); }); }
            // 7. Serum Anion Gap
             const calculateAgBtn = document.getElementById('calculate-ag'); if (calculateAgBtn) { calculateAgBtn.addEventListener('click', () => { clearErrors(['ag-sodium-error', 'ag-chloride-error', 'ag-bicarbonate-error', 'ag-albumin-error']); hideResultBox('ag-result'); document.getElementById('ag-corrected-section').style.display = 'none'; const sodium = getNumericValue('ag-sodium'); const chloride = getNumericValue('ag-chloride'); const bicarbonate = getNumericValue('ag-bicarbonate'); const albuminInput = getValue('ag-albumin'); const albumin = albuminInput.trim() === '' ? NaN : parseFloat(albuminInput); let valid = true; if (!isValidNumber(sodium)) { displayError('ag-sodium-error', 'Valid Na⁺ required.'); valid = false; } if (!isValidNumber(chloride)) { displayError('ag-chloride-error', 'Valid Cl⁻ required.'); valid = false; } if (!isValidNumber(bicarbonate)) { displayError('ag-bicarbonate-error', 'Valid HCO₃⁻ required.'); valid = false; } if (albuminInput.trim() !== '' && (!isValidPositiveNumber(albumin) || albumin > 10)) { displayError('ag-albumin-error', 'Valid Albumin or leave blank.'); valid = false; } if (!valid) return; const anionGap = sodium - (chloride + bicarbonate); setHtml('ag-value', `Anion Gap: ${anionGap.toFixed(1)} mEq/L`); let lvlClass = (anionGap >= 3 && anionGap <= 11) ? 'normal' : 'warning'; let lvlText = (anionGap >= 3 && anionGap <= 11) ? 'Normal' : 'Abnormal'; let interp = (anionGap > 11) ? 'High AG. Consider MUDPILES/GOLDMARK.' : (anionGap < 3 ? 'Low AG (rare).' : 'Within typical range.'); setInterpretation('ag-level', 'ag-interpretation', lvlClass, lvlText, interp); if (!isNaN(albumin)) { const correctedAnionGap = anionGap + 2.5 * (4.0 - albumin); setHtml('ag-corrected-value', `Corrected AG: ${correctedAnionGap.toFixed(1)} mEq/L`); let cLvlClass = (correctedAnionGap >= 3 && correctedAnionGap <= 11) ? 'normal' : 'warning'; let cLvlText = (correctedAnionGap >= 3 && correctedAnionGap <= 11) ? 'Normal' : 'Abnormal'; let cInterp = (correctedAnionGap > 11) ? 'Corrected AG is High.' : (correctedAnionGap < 3 ? 'Corrected AG is Low.' : 'Corrected AG in range.'); setInterpretation('ag-corrected-level', 'ag-corrected-interpretation', cLvlClass, cLvlText, cInterp); document.getElementById('ag-corrected-section').style.display = 'block'; } showResultBox('ag-result'); }); }
            // 8. Corrected QT Interval (QTc)
            const calculateQtcBtn = document.getElementById('calculate-qtc'); if (calculateQtcBtn) { calculateQtcBtn.addEventListener('click', () => { clearErrors(['qt-interval-error', 'qt-rr-hr-error']); hideResultBox('qtc-result'); const qtMs = getNumericValue('qt-interval'); const rrHrValue = getNumericValue('qt-rr-hr'); const inputType = getValue('qt-input-type'); const formula = getValue('qt-formula'); let valid = true; if (!isValidPositiveNumber(qtMs) || qtMs < 200 || qtMs > 800) { displayError('qt-interval-error', 'Enter plausible QT (ms).'); valid = false; } if (!isValidPositiveNumber(rrHrValue)) { displayError('qt-rr-hr-error', `Enter valid ${inputType==='rr'?'RR (ms)':'HR (bpm)'}.`); valid = false; } if (valid && inputType === 'rr' && (rrHrValue < 300 || rrHrValue > 2000)) { displayError('qt-rr-hr-error', 'Enter plausible RR (ms).'); valid = false; } if (valid && inputType === 'hr' && (rrHrValue < 30 || rrHrValue > 200)) { displayError('qt-rr-hr-error', 'Enter plausible HR (bpm).'); valid = false; } if (!valid) return; const qtSec = qtMs / 1000.0; let rrSec = 0, heartRate = 0; if (inputType === 'rr') { rrSec = rrHrValue / 1000.0; heartRate = 60.0 / rrSec; } else { heartRate = rrHrValue; rrSec = 60.0 / heartRate; } if (rrSec <= 0) { displayError('qt-rr-hr-error', 'Cannot calculate with zero/negative interval/rate.'); return; } let qtcMs = 0; try { switch (formula) { case 'bazett': qtcMs = (qtMs / Math.sqrt(rrSec)); break; case 'fridericia': qtcMs = (qtMs / Math.pow(rrSec, 1/3)); break; case 'framingham': qtcMs = qtMs + 154 * (1 - rrSec); break; case 'hodges': qtcMs = qtMs + 1.75 * (heartRate - 60); break; default: throw new Error("Invalid formula"); } } catch (e) { qtcMs = NaN; } if (isNaN(qtcMs)) { setHtml('qtc-value', 'Calculation Error'); setInterpretation('qtc-level','qtc-interpretation', 'danger', 'Error', ''); } else { setHtml('qtc-value', `QTc (${formula}): ${qtcMs.toFixed(0)} ms`); let lvlClass = 'info', lvlText = 'QTc', interp = ''; if (qtcMs > 500) { lvlClass = 'danger'; lvlText = 'Markedly Prolonged'; interp = '> 500 ms: High risk.'; } else if (qtcMs > 460) { lvlClass = 'warning'; lvlText = 'Prolonged'; interp = '> 460 ms (F) or > 450 ms (M) generally prolonged.'; } else if (qtcMs < 350) { lvlClass = 'warning'; lvlText = 'Short'; interp = '< 350 ms: Consider Short QT syndrome.'; } else { lvlClass = 'normal'; lvlText = 'Normal'; interp = 'Within normal limits.'; } setInterpretation('qtc-level', 'qtc-interpretation', lvlClass, lvlText, interp); } showResultBox('qtc-result'); }); }
            // 9. Sodium Correction for Hyperglycemia
             const calculateNaCorrectedBtn = document.getElementById('calculate-na-corrected'); if (calculateNaCorrectedBtn) { calculateNaCorrectedBtn.addEventListener('click', () => { clearErrors(['na-measured-error', 'na-glucose-error']); hideResultBox('na-corrected-result'); const measuredNa = getNumericValue('na-measured'); let glucose = getNumericValue('na-glucose'); const glucoseUnit = getValue('na-glucose-unit'); let valid = true; if (!isValidNumber(measuredNa)) { displayError('na-measured-error', 'Enter valid measured Na⁺.'); valid = false; } if (!isValidPositiveNumber(glucose)) { displayError('na-glucose-error', 'Enter valid glucose.'); valid = false; } if (!valid) return; let glucoseMgDl = (glucoseUnit === 'mmol/L') ? glucose * GLUC_MG_PER_MMOL : glucose; let correctedNa = measuredNa; if (glucoseMgDl > 100) { correctedNa += 1.6 * ((glucoseMgDl - 100) / 100); } setHtml('na-corrected-value', `${correctedNa.toFixed(1)} mEq/L`); showResultBox('na-corrected-result'); }); }
            // 10. Maintenance Fluids (Holliday-Segar)
            const calculateFluidsBtn = document.getElementById('calculate-fluids'); if (calculateFluidsBtn) { calculateFluidsBtn.addEventListener('click', () => { clearErrors(['fluids-weight-error']); hideResultBox('fluids-result'); let weight = getNumericValue('fluids-weight'); const weightUnit = getValue('fluids-weight-unit'); if (!isValidPositiveNumber(weight)) { displayError('fluids-weight-error', 'Enter valid weight.'); return; } let weightKg = (weightUnit === 'lb') ? weight * KG_PER_LB : weight; let dailyFluid = 0; if (weightKg <= 10) { dailyFluid = weightKg * 100; } else if (weightKg <= 20) { dailyFluid = 1000 + (weightKg - 10) * 50; } else { dailyFluid = 1500 + (weightKg - 20) * 20; } dailyFluid = Math.min(dailyFluid, 2400); const hourlyRate = dailyFluid / 24; setHtml('fluids-daily-value', `${dailyFluid.toFixed(0)} mL/day`); setHtml('fluids-hourly-value', `${hourlyRate.toFixed(1)} mL/hr`); showResultBox('fluids-result'); }); }
            // 11. Ideal & Adjusted Body Weight
            const calculateIbwAbwBtn = document.getElementById('calculate-ibw-abw'); if (calculateIbwAbwBtn) { calculateIbwAbwBtn.addEventListener('click', () => { clearErrors(['ibw-height-error', 'ibw-actual-weight-error']); hideResultBox('ibw-abw-result'); document.getElementById('abw-section').style.display = 'none'; let height = getNumericValue('ibw-height'); const heightUnit = getValue('ibw-height-unit'); const gender = getValue('ibw-gender'); let actualWeight = getNumericValue('ibw-actual-weight'); const actualWeightUnit = getValue('ibw-actual-weight-unit'); let valid = true; if (!isValidPositiveNumber(height)) { displayError('ibw-height-error', 'Enter valid height.'); valid = false; } let actualWeightKg = NaN; if (isValidPositiveNumber(actualWeight)) { actualWeightKg = (actualWeightUnit === 'lb') ? actualWeight * KG_PER_LB : actualWeight; } else if (getValue('ibw-actual-weight').trim() !== '') { displayError('ibw-actual-weight-error', 'Enter valid actual weight or leave blank.'); valid = false; } if (!valid) return; let heightIn = (heightUnit === 'cm') ? height / CM_PER_IN : height; let ibwKg = NaN; if (heightIn >= 60) { const baseKg = (gender === 'male') ? 50 : 45.5; const factorKg = 2.3; ibwKg = baseKg + factorKg * (heightIn - 60); setHtml('ibw-value', `${ibwKg.toFixed(1)} kg`); if (!isNaN(actualWeightKg) && !isNaN(ibwKg) && actualWeightKg > ibwKg) { const abwKg = ibwKg + 0.4 * (actualWeightKg - ibwKg); setHtml('abw-value', `${abwKg.toFixed(1)} kg`); document.getElementById('abw-section').style.display = 'block'; } else if (!isNaN(actualWeightKg)) { setHtml('abw-value', `Actual ≤ IBW`); document.getElementById('abw-section').style.display = 'block'; } } else { setHtml('ibw-value', `Height < 60 inches`); displayError('ibw-height-error', 'Devine formula requires height ≥ 60 inches.'); } showResultBox('ibw-abw-result'); }); }
             // 12. LDL Calculated (Friedewald)
             const calculateLdlBtn = document.getElementById('calculate-ldl'); if (calculateLdlBtn) { calculateLdlBtn.addEventListener('click', () => { clearErrors(['ldl-tc-error', 'ldl-hdl-error', 'ldl-tg-error']); hideResultBox('ldl-result'); const ldlWarningEl = document.getElementById('ldl-warning'); if(ldlWarningEl) ldlWarningEl.style.display = 'none'; const tc = getNumericValue('ldl-tc'); const hdl = getNumericValue('ldl-hdl'); const tg = getNumericValue('ldl-tg'); const unit = getValue('ldl-unit'); let valid = true; if (!isValidPositiveNumber(tc)) { displayError('ldl-tc-error', 'Enter valid TC.'); valid = false; } if (!isValidPositiveNumber(hdl)) { displayError('ldl-hdl-error', 'Enter valid HDL.'); valid = false; } if (!isValidPositiveNumber(tg)) { displayError('ldl-tg-error', 'Enter valid TG.'); valid = false; } if (!valid) return; let ldl = NaN; let warning = ''; const tgLimit = (unit === 'mg/dL') ? 400 : (400 / TG_MG_PER_MMOL); const divisor = (unit === 'mg/dL') ? 5 : (TG_MG_PER_MMOL / CHOL_MG_PER_MMOL); if (tg > tgLimit) { warning = `Warning: Formula inaccurate if TG > ${tgLimit.toFixed(1)} ${unit}. Direct LDL recommended.`; if(ldlWarningEl) {ldlWarningEl.textContent = warning; ldlWarningEl.style.display = 'block';} setHtml('ldl-value', `TG too high`); } else { ldl = tc - hdl - (tg / divisor); ldl = Math.max(0, ldl); setHtml('ldl-value', `${ldl.toFixed(unit === 'mg/dL' ? 0 : 1)} ${unit}`); } showResultBox('ldl-result'); }); }
             // 13. Centor Score (Modified/McIsaac)
             const calculateCentorBtn = document.getElementById('calculate-centor'); if (calculateCentorBtn) { calculateCentorBtn.addEventListener('click', () => { hideResultBox('centor-result'); let score = 0; const checkboxes = ['centor-temp', 'centor-no-cough', 'centor-nodes', 'centor-exudate']; checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; }); score += parseInt(getValue('centor-age') || '0'); setHtml('centor-value', `Score: ${score}`); let lvlClass = 'info', lvlText = 'Strep Risk', interp = ''; if (score <= 0) { lvlClass = 'normal'; lvlText = 'Very Low'; interp = 'Score ≤ 0: Strep unlikely, symptomatic tx.'; } else if (score === 1) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'Score 1: Consider culture/RADT if clinical suspicion high.'; } else if (score === 2 || score === 3) { lvlClass = 'warning'; lvlText = 'Intermediate'; interp = 'Score 2-3: Perform culture/RADT, treat if positive.'; } else { lvlClass = 'danger'; lvlText = 'High'; interp = 'Score ≥ 4: Consider empiric antibiotics or culture/RADT.'; } setInterpretation('centor-level', 'centor-interpretation', lvlClass, lvlText, interp); showResultBox('centor-result'); }); }
            // 14. HAS-BLED Score
            const calculateHasbledBtn = document.getElementById('calculate-hasbled'); if (calculateHasbledBtn) { calculateHasbledBtn.addEventListener('click', () => { hideResultBox('hasbled-result'); let score = 0; const checkboxes = ['hasbled-htn', 'hasbled-renal', 'hasbled-liver', 'hasbled-stroke', 'hasbled-bleeding', 'hasbled-inr', 'hasbled-age', 'hasbled-drugs', 'hasbled-alcohol']; let renalLiverPoint = 0; if (document.getElementById('hasbled-renal')?.checked || document.getElementById('hasbled-liver')?.checked) { renalLiverPoint = 1; } checkboxes.forEach(id => { if (id !== 'hasbled-renal' && id !== 'hasbled-liver') { if (document.getElementById(id)?.checked) { score += parseFloat(document.getElementById(id).value); } } }); score += renalLiverPoint; setHtml('hasbled-value', `Score: ${score}`); let lvlClass = (score >= 3) ? 'danger' : 'warning'; let lvlText = (score >= 3) ? 'High Risk' : 'Lower/Mod Risk'; let interp = (score >= 3) ? `Score ≥ 3: High bleeding risk. Address modifiable factors.` : `Score < 3: Lower/Moderate bleeding risk.`; setInterpretation('hasbled-level', 'hasbled-interpretation', lvlClass, lvlText, interp); showResultBox('hasbled-result'); }); }
             // 15. Free Water Deficit
             const calculateFwdBtn = document.getElementById('calculate-fwd'); if (calculateFwdBtn) { calculateFwdBtn.addEventListener('click', () => { clearErrors(['fwd-current-na-error', 'fwd-target-na-error', 'fwd-weight-error']); hideResultBox('fwd-result'); const currentNa = getNumericValue('fwd-current-na'); const targetNa = getNumericValue('fwd-target-na') || 140; let weight = getNumericValue('fwd-weight'); const weightUnit = getValue('fwd-weight-unit'); const tbwFactor = getNumericValue('fwd-tbw-factor'); let valid = true; if (!isValidPositiveNumber(currentNa) || currentNa <= targetNa) { displayError('fwd-current-na-error', 'Current Na⁺ must be > Target Na⁺.'); valid = false; } if (!isValidPositiveNumber(targetNa) || targetNa >= currentNa) { displayError('fwd-target-na-error', 'Enter valid target Na⁺ (< Current Na⁺).'); valid = false; } if (!isValidPositiveNumber(weight)) { displayError('fwd-weight-error', 'Enter valid weight.'); valid = false; } if (!valid) return; let weightKg = (weightUnit === 'lb') ? weight * KG_PER_LB : weight; const tbw = weightKg * tbwFactor; const fwd = tbw * ((currentNa / targetNa) - 1); setHtml('fwd-value', `${fwd.toFixed(1)} L`); showResultBox('fwd-result'); }); }
             // 16. Serum Osmolality (Calculated)
             const calculateOsmBtn = document.getElementById('calculate-osm'); if (calculateOsmBtn) { calculateOsmBtn.addEventListener('click', () => { clearErrors(['osm-na-error', 'osm-glucose-error', 'osm-bun-error', 'osm-ethanol-error']); hideResultBox('osm-result'); const na = getNumericValue('osm-na'); let glucose = getNumericValue('osm-glucose'); const glucoseUnit = getValue('osm-glucose-unit'); let bunUrea = getNumericValue('osm-bun'); const bunUreaUnit = getValue('osm-bun-unit'); const ethanolInput = getValue('osm-ethanol'); const ethanol = ethanolInput.trim() === '' ? NaN : getNumericValue('osm-ethanol'); let valid = true; if (!isValidNumber(na)) { displayError('osm-na-error', 'Enter valid Na⁺.'); valid = false; } if (!isValidPositiveNumber(glucose)) { displayError('osm-glucose-error', 'Enter valid Glucose.'); valid = false; } if (!isValidPositiveNumber(bunUrea)) { displayError('osm-bun-error', 'Enter valid BUN/Urea.'); valid = false; } if (ethanolInput.trim() !== '' && !isValidNonNegativeNumber(ethanol)) { displayError('osm-ethanol-error', 'Enter valid Ethanol or leave blank.'); valid = false; } if (!valid) return; let glucoseMgDl = (glucoseUnit === 'mmol/L') ? glucose * GLUC_MG_PER_MMOL : glucose; let bunMgDl = 0; if (bunUreaUnit === 'mmol/L-urea') bunMgDl = bunUrea / BUN_MG_PER_MMOL_UREA; else if (bunUreaUnit === 'mg/dL-urea') bunMgDl = bunUrea * BUN_MG_PER_UREA_MG; else bunMgDl = bunUrea; let calculatedOsm = (2 * na) + (glucoseMgDl / 18) + (bunMgDl / 2.8); if (!isNaN(ethanol) && ethanol > 0) { calculatedOsm += (ethanol / ETHANOL_MG_PER_DL_DIVISOR); } setHtml('osm-calc-value', `${calculatedOsm.toFixed(1)} mOsm/kg`); showResultBox('osm-result'); }); }


            // --- NEW CALCULATORS (17-18) ---

            // 17. Calcium Correction for Hypoalbuminemia
            const calculateCaCorrectedBtn = document.getElementById('calculate-ca-corrected');
            if (calculateCaCorrectedBtn) {
                calculateCaCorrectedBtn.addEventListener('click', () => {
                    clearErrors(['ca-measured-error', 'ca-albumin-error']);
                    hideResultBox('ca-corrected-result');
                    let measuredCa = getNumericValue('ca-measured');
                    const caUnit = getValue('ca-unit');
                    let albumin = getNumericValue('ca-albumin');
                    const albuminUnit = getValue('ca-albumin-unit');
                    let valid = true;

                    if (!isValidNumber(measuredCa)) { displayError('ca-measured-error', 'Enter valid measured Ca.'); valid = false; }
                    if (!isValidPositiveNumber(albumin)) { displayError('ca-albumin-error', 'Enter valid albumin.'); valid = false; }
                     if (!valid) return;

                     // Convert to standard units (mg/dL and g/dL)
                     let measuredCaMgDl = (caUnit === 'mmol/L') ? measuredCa * CA_MG_PER_MMOL : measuredCa;
                     let albuminGDl = (albuminUnit === 'g/L') ? albumin / ALB_G_PER_L_DIVISOR : albumin;

                     let correctedCaMgDl = measuredCaMgDl;
                     // Only correct if albumin is below normal (e.g., < 4.0 g/dL)
                     if (albuminGDl < 4.0) {
                         correctedCaMgDl = measuredCaMgDl + 0.8 * (4.0 - albuminGDl);
                     }

                      // Display result in the original calcium unit selected by the user
                     let correctedCaDisplay = (caUnit === 'mmol/L') ? (correctedCaMgDl / CA_MG_PER_MMOL).toFixed(2) : correctedCaMgDl.toFixed(1);
                     setHtml('ca-corrected-value', `${correctedCaDisplay} ${caUnit}`);

                     // Interpretation based on mg/dL (typical normal range 8.5-10.2 mg/dL)
                    let lvlClass = 'info', lvlText = 'Corrected Ca', interp = `Corrected for albumin ${albuminGDl.toFixed(1)} g/dL.`;
                     const lowerNormal = 8.5;
                     const upperNormal = 10.2;
                    if (correctedCaMgDl < lowerNormal) { lvlClass = 'warning'; lvlText = 'Low'; interp = `Corrected Ca < ${lowerNormal} mg/dL. Consider hypocalcemia workup.`; }
                     else if (correctedCaMgDl > upperNormal) { lvlClass = 'warning'; lvlText = 'High'; interp = `Corrected Ca > ${upperNormal} mg/dL. Consider hypercalcemia workup.`; }
                     else { lvlClass = 'normal'; lvlText = 'Normal'; interp = `Corrected Ca within typical normal range (${lowerNormal}-${upperNormal} mg/dL).`; }
                     setInterpretation('ca-level', 'ca-interpretation', lvlClass, lvlText, interp);

                     showResultBox('ca-corrected-result');
                });
            }

            // 18. Glasgow Coma Scale (GCS)
            const calculateGcsBtn = document.getElementById('calculate-gcs');
            if (calculateGcsBtn) {
                calculateGcsBtn.addEventListener('click', () => {
                    hideResultBox('gcs-result');
                    const eyeScore = parseInt(getValue('gcs-eye') || '1');
                    const verbalValue = getValue('gcs-verbal'); // Get value ('5', 'T', etc.)
                    const motorScore = parseInt(getValue('gcs-motor') || '1');

                     let verbalScore = 1; // Default if 'T' or invalid
                     let isIntubated = false;
                     if (verbalValue === 'T') {
                         isIntubated = true;
                         verbalScore = 1; // Score as 1 for total calculation, but note 'T'
                     } else {
                         verbalScore = parseInt(verbalValue || '1');
                     }


                    const totalScore = eyeScore + verbalScore + motorScore;
                    const componentString = `E${eyeScore} V${isIntubated ? 'T' : verbalScore} M${motorScore}`;

                    setHtml('gcs-value', `GCS Score: ${totalScore}`);
                    setHtml('gcs-components', componentString);

                    // Interpretation based on total score
                    let lvlClass = 'info', lvlText = 'Severity', interp = '';
                    if (totalScore >= 13) { lvlClass = 'normal'; lvlText = 'Mild'; interp = 'Score 13-15: Mild head injury / Normal.'; }
                    else if (totalScore >= 9) { lvlClass = 'warning'; lvlText = 'Moderate'; interp = 'Score 9-12: Moderate head injury.'; }
                    else { lvlClass = 'danger'; lvlText = 'Severe'; interp = 'Score ≤ 8: Severe head injury. Consider intubation.'; }
                     setInterpretation('gcs-level', 'gcs-interpretation', lvlClass, lvlText, interp);

                    showResultBox('gcs-result');
                });
            }


            // --- NEW CALCULATORS (21-27) ---

            // 21. Mean Arterial Pressure (MAP)
            const calculateMapBtn = document.getElementById('calculate-map');
            if (calculateMapBtn) {
                calculateMapBtn.addEventListener('click', () => {
                    clearErrors(['map-sbp-error', 'map-dbp-error']);
                    hideResultBox('map-result');
                    const sbp = getNumericValue('map-sbp');
                    const dbp = getNumericValue('map-dbp');
                    let valid = true;
                    if (!isValidPositiveNumber(sbp)) { displayError('map-sbp-error', 'Enter valid SBP.'); valid = false; }
                    if (!isValidPositiveNumber(dbp)) { displayError('map-dbp-error', 'Enter valid DBP.'); valid = false; }
                    if (valid && dbp >= sbp) { displayError('map-dbp-error', 'DBP must be less than SBP.'); valid = false; }
                    if (!valid) return;
                    const map = dbp + (sbp - dbp) / 3;
                    setHtml('map-value', `${map.toFixed(1)} mmHg`);
                    showResultBox('map-result');
                });
            }

            // 22. MDRD GFR Equation
            const calculateMdrdBtn = document.getElementById('calculate-mdrd');
            if (calculateMdrdBtn) {
                calculateMdrdBtn.addEventListener('click', () => {
                    clearErrors(['mdrd-scr-error', 'mdrd-age-error']);
                    hideResultBox('mdrd-result');
                    let scr = getNumericValue('mdrd-scr');
                    const scrUnit = getValue('mdrd-scr-unit');
                    const age = getNumericValue('mdrd-age');
                    const gender = getValue('mdrd-gender');
                    const race = getValue('mdrd-race');
                    let valid = true;
                    if (!isValidPositiveNumber(scr)) { displayError('mdrd-scr-error', 'Valid SCr required.'); valid = false; }
                    if (!isValidPositiveNumber(age) || age < 18) { displayError('mdrd-age-error', 'Valid age (≥18) required.'); valid = false; }
                    if (!valid) return;
                    let scrMgDl = (scrUnit === 'μmol/L') ? scr / SCR_UMOL_PER_MG : scr;
                    if(scrMgDl <= 0) { displayError('mdrd-scr-error', 'SCr must be positive.'); return; }
                    let gfr = 175 * Math.pow(scrMgDl, -1.154) * Math.pow(age, -0.203);
                    if (gender === 'female') gfr *= 0.742;
                    if (race === 'black') gfr *= 1.212;
                    const gfrDisplay = gfr >= 60 ? `> 60` : gfr.toFixed(0); // MDRD not accurate > 60
                    setHtml('mdrd-value', `eGFR: ${gfrDisplay} mL/min/1.73m²`);
                    let lvlClass = 'info', lvlText = 'Stage', interp = '';
                    if (gfr >= 90) { lvlClass = 'normal'; lvlText = 'G1'; interp = 'Normal/High eGFR (≥90). CKD if damage markers present.'; }
                    else if (gfr >= 60) { lvlClass = 'normal'; lvlText = 'G2'; interp = 'Mildly ↓ (60-89). CKD if damage markers present.'; }
                    else if (gfr >= 45) { lvlClass = 'warning'; lvlText = 'G3a'; interp = 'Mild-Mod ↓ (45-59).'; }
                    else if (gfr >= 30) { lvlClass = 'warning'; lvlText = 'G3b'; interp = 'Mod-Sev ↓ (30-44).'; }
                    else if (gfr >= 15) { lvlClass = 'danger'; lvlText = 'G4'; interp = 'Severely ↓ (15-29).'; }
                    else { lvlClass = 'danger'; lvlText = 'G5'; interp = 'Kidney Failure (<15).'; }
                    setInterpretation('mdrd-level', 'mdrd-interpretation', lvlClass, lvlText, interp);
                    showResultBox('mdrd-result');
                });
            }

            // 23. Fractional Excretion of Sodium (FENa)
            const calculateFenaBtn = document.getElementById('calculate-fena');
            if (calculateFenaBtn) {
                calculateFenaBtn.addEventListener('click', () => {
                    clearErrors(['fena-una-error', 'fena-pna-error', 'fena-ucr-error', 'fena-pcr-error']);
                    hideResultBox('fena-result');
                    const uNa = getNumericValue('fena-una');
                    const pNa = getNumericValue('fena-pna');
                    let uCr = getNumericValue('fena-ucr');
                    let pCr = getNumericValue('fena-pcr');
                    const crUnit = getValue('fena-cr-unit');
                    let valid = true;
                    if (!isValidNonNegativeNumber(uNa)) { displayError('fena-una-error', 'Valid Urine Na⁺.'); valid = false; }
                    if (!isValidPositiveNumber(pNa)) { displayError('fena-pna-error', 'Valid Plasma Na⁺.'); valid = false; }
                    if (!isValidPositiveNumber(uCr)) { displayError('fena-ucr-error', 'Valid Urine Cr.'); valid = false; }
                    if (!isValidPositiveNumber(pCr)) { displayError('fena-pcr-error', 'Valid Plasma Cr.'); valid = false; }
                    if (!valid) return;

                    // Convert Cr to same units if necessary (assuming mg/dL is base)
                    if (crUnit === 'mmol/L') {
                        uCr /= (SCR_UMOL_PER_MG / 10); // mmol/L to mg/dL
                        pCr /= (SCR_UMOL_PER_MG / 10);
                    }
                     if (pNa <= 0 || uCr <= 0 || pCr <= 0) {
                         setHtml('fena-value', 'Error: Divisor zero');
                         showResultBox('fena-result');
                         return;
                     }

                    const fena = (uNa * pCr) / (pNa * uCr) * 100;
                    setHtml('fena-value', `FENa: ${fena.toFixed(2)}%`);
                    let lvlClass = 'info', lvlText = 'Interpretation', interp = '';
                    if (fena < 1) { lvlClass = 'normal'; lvlText = 'Prerenal Likely'; interp = 'FENa < 1%: Suggests prerenal cause (e.g., dehydration).'; }
                    else if (fena > 2) { lvlClass = 'danger'; lvlText = 'Intrinsic Likely'; interp = 'FENa > 2%: Suggests intrinsic renal cause (e.g., ATN).'; }
                    else { lvlClass = 'warning'; lvlText = 'Indeterminate'; interp = 'FENa 1-2%: Indeterminate, consider clinical context.'; }
                    setInterpretation('fena-level', 'fena-interpretation', lvlClass, lvlText, interp);
                    showResultBox('fena-result');
                });
            }

            // 24. FIB-4 Index
            const calculateFib4Btn = document.getElementById('calculate-fib4');
            if (calculateFib4Btn) {
                calculateFib4Btn.addEventListener('click', () => {
                    clearErrors(['fib4-age-error', 'fib4-ast-error', 'fib4-plt-error', 'fib4-alt-error']);
                    hideResultBox('fib4-result');
                    const age = getNumericValue('fib4-age');
                    const ast = getNumericValue('fib4-ast');
                    const plt = getNumericValue('fib4-plt'); // Input as K/µL or x10⁹/L
                    const alt = getNumericValue('fib4-alt');
                    let valid = true;
                    if (!isValidPositiveNumber(age) || age < 18) { displayError('fib4-age-error', 'Valid age (≥18).'); valid = false; }
                    if (!isValidPositiveNumber(ast)) { displayError('fib4-ast-error', 'Valid AST.'); valid = false; }
                    if (!isValidPositiveNumber(plt)) { displayError('fib4-plt-error', 'Valid Platelet count.'); valid = false; }
                    if (!isValidPositiveNumber(alt)) { displayError('fib4-alt-error', 'Valid ALT.'); valid = false; }
                    if (!valid) return;

                    if (plt <= 0 || alt <= 0) {
                         setHtml('fib4-value', 'Error: Divisor zero');
                         showResultBox('fib4-result');
                         return;
                    }

                    const fib4 = (age * ast) / (plt * Math.sqrt(alt));
                    setHtml('fib4-value', `FIB-4: ${fib4.toFixed(2)}`);
                    let lvlClass = 'info', lvlText = 'Fibrosis Risk', interp = '';
                    // Using common cutoffs, may vary based on disease/guideline
                    if (fib4 < 1.45) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = 'FIB-4 < 1.45: Low likelihood of advanced fibrosis (NPV ~90%).'; }
                    else if (fib4 > 3.25) { lvlClass = 'danger'; lvlText = 'High Risk'; interp = 'FIB-4 > 3.25: High likelihood of advanced fibrosis (PPV ~65%). Consider biopsy/elastography.'; }
                    else { lvlClass = 'warning'; lvlText = 'Intermediate Risk'; interp = 'FIB-4 1.45-3.25: Indeterminate risk. Further evaluation recommended.'; }
                    setInterpretation('fib4-level', 'fib4-interpretation', lvlClass, lvlText, interp);
                    showResultBox('fib4-result');
                });
            }

            // 25. ABCD² Score
            const calculateAbcd2Btn = document.getElementById('calculate-abcd2');
            if (calculateAbcd2Btn) {
                calculateAbcd2Btn.addEventListener('click', () => {
                    hideResultBox('abcd2-result');
                    let score = 0;
                    if (document.getElementById('abcd2-age')?.checked) score += 1;
                    if (document.getElementById('abcd2-bp')?.checked) score += 1;
                    score += parseInt(getValue('abcd2-clinical') || '0');
                    score += parseInt(getValue('abcd2-duration') || '0');
                    if (document.getElementById('abcd2-diabetes')?.checked) score += 1;

                    setHtml('abcd2-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Stroke Risk (2-day)', interp = '';
                    if (score <= 3) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'Score 0-3: ~1% risk. Outpatient management may be appropriate.'; }
                    else if (score <= 5) { lvlClass = 'warning'; lvlText = 'Moderate'; interp = 'Score 4-5: ~4% risk. Hospital observation/urgent eval usually recommended.'; }
                    else { lvlClass = 'danger'; lvlText = 'High'; interp = 'Score 6-7: ~8% risk. Hospital admission strongly recommended.'; }
                    setInterpretation('abcd2-level', 'abcd2-interpretation', lvlClass, lvlText, interp);
                    showResultBox('abcd2-result');
                });
            }

            // 26. Morphine Milligram Equivalents (MME)
            const mmeEntriesContainer = document.getElementById('mme-entries');
            const addMmeEntryBtn = document.getElementById('mme-add-entry');
            const calculateMmeBtn = document.getElementById('calculate-mme');

            function addMmeEntry() {
                if (!mmeEntriesContainer) return;
                const newEntry = mmeEntriesContainer.children[0].cloneNode(true);
                newEntry.querySelector('.mme-opioid').selectedIndex = 0;
                const doseInput = newEntry.querySelector('.mme-dose');
                 if(doseInput) doseInput.value = '';
                 const removeBtn = newEntry.querySelector('.mme-remove-entry');
                 if(removeBtn) {
                     removeBtn.style.display = 'inline-block'; // Show remove button on added entries
                     removeBtn.addEventListener('click', () => newEntry.remove());
                 }
                mmeEntriesContainer.appendChild(newEntry);
            }

             // Hide remove button on the initial entry
             const firstRemoveBtn = mmeEntriesContainer?.querySelector('.mme-remove-entry');
             if (firstRemoveBtn) firstRemoveBtn.style.display = 'none';


            if (addMmeEntryBtn) {
                addMmeEntryBtn.addEventListener('click', addMmeEntry);
            }

            if (calculateMmeBtn && mmeEntriesContainer) {
                calculateMmeBtn.addEventListener('click', () => {
                    hideResultBox('mme-result');
                    let totalMme = 0;
                    let calculationError = false;
                    const entries = mmeEntriesContainer.querySelectorAll('.mme-entry');

                    entries.forEach(entry => {
                        const opioidSelect = entry.querySelector('.mme-opioid');
                        const doseInput = entry.querySelector('.mme-dose');
                        if (!opioidSelect || !doseInput) return;

                        const conversionFactor = parseFloat(opioidSelect.value);
                        const dose = parseFloat(doseInput.value);
                        const opioidName = opioidSelect.options[opioidSelect.selectedIndex].text;

                        if (conversionFactor > 0 && isValidPositiveNumber(dose)) {
                            if (opioidName.toLowerCase().includes('fentanyl')) {
                                totalMme += dose * conversionFactor; // Factor already includes the 2.4 for mcg/hr
                            } else {
                                totalMme += dose * conversionFactor;
                            }
                        } else if (conversionFactor > 0 && doseInput.value.trim() !== '') {
                            // Handle case where dose is entered but invalid, or opioid selected but no dose
                             calculationError = true; // Or display specific error per entry
                        }
                    });

                     if (calculationError) {
                         setHtml('mme-value', 'Input Error');
                         setInterpretation('mme-level', 'mme-interpretation', 'danger', 'Error', 'Check opioid selections and doses.');
                     } else {
                        setHtml('mme-value', `${totalMme.toFixed(1)} MME/day`);
                        let lvlClass = 'info', lvlText = 'Risk Level', interp = '';
                        if (totalMme >= 90) { lvlClass = 'danger'; lvlText = 'High Risk'; interp = '≥ 90 MME/day: Avoid or carefully justify. High overdose risk.'; }
                        else if (totalMme >= 50) { lvlClass = 'warning'; lvlText = 'Increased Risk'; interp = '50-89 MME/day: Use caution. Increased overdose risk.'; }
                        else { lvlClass = 'normal'; lvlText = 'Lower Risk'; interp = '< 50 MME/day: Lower risk, but still monitor.'; }
                        setInterpretation('mme-level', 'mme-interpretation', lvlClass, lvlText, interp);
                     }
                    showResultBox('mme-result');
                });
            }

             // 27. Steroid Conversion
             const calculateSteroidBtn = document.getElementById('calculate-steroid');
             if (calculateSteroidBtn) {
                 calculateSteroidBtn.addEventListener('click', () => {
                     clearErrors(['steroid-dose-error']);
                     hideResultBox('steroid-result');
                     const fromFactor = parseFloat(getValue('steroid-from'));
                     const dose = getNumericValue('steroid-dose');
                     const toFactor = parseFloat(getValue('steroid-to'));
                     const fromName = document.getElementById('steroid-from')?.selectedOptions[0]?.text || 'From Steroid';
                     const toName = document.getElementById('steroid-to')?.selectedOptions[0]?.text || 'To Steroid';

                     if (!isValidPositiveNumber(dose)) {
                         displayError('steroid-dose-error', 'Enter valid dose.');
                         return;
                     }
                     if (isNaN(fromFactor) || isNaN(toFactor) || fromFactor <= 0 || toFactor <= 0) {
                          setHtml('steroid-converted-dose', 'Error');
                          setHtml('steroid-conversion-details', 'Invalid steroid selection.');
                          showResultBox('steroid-result');
                          return;
                     }

                     // Conversion logic: (Dose / FromFactor) gives "Prednisone Equivalents"
                     // Then multiply by ToFactor to get the equivalent dose of the target steroid
                     const convertedDose = (dose / fromFactor) * toFactor;

                     setHtml('steroid-converted-dose', `${convertedDose.toFixed(2)} mg`);
                     setHtml('steroid-conversion-details', `${dose} mg ${fromName} ≈ ${convertedDose.toFixed(2)} mg ${toName}`);
                     showResultBox('steroid-result');
                 });
             }


            // --- NEW CALCULATORS (28-33) ---

            // 28. Child-Pugh Score
            const calculateChildPughBtn = document.getElementById('calculate-child-pugh');
            if (calculateChildPughBtn) {
                calculateChildPughBtn.addEventListener('click', () => {
                    clearErrors(['cp-bilirubin-error', 'cp-albumin-error', 'cp-inr-error']);
                    hideResultBox('child-pugh-result');
                    let score = 0;
                    score += parseInt(getValue('cp-encephalopathy') || '1');
                    score += parseInt(getValue('cp-ascites') || '1');

                    let bilirubin = getNumericValue('cp-bilirubin');
                    const bilirubinUnit = getValue('cp-bilirubin-unit');
                    let albumin = getNumericValue('cp-albumin');
                    const albuminUnit = getValue('cp-albumin-unit');
                    const inr = getNumericValue('cp-inr');
                    let valid = true;

                    if (!isValidPositiveNumber(bilirubin)) { displayError('cp-bilirubin-error', 'Valid Bilirubin.'); valid = false; }
                    if (!isValidPositiveNumber(albumin)) { displayError('cp-albumin-error', 'Valid Albumin.'); valid = false; }
                    if (!isValidPositiveNumber(inr)) { displayError('cp-inr-error', 'Valid INR.'); valid = false; }
                    if (!valid) return;

                    // Convert to standard units (mg/dL and g/dL)
                    let biliMgDl = (bilirubinUnit === 'μmol/L') ? bilirubin / 17.1 : bilirubin;
                    let albuminGDl = (albuminUnit === 'g/L') ? albumin / 10 : albumin;

                    // Bilirubin points
                    if (biliMgDl < 2) score += 1;
                    else if (biliMgDl <= 3) score += 2;
                    else score += 3;

                    // Albumin points
                    if (albuminGDl > 3.5) score += 1;
                    else if (albuminGDl >= 2.8) score += 2;
                    else score += 3;

                    // INR points
                    if (inr < 1.7) score += 1;
                    else if (inr <= 2.3) score += 2;
                    else score += 3;

                    setHtml('child-pugh-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Class', interp = '';
                    if (score <= 6) { lvlClass = 'normal'; lvlText = 'Class A'; interp = 'Score 5-6: Well-compensated disease. 1-yr survival ~100%.'; }
                    else if (score <= 9) { lvlClass = 'warning'; lvlText = 'Class B'; interp = 'Score 7-9: Significant functional compromise. 1-yr survival ~80%.'; }
                    else { lvlClass = 'danger'; lvlText = 'Class C'; interp = 'Score 10-15: Decompensated disease. 1-yr survival ~45%.'; }
                    setInterpretation('child-pugh-level', 'child-pugh-interpretation', lvlClass, lvlText, interp);
                    showResultBox('child-pugh-result');
                });
            }

            // 29. CURB-65 Score
            const calculateCurb65Btn = document.getElementById('calculate-curb65');
            if (calculateCurb65Btn) {
                calculateCurb65Btn.addEventListener('click', () => {
                    hideResultBox('curb65-result');
                    let score = 0;
                    const checkboxes = ['curb-confusion', 'curb-bun', 'curb-rr', 'curb-bp', 'curb-age'];
                    checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; });

                    setHtml('curb65-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Mortality Risk / Site of Care', interp = '';
                    if (score <= 1) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = `Score ${score}: Very low mortality (~1.5%). Consider outpatient treatment.`; }
                    else if (score === 2) { lvlClass = 'warning'; lvlText = 'Moderate Risk'; interp = 'Score 2: Intermediate mortality (~9%). Consider hospital admission.'; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = `Score ${score}: High mortality (~22-57%). Urgent hospital admission +/- ICU.`; }
                    setInterpretation('curb65-level', 'curb65-interpretation', lvlClass, lvlText, interp);
                    showResultBox('curb65-result');
                });
            }

            // 30. PERC Rule
            const calculatePercBtn = document.getElementById('calculate-perc');
            if (calculatePercBtn) {
                calculatePercBtn.addEventListener('click', () => {
                    hideResultBox('perc-result');
                    let score = 0;
                    const checkboxes = ['perc-age', 'perc-hr', 'perc-o2', 'perc-hemoptysis', 'perc-estrogen', 'perc-surgery', 'perc-dvt-pe', 'perc-swelling'];
                    checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; });

                    const isPositive = score > 0;
                    setHtml('perc-value', isPositive ? 'PERC Positive' : 'PERC Negative');
                    let lvlClass = isPositive ? 'warning' : 'normal';
                    let lvlText = isPositive ? 'PE Not Ruled Out' : 'PE Ruled Out';
                    let interp = isPositive ? `Score > 0 (${score} criteria met): PERC rule is POSITIVE. Cannot rule out PE based on PERC alone. Further testing needed.` : 'Score = 0: PERC rule is NEGATIVE. PE effectively ruled out in low-risk patients.';
                    setInterpretation('perc-level', 'perc-interpretation', lvlClass, lvlText, interp);
                    showResultBox('perc-result');
                });
            }

            // 31. PHQ-9
            const calculatePhq9Btn = document.getElementById('calculate-phq9');
            if (calculatePhq9Btn) {
                calculatePhq9Btn.addEventListener('click', () => {
                    hideResultBox('phq9-result');
                    const suicideWarningEl = document.getElementById('phq9-suicide-warning');
                    if(suicideWarningEl) suicideWarningEl.style.display = 'none';
                    let score = 0;
                    let suicideScore = 0;
                    for (let i = 1; i <= 9; i++) {
                        const itemScore = parseInt(getValue(`phq9-${i}`) || '0');
                        score += itemScore;
                        if (i === 9) suicideScore = itemScore;
                    }

                    setHtml('phq9-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Severity', interp = '';
                    if (score <= 4) { lvlClass = 'normal'; lvlText = 'Minimal'; interp = 'Score 1-4: Minimal depression.'; }
                    else if (score <= 9) { lvlClass = 'normal'; lvlText = 'Mild'; interp = 'Score 5-9: Mild depression. Watchful waiting; repeat PHQ-9.'; }
                    else if (score <= 14) { lvlClass = 'warning'; lvlText = 'Moderate'; interp = 'Score 10-14: Moderate depression. Consider counseling, follow-up, +/- medication.'; }
                    else if (score <= 19) { lvlClass = 'danger'; lvlText = 'Moderately Severe'; interp = 'Score 15-19: Moderately severe depression. Active treatment with medication and/or psychotherapy.'; }
                    else { lvlClass = 'danger'; lvlText = 'Severe'; interp = 'Score 20-27: Severe depression. Immediate initiation of treatment, consider specialty referral.'; }
                    setInterpretation('phq9-level', 'phq9-interpretation', lvlClass, lvlText, interp);

                    if (suicideScore > 0) {
                        if(suicideWarningEl) {
                            suicideWarningEl.textContent = 'WARNING: Positive response to Question 9 requires immediate safety assessment!';
                            suicideWarningEl.style.display = 'block';
                        }
                    }
                    showResultBox('phq9-result');
                });
            }

            // 32. STOP-BANG Score
            const calculateStopbangBtn = document.getElementById('calculate-stopbang');
            if (calculateStopbangBtn) {
                calculateStopbangBtn.addEventListener('click', () => {
                    hideResultBox('stopbang-result');
                    let score = 0;
                    const checkboxes = ['stopbang-snoring', 'stopbang-tired', 'stopbang-observed', 'stopbang-pressure', 'stopbang-bmi', 'stopbang-age', 'stopbang-neck', 'stopbang-gender'];
                    checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; });

                    setHtml('stopbang-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'OSA Risk', interp = '';
                    if (score <= 2) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = 'Score 0-2: Low risk of moderate-severe OSA.'; }
                    else if (score <= 4) { lvlClass = 'warning'; lvlText = 'Intermediate Risk'; interp = 'Score 3-4: Intermediate risk of moderate-severe OSA.'; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = 'Score 5-8: High risk of moderate-severe OSA. Consider sleep study.'; }
                    setInterpretation('stopbang-level', 'stopbang-interpretation', lvlClass, lvlText, interp);
                    showResultBox('stopbang-result');
                });
            }

            // 33. CIWA-Ar
            const calculateCiwaBtn = document.getElementById('calculate-ciwa');
            if (calculateCiwaBtn) {
                calculateCiwaBtn.addEventListener('click', () => {
                    hideResultBox('ciwa-result');
                    let score = 0;
                    const items = ['nausea', 'tremor', 'sweats', 'anxiety', 'agitation', 'tactile', 'auditory', 'visual', 'headache', 'orientation'];
                    items.forEach(item => {
                        score += parseInt(getValue(`ciwa-${item}`) || '0');
                    });

                    setHtml('ciwa-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Withdrawal Severity', interp = '';
                    if (score < 10) { lvlClass = 'normal'; lvlText = 'Mild'; interp = `Score ${score}: Mild withdrawal. Usually no medication needed.`; }
                    else if (score <= 18) { lvlClass = 'warning'; lvlText = 'Moderate'; interp = `Score ${score}: Moderate withdrawal. Consider medication (e.g., benzodiazepines).`; }
                    else { lvlClass = 'danger'; lvlText = 'Severe'; interp = `Score ${score}: Severe withdrawal. Medication usually indicated. Risk of seizures/DTs.`; }
                    setInterpretation('ciwa-level', 'ciwa-interpretation', lvlClass, lvlText, interp);
                    showResultBox('ciwa-result');
                });
            }


            // --- NEW CALCULATORS (34-38) ---

            // 34. HEART Score
            const calculateHeartBtn = document.getElementById('calculate-heart');
            if (calculateHeartBtn) {
                calculateHeartBtn.addEventListener('click', () => {
                    hideResultBox('heart-result');
                    let score = 0;
                    score += parseInt(getValue('heart-history') || '0');
                    score += parseInt(getValue('heart-ecg') || '0');
                    score += parseInt(getValue('heart-age') || '0');
                    score += parseInt(getValue('heart-troponin') || '0');

                    let rfCount = 0;
                    const rfCheckboxes = ['heart-rf-htn', 'heart-rf-chol', 'heart-rf-dm', 'heart-rf-obesity', 'heart-rf-smoking', 'heart-rf-fhx', 'heart-rf-athero'];
                    rfCheckboxes.forEach(id => { if (document.getElementById(id)?.checked) rfCount++; });

                    if (rfCount === 0) score += 0;
                    else if (rfCount <= 2) score += 1;
                    else score += 2; // Max 2 points for risk factors

                    setHtml('heart-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'MACE Risk (6-wk)', interp = '';
                    if (score <= 3) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = `Score ${score}: ~1-2% risk. Consider discharge.`; }
                    else if (score <= 6) { lvlClass = 'warning'; lvlText = 'Intermediate Risk'; interp = `Score ${score}: ~12-17% risk. Admit for observation/further testing.`; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = `Score ${score}: ~50-65% risk. Consider early invasive strategy.`; }
                    setInterpretation('heart-level', 'heart-interpretation', lvlClass, lvlText, interp);
                    showResultBox('heart-result');
                });
            }

            // 35. Revised Cardiac Risk Index (RCRI)
            const calculateRcriBtn = document.getElementById('calculate-rcri');
            if (calculateRcriBtn) {
                calculateRcriBtn.addEventListener('click', () => {
                    hideResultBox('rcri-result');
                    let score = 0;
                    const checkboxes = ['rcri-surgery', 'rcri-ihd', 'rcri-chf', 'rcri-cvd', 'rcri-insulin', 'rcri-renal'];
                    checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; });

                    setHtml('rcri-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Risk Class', interp = '';
                    let riskPercent = 0;
                    if (score === 0) { lvlClass = 'normal'; lvlText = 'Class I'; riskPercent = 0.4; interp = `Score 0: ~${riskPercent}% risk of major cardiac complication.`; }
                    else if (score === 1) { lvlClass = 'normal'; lvlText = 'Class II'; riskPercent = 0.9; interp = `Score 1: ~${riskPercent}% risk.`; }
                    else if (score === 2) { lvlClass = 'warning'; lvlText = 'Class III'; riskPercent = 6.6; interp = `Score 2: ~${riskPercent}% risk. Consider further eval/management.`; }
                    else { lvlClass = 'danger'; lvlText = 'Class IV'; riskPercent = 11; interp = `Score ≥ 3: ~${riskPercent}% risk. Further eval/management recommended.`; }
                    setInterpretation('rcri-level', 'rcri-interpretation', lvlClass, lvlText, interp);
                    showResultBox('rcri-result');
                });
            }

            // 36. Padua Prediction Score
            const calculatePaduaBtn = document.getElementById('calculate-padua');
            if (calculatePaduaBtn) {
                calculatePaduaBtn.addEventListener('click', () => {
                    hideResultBox('padua-result');
                    let score = 0;
                    const checkboxes = ['padua-cancer', 'padua-prev-vte', 'padua-mobility', 'padua-thrombophilia', 'padua-trauma-surgery', 'padua-age', 'padua-heart-resp', 'padua-mi-stroke', 'padua-infection-rheum', 'padua-obesity', 'padua-hormone'];
                    checkboxes.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) score += parseFloat(cb.value); });

                    setHtml('padua-value', `Score: ${score}`);
                    let lvlClass = (score < 4) ? 'normal' : 'danger';
                    let lvlText = (score < 4) ? 'Low Risk' : 'High Risk';
                    let interp = (score < 4) ? `Score < 4: Low risk for VTE. Prophylaxis generally not indicated.` : `Score ≥ 4: High risk for VTE. Pharmacologic prophylaxis recommended unless contraindicated.`;
                    setInterpretation('padua-level', 'padua-interpretation', lvlClass, lvlText, interp);
                    showResultBox('padua-result');
                });
            }

            // 37. Canadian CT Head Rule
            const calculateCchrBtn = document.getElementById('calculate-cchr');
            if (calculateCchrBtn) {
                calculateCchrBtn.addEventListener('click', () => {
                    hideResultBox('cchr-result');
                    let score = 0;
                    const checkboxes = ['cchr-gcs', 'cchr-skull', 'cchr-basilar', 'cchr-vomit', 'cchr-age', 'cchr-amnesia', 'cchr-mechanism'];
                    checkboxes.forEach(id => { if (document.getElementById(id)?.checked) score += 1; });

                    const ctIndicated = score > 0;
                    setHtml('cchr-value', ctIndicated ? 'CT Indicated' : 'CT Not Indicated');
                    let lvlClass = ctIndicated ? 'danger' : 'normal';
                    let lvlText = ctIndicated ? 'CT Required' : 'CT Not Required';
                    let interp = ctIndicated ? `Score > 0 (${score} criteria met): CT head recommended based on Canadian CT Head Rule.` : 'Score = 0: CT head not required based on Canadian CT Head Rule (assuming low-risk minor head injury).';
                    setInterpretation('cchr-level', 'cchr-interpretation', lvlClass, lvlText, interp);
                    showResultBox('cchr-result');
                });
            }

            // 38. Glasgow-Blatchford Bleeding Score (GBS)
            const calculateGbsBtn = document.getElementById('calculate-gbs');
            if (calculateGbsBtn) {
                calculateGbsBtn.addEventListener('click', () => {
                    clearErrors(['gbs-bun-error', 'gbs-hb-male-error', 'gbs-hb-female-error', 'gbs-sbp-error']);
                    hideResultBox('gbs-result');
                    let score = 0;
                    let bun = getNumericValue('gbs-bun');
                    const bunUnit = getValue('gbs-bun-unit');
                    const hbMale = getNumericValue('gbs-hb-male');
                    const hbFemale = getNumericValue('gbs-hb-female');
                    const sbp = getNumericValue('gbs-sbp');
                    let valid = true;

                    if (!isValidNonNegativeNumber(bun)) { displayError('gbs-bun-error', 'Valid BUN/Urea.'); valid = false; }
                    // Only one Hb should be entered
                    if (isNaN(hbMale) && isNaN(hbFemale)) { displayError('gbs-hb-male-error', 'Enter Hb for Male OR Female.'); displayError('gbs-hb-female-error', 'Enter Hb for Male OR Female.'); valid = false; }
                    if (!isNaN(hbMale) && !isNaN(hbFemale)) { displayError('gbs-hb-male-error', 'Enter Hb for only ONE gender.'); displayError('gbs-hb-female-error', 'Enter Hb for only ONE gender.'); valid = false; }
                    if (!isNaN(hbMale) && !isValidPositiveNumber(hbMale)) { displayError('gbs-hb-male-error', 'Valid Male Hb.'); valid = false; }
                    if (!isNaN(hbFemale) && !isValidPositiveNumber(hbFemale)) { displayError('gbs-hb-female-error', 'Valid Female Hb.'); valid = false; }
                    if (!isValidPositiveNumber(sbp)) { displayError('gbs-sbp-error', 'Valid SBP.'); valid = false; }
                    if (!valid) return;

                    // Convert BUN if needed (mmol/L Urea to mg/dL BUN)
                    let bunMgDl = (bunUnit === 'mmol/L') ? bun / BUN_MG_PER_MMOL_UREA : bun;

                    // BUN points
                    if (bunMgDl >= 18 && bunMgDl < 22.4) score += 2; // 6.5-7.9 mmol/L
                    else if (bunMgDl >= 22.4 && bunMgDl < 28) score += 3; // 8-9.9 mmol/L
                    else if (bunMgDl >= 28 && bunMgDl < 70) score += 4; // 10-24.9 mmol/L
                    else if (bunMgDl >= 70) score += 6; // >= 25 mmol/L

                    // Hemoglobin points
                    if (!isNaN(hbMale)) {
                        if (hbMale >= 12 && hbMale < 13) score += 1;
                        else if (hbMale >= 10 && hbMale < 12) score += 3;
                        else if (hbMale < 10) score += 6;
                    } else if (!isNaN(hbFemale)) {
                        if (hbFemale >= 10 && hbFemale < 12) score += 1;
                        else if (hbFemale < 10) score += 6;
                    }

                    // SBP points
                    if (sbp >= 100 && sbp <= 109) score += 1;
                    else if (sbp >= 90 && sbp < 100) score += 2;
                    else if (sbp < 90) score += 3;

                    // Other markers
                    const otherMarkers = ['gbs-hr', 'gbs-melena', 'gbs-syncope', 'gbs-liver', 'gbs-cardiac'];
                    otherMarkers.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) score += parseFloat(cb.value); });

                    setHtml('gbs-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Risk Level', interp = '';
                    if (score === 0) { lvlClass = 'normal'; lvlText = 'Very Low Risk'; interp = 'Score 0: Very low risk (<1%) of needing intervention. Consider outpatient management.'; }
                    else if (score <= 2) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = `Score ${score}: Low risk. Outpatient management may be suitable for some.`; }
                    else if (score <= 5) { lvlClass = 'warning'; lvlText = 'Moderate Risk'; interp = `Score ${score}: Moderate risk. Admission usually recommended.`; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = `Score ${score}: High risk of intervention/rebleeding/death. Admission required.`; }
                    setInterpretation('gbs-level', 'gbs-interpretation', lvlClass, lvlText, interp);
                    showResultBox('gbs-result');
                });
            }


            // --- NEW CALCULATORS (39-42) ---

            // 39. PECARN Pediatric Head Injury
            const pecarnAgeSelect = document.getElementById('pecarn-age-group');
            const pecarnUnder2Fields = document.getElementById('pecarn-under2-fields');
            const pecarnOver2Fields = document.getElementById('pecarn-over2-fields');
            const calculatePecarnBtn = document.getElementById('calculate-pecarn');

            if (pecarnAgeSelect && pecarnUnder2Fields && pecarnOver2Fields) {
                pecarnAgeSelect.addEventListener('change', () => {
                    if (pecarnAgeSelect.value === 'under2') {
                        pecarnUnder2Fields.style.display = 'block';
                        pecarnOver2Fields.style.display = 'none';
                    } else {
                        pecarnUnder2Fields.style.display = 'none';
                        pecarnOver2Fields.style.display = 'block';
                    }
                });
            }

            if (calculatePecarnBtn) {
                calculatePecarnBtn.addEventListener('click', () => {
                    hideResultBox('pecarn-result');
                    const ageGroup = getValue('pecarn-age-group');
                    let ctCriteriaMet = false;
                    let obsCriteriaMet = false;
                    let resultText = '', levelClass = '', levelText = '', interp = '';

                    if (ageGroup === 'under2') {
                        const ctChecks = ['pecarn-u2-gcs', 'pecarn-u2-skull'];
                        const obsChecks = ['pecarn-u2-loc', 'pecarn-u2-mechanism', 'pecarn-u2-hematoma', 'pecarn-u2-behavior'];
                        ctChecks.forEach(id => { if (document.getElementById(id)?.checked) ctCriteriaMet = true; });
                        obsChecks.forEach(id => { if (document.getElementById(id)?.checked) obsCriteriaMet = true; });

                        if (ctCriteriaMet) {
                            resultText = 'CT Recommended'; levelClass = 'danger'; levelText = 'High Risk'; interp = 'Age < 2: CT recommended due to high-risk criteria (AMS or Palpable Skull Fracture).';
                        } else if (obsCriteriaMet) {
                            resultText = 'Observation vs CT'; levelClass = 'warning'; levelText = 'Intermediate Risk'; interp = 'Age < 2: Observation vs CT based on clinical judgment/shared decision making (Intermediate risk factors present).';
                        } else {
                            resultText = 'CT Not Recommended'; levelClass = 'normal'; levelText = 'Low Risk'; interp = 'Age < 2: CT not recommended (No PECARN criteria met, ciTBI risk < 0.02%).';
                        }
                    } else { // Age >= 2
                        const ctChecks = ['pecarn-o2-gcs', 'pecarn-o2-basilar'];
                        const obsChecks = ['pecarn-o2-loc', 'pecarn-o2-mechanism', 'pecarn-o2-vomiting', 'pecarn-o2-headache'];
                        ctChecks.forEach(id => { if (document.getElementById(id)?.checked) ctCriteriaMet = true; });
                        obsChecks.forEach(id => { if (document.getElementById(id)?.checked) obsCriteriaMet = true; });

                         if (ctCriteriaMet) {
                            resultText = 'CT Recommended'; levelClass = 'danger'; levelText = 'High Risk'; interp = 'Age ≥ 2: CT recommended due to high-risk criteria (AMS or Signs of Basilar Skull Fracture).';
                        } else if (obsCriteriaMet) {
                            resultText = 'Observation vs CT'; levelClass = 'warning'; levelText = 'Intermediate Risk'; interp = 'Age ≥ 2: Observation vs CT based on clinical judgment/shared decision making (Intermediate risk factors present).';
                        } else {
                            resultText = 'CT Not Recommended'; levelClass = 'normal'; levelText = 'Low Risk'; interp = 'Age ≥ 2: CT not recommended (No PECARN criteria met, ciTBI risk < 0.05%).';
                        }
                    }
                    setHtml('pecarn-value', resultText);
                    setInterpretation('pecarn-level', 'pecarn-interpretation', levelClass, levelText, interp);
                    showResultBox('pecarn-result');
                });
            }

            // 40. Caprini Score
            const calculateCapriniBtn = document.getElementById('calculate-caprini');
            if (calculateCapriniBtn) {
                calculateCapriniBtn.addEventListener('click', () => {
                    hideResultBox('caprini-result');
                    let score = 0;
                    const checkboxes = document.querySelectorAll('.calculator-card[data-calculator-name*="caprini"] input[type="checkbox"]');
                    checkboxes.forEach(cb => {
                        if (cb.checked) {
                            score += parseFloat(cb.value || '0');
                        }
                    });

                    // Handle age mutually exclusive points (take highest)
                    const age75 = document.getElementById('caprini-age75')?.checked;
                    const age61 = document.getElementById('caprini-age61')?.checked;
                    const age41 = document.getElementById('caprini-age41')?.checked;
                    if (age75 && age61) score -= 2; // Remove 61-74 points if 75+ selected
                    if (age75 && age41) score -= 1; // Remove 41-60 points if 75+ selected
                    if (age61 && age41) score -= 1; // Remove 41-60 points if 61-74 selected

                    setHtml('caprini-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'VTE Risk', interp = '';
                    if (score === 0) { lvlClass = 'normal'; lvlText = 'Very Low Risk'; interp = 'Score 0: Very low risk (~0.5%). Early ambulation recommended.'; }
                    else if (score <= 2) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = `Score ${score}: Low risk (~1.5%). Mechanical prophylaxis (e.g., SCDs) recommended.`; }
                    else if (score <= 4) { lvlClass = 'warning'; lvlText = 'Moderate Risk'; interp = `Score ${score}: Moderate risk (~3%). Pharmacologic prophylaxis (e.g., LMWH, UFH) OR mechanical recommended.`; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = `Score ${score}: High risk (~6%). Pharmacologic prophylaxis +/- mechanical recommended.`; }
                    setInterpretation('caprini-level', 'caprini-interpretation', lvlClass, lvlText, interp);
                    showResultBox('caprini-result');
                });
            }

            // 41. SIRS, Sepsis, Septic Shock Criteria
            const evaluateSepsisBtn = document.getElementById('evaluate-sepsis');
            if (evaluateSepsisBtn) {
                evaluateSepsisBtn.addEventListener('click', () => {
                    hideResultBox('sepsis-result');
                    let sirsCount = 0;
                    const sirsChecks = ['sirs-temp', 'sirs-hr', 'sirs-rr', 'sirs-wbc'];
                    sirsChecks.forEach(id => { if (document.getElementById(id)?.checked) sirsCount++; });
                    const meetsSirs = sirsCount >= 2;

                    const hasInfection = document.getElementById('sepsis-infection')?.checked;
                    const meetsSepsis = meetsSirs && hasInfection;

                    let organDysfunctionCount = 0;
                    const severeSepsisChecks = ['severe-sepsis-hypotension', 'severe-sepsis-lactate', 'severe-sepsis-urine', 'severe-sepsis-ali', 'severe-sepsis-creat', 'severe-sepsis-bili', 'severe-sepsis-plt', 'severe-sepsis-inr'];
                    severeSepsisChecks.forEach(id => { if (document.getElementById(id)?.checked) organDysfunctionCount++; });
                    const meetsSevereSepsis = meetsSepsis && organDysfunctionCount >= 1;

                    const meetsShockCriteria = document.getElementById('shock-severe-sepsis')?.checked && document.getElementById('shock-hypotension')?.checked;

                    let resultText = '', levelClass = 'info', levelText = 'Classification', interp = '';
                    if (meetsShockCriteria) {
                        resultText = 'Septic Shock'; levelClass = 'danger'; levelText = 'Septic Shock'; interp = 'Severe sepsis with persistent hypotension despite adequate fluid resuscitation.';
                    } else if (meetsSevereSepsis) {
                        resultText = 'Severe Sepsis'; levelClass = 'danger'; levelText = 'Severe Sepsis'; interp = `Sepsis plus ≥1 sign of organ dysfunction (${organDysfunctionCount} criteria met).`;
                    } else if (meetsSepsis) {
                        resultText = 'Sepsis'; levelClass = 'warning'; levelText = 'Sepsis'; interp = `Meets ≥2 SIRS criteria (${sirsCount}) with suspected/confirmed infection.`;
                    } else if (meetsSirs) {
                        resultText = 'SIRS'; levelClass = 'info'; levelText = 'SIRS'; interp = `Meets ≥2 SIRS criteria (${sirsCount}) without confirmed/suspected infection.`;
                    } else {
                        resultText = 'No Criteria Met'; levelClass = 'normal'; levelText = 'None'; interp = 'Does not meet criteria for SIRS, Sepsis, or Septic Shock based on selected inputs.';
                    }

                    setHtml('sepsis-value', resultText);
                    setInterpretation('sepsis-level', 'sepsis-interpretation', levelClass, levelText, interp);
                    showResultBox('sepsis-result');
                });
            }

            // 42. Pregnancy Due Dates Calculator
            const pregMethodSelect = document.getElementById('preg-method');
            const pregInputGroups = document.querySelectorAll('.preg-input-group');
            const calculatePregDatesBtn = document.getElementById('calculate-preg-dates');
            const todayDateField = document.getElementById('preg-today-date');

             // Set today's date default
             if (todayDateField) {
                 todayDateField.valueAsDate = new Date();
             }

            if (pregMethodSelect && pregInputGroups.length > 0) {
                pregMethodSelect.addEventListener('change', () => {
                    const selectedMethod = pregMethodSelect.value;
                    pregInputGroups.forEach(group => {
                        group.style.display = group.id.includes(selectedMethod) ? 'block' : 'none';
                    });
                });
            }

            function formatDate(date) {
                if (!date || isNaN(date.getTime())) return 'Invalid Date';
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            }

            function calculateGestationalAge(lmpDate, todayDate) {
                if (!lmpDate || !todayDate || isNaN(lmpDate.getTime()) || isNaN(todayDate.getTime())) return { weeks: NaN, days: NaN };
                const diffTime = todayDate.getTime() - lmpDate.getTime();
                const diffDaysTotal = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                const weeks = Math.floor(diffDaysTotal / 7);
                const days = diffDaysTotal % 7;
                return { weeks, days };
            }

            if (calculatePregDatesBtn) {
                calculatePregDatesBtn.addEventListener('click', () => {
                    clearErrors(['preg-lmp-date-error', 'preg-conception-date-error', 'preg-edd-date-error', 'preg-us-date-error', 'preg-us-ga-error']);
                    hideResultBox('preg-result');
                    setHtml('preg-edd-result', '');
                    setHtml('preg-ga-result', '');
                    setHtml('preg-conception-result', '');

                    const method = getValue('preg-method');
                    const todayDate = new Date(getValue('preg-today-date') + 'T00:00:00'); // Ensure local time zone
                    let edd = null, conceptionDate = null, lmpDate = null;
                    let valid = true;

                    try {
                        if (method === 'lmp') {
                            lmpDate = new Date(getValue('preg-lmp-date') + 'T00:00:00');
                            if (isNaN(lmpDate.getTime())) { displayError('preg-lmp-date-error', 'Valid LMP date required.'); valid = false; }
                            if (valid) {
                                edd = new Date(lmpDate.getTime());
                                edd.setDate(edd.getDate() + 280);
                                conceptionDate = new Date(lmpDate.getTime());
                                conceptionDate.setDate(conceptionDate.getDate() + 14);
                            }
                        } else if (method === 'conception') {
                            conceptionDate = new Date(getValue('preg-conception-date') + 'T00:00:00');
                            if (isNaN(conceptionDate.getTime())) { displayError('preg-conception-date-error', 'Valid conception date required.'); valid = false; }
                             if (valid) {
                                edd = new Date(conceptionDate.getTime());
                                edd.setDate(edd.getDate() + 266);
                                lmpDate = new Date(conceptionDate.getTime());
                                lmpDate.setDate(lmpDate.getDate() - 14);
                             }
                        } else if (method === 'edd') {
                            edd = new Date(getValue('preg-edd-date') + 'T00:00:00');
                            if (isNaN(edd.getTime())) { displayError('preg-edd-date-error', 'Valid EDD required.'); valid = false; }
                             if (valid) {
                                lmpDate = new Date(edd.getTime());
                                lmpDate.setDate(lmpDate.getDate() - 280);
                                conceptionDate = new Date(lmpDate.getTime());
                                conceptionDate.setDate(conceptionDate.getDate() + 14);
                             }
                        } else if (method === 'ultrasound') {
                            const usDate = new Date(getValue('preg-us-date') + 'T00:00:00');
                            const usWeeks = getNumericValue('preg-us-weeks');
                            const usDays = getNumericValue('preg-us-days') || 0;
                            if (isNaN(usDate.getTime())) { displayError('preg-us-date-error', 'Valid ultrasound date.'); valid = false; }
                            if (!isValidNonNegativeNumber(usWeeks)) { displayError('preg-us-ga-error', 'Valid weeks.'); valid = false; }
                            if (!isValidNonNegativeNumber(usDays) || usDays > 6) { displayError('preg-us-ga-error', 'Valid days (0-6).'); valid = false; }
                             if (valid) {
                                const totalDaysAtUS = usWeeks * 7 + usDays;
                                const daysFromUSToEDD = 280 - totalDaysAtUS;
                                edd = new Date(usDate.getTime());
                                edd.setDate(edd.getDate() + daysFromUSToEDD);
                                lmpDate = new Date(edd.getTime());
                                lmpDate.setDate(lmpDate.getDate() - 280);
                                conceptionDate = new Date(lmpDate.getTime());
                                conceptionDate.setDate(conceptionDate.getDate() + 14);
                             }
                        }

                        if (valid && !isNaN(todayDate.getTime())) {
                            const ga = calculateGestationalAge(lmpDate, todayDate);
                            if (!isNaN(ga.weeks)) {
                                setHtml('preg-ga-result', `Current Gestational Age: ${ga.weeks} weeks, ${ga.days} days`);
                            }
                            setHtml('preg-edd-result', `Estimated Due Date (EDD): ${formatDate(edd)}`);
                            setHtml('preg-conception-result', `Approximate Conception Date: ${formatDate(conceptionDate)}`);
                            showResultBox('preg-result');
                        } else if (valid) {
                             displayError('preg-today-date-error', 'Valid Today\'s date required for GA.');
                        }

                    } catch (e) {
                        console.error("Date calculation error:", e);
                         setHtml('preg-edd-result', 'Calculation Error');
                         showResultBox('preg-result');
                    }
                });
            }


            // --- NEW CALCULATORS (43-46) ---

            // 43. NIH Stroke Scale (NIHSS)
            const calculateNihssBtn = document.getElementById('calculate-nihss');
            if (calculateNihssBtn) {
                calculateNihssBtn.addEventListener('click', () => {
                    hideResultBox('nihss-result');
                    let score = 0;
                    const items = ['1a', '1b', '1c', '2', '3', '4', '5a', '5b', '6a', '6b', '7', '8', '9', '10', '11'];
                    items.forEach(item => {
                        const value = parseInt(getValue(`nihss-${item}`) || '0');
                        if (value !== 9) { // Exclude untestable items
                            score += value;
                        }
                    });

                    setHtml('nihss-value', `Score: ${score}`);
                    let lvlClass = 'info', lvlText = 'Severity', interp = '';
                    if (score === 0) { lvlClass = 'normal'; lvlText = 'No Stroke Symptoms'; interp = 'Score 0'; }
                    else if (score <= 4) { lvlClass = 'normal'; lvlText = 'Minor Stroke'; interp = 'Score 1-4'; }
                    else if (score <= 15) { lvlClass = 'warning'; lvlText = 'Moderate Stroke'; interp = 'Score 5-15'; }
                    else if (score <= 20) { lvlClass = 'danger'; lvlText = 'Moderate-Severe Stroke'; interp = 'Score 16-20'; }
                    else { lvlClass = 'danger'; lvlText = 'Severe Stroke'; interp = 'Score 21-42'; }
                    setInterpretation('nihss-level', 'nihss-interpretation', lvlClass, lvlText, interp);
                    showResultBox('nihss-result');
                });
            }

            // 44. SOFA Score
            const calculateSofaBtn = document.getElementById('calculate-sofa');
            if (calculateSofaBtn) {
                calculateSofaBtn.addEventListener('click', () => {
                    clearErrors(['sofa-pao2-fio2-error', 'sofa-platelets-error', 'sofa-bilirubin-error', 'sofa-map-error', 'sofa-gcs-error', 'sofa-creatinine-error', 'sofa-urine-error']);
                    hideResultBox('sofa-result');
                    let score = 0;
                    let valid = true;

                    // Respiration
                    const pao2fio2 = getNumericValue('sofa-pao2-fio2');
                    const mechVent = document.getElementById('sofa-mech-vent')?.checked;
                    if (!isValidNonNegativeNumber(pao2fio2)) { displayError('sofa-pao2-fio2-error', 'Valid PaO₂/FiO₂.'); valid = false; }
                    else {
                        if (pao2fio2 < 100 && mechVent) score += 4;
                        else if (pao2fio2 < 200 && mechVent) score += 3;
                        else if (pao2fio2 < 300) score += 2;
                        else if (pao2fio2 < 400) score += 1;
                        // else score += 0; // >= 400
                    }

                    // Coagulation
                    const platelets = getNumericValue('sofa-platelets');
                    if (!isValidNonNegativeNumber(platelets)) { displayError('sofa-platelets-error', 'Valid Platelets.'); valid = false; }
                    else {
                        if (platelets < 20) score += 4;
                        else if (platelets < 50) score += 3;
                        else if (platelets < 100) score += 2;
                        else if (platelets < 150) score += 1;
                        // else score += 0; // >= 150
                    }

                    // Liver
                    let bilirubin = getNumericValue('sofa-bilirubin');
                    const biliUnit = getValue('sofa-bilirubin-unit');
                    if (!isValidNonNegativeNumber(bilirubin)) { displayError('sofa-bilirubin-error', 'Valid Bilirubin.'); valid = false; }
                    else {
                        let biliMgDl = (biliUnit === 'μmol/L') ? bilirubin / 17.1 : bilirubin;
                        if (biliMgDl >= 12.0) score += 4;
                        else if (biliMgDl >= 6.0) score += 3;
                        else if (biliMgDl >= 2.0) score += 2;
                        else if (biliMgDl >= 1.2) score += 1;
                        // else score += 0; // < 1.2
                    }

                    // Cardiovascular
                    const cardioSelect = getValue('sofa-cardio');
                    const mapInput = getNumericValue('sofa-map');
                    if (cardioSelect === '0' || cardioSelect === '1') {
                        if (!isValidNonNegativeNumber(mapInput)) { displayError('sofa-map-error', 'Enter MAP if no pressors.'); valid = false; }
                        else if (mapInput < 70) score += 1;
                        // else score += 0; // MAP >= 70
                    } else {
                        score += parseInt(cardioSelect || '0'); // Use score from select if pressors used
                    }


                    // CNS
                    const gcs = getNumericValue('sofa-gcs');
                    if (!isValidNumber(gcs) || gcs < 3 || gcs > 15) { displayError('sofa-gcs-error', 'Valid GCS (3-15).'); valid = false; }
                    else {
                        if (gcs < 6) score += 4;
                        else if (gcs < 10) score += 3;
                        else if (gcs < 13) score += 2;
                        else if (gcs < 15) score += 1;
                        // else score += 0; // GCS = 15
                    }

                    // Renal
                    let creat = getNumericValue('sofa-creatinine');
                    const creatUnit = getValue('sofa-creatinine-unit');
                    const urine = getNumericValue('sofa-urine');
                    let renalScore = 0;
                    if (!isValidNonNegativeNumber(creat) && !isValidNonNegativeNumber(urine)) { displayError('sofa-creatinine-error', 'Need Creatinine OR UO.'); displayError('sofa-urine-error', 'Need Creatinine OR UO.'); valid = false; }
                    else {
                        let creatMgDl = NaN;
                        if (isValidNonNegativeNumber(creat)) {
                             creatMgDl = (creatUnit === 'μmol/L') ? creat / 88.4 : creat;
                        }

                        let creatPoints = 0;
                        if (!isNaN(creatMgDl)) {
                            if (creatMgDl >= 5.0) creatPoints = 4;
                            else if (creatMgDl >= 3.5) creatPoints = 3;
                            else if (creatMgDl >= 2.0) creatPoints = 2;
                            else if (creatMgDl >= 1.2) creatPoints = 1;
                        }

                        let urinePoints = 0;
                        if (isValidNonNegativeNumber(urine)) {
                            if (urine < 200) urinePoints = 4;
                            else if (urine < 500) urinePoints = 3;
                        }
                         // Take the higher score between creatinine and urine output
                         renalScore = Math.max(creatPoints, urinePoints);
                         score += renalScore;
                    }


                    if (valid) {
                        setHtml('sofa-value', `Score: ${score}`);
                        setHtml('sofa-interpretation', `Total SOFA Score (Max 24)`);
                        showResultBox('sofa-result');
                    } else {
                         setHtml('sofa-value', 'Input Error');
                         setHtml('sofa-interpretation', 'Check input fields.');
                         showResultBox('sofa-result');
                    }
                });
            }

            // 45. MELD-Na Score
            const calculateMeldNaBtn = document.getElementById('calculate-meld-na');
            if (calculateMeldNaBtn) {
                calculateMeldNaBtn.addEventListener('click', () => {
                    clearErrors(['meld-creat-error', 'meld-bili-error', 'meld-inr-error', 'meld-sodium-error']);
                    hideResultBox('meld-na-result');
                    let creat = getNumericValue('meld-creat');
                    let bili = getNumericValue('meld-bili');
                    let inr = getNumericValue('meld-inr');
                    let sodium = getNumericValue('meld-sodium');
                    const dialysis = document.getElementById('meld-dialysis')?.checked;
                    let valid = true;

                    if (!isValidPositiveNumber(creat)) { displayError('meld-creat-error', 'Valid Creatinine.'); valid = false; }
                    if (!isValidPositiveNumber(bili)) { displayError('meld-bili-error', 'Valid Bilirubin.'); valid = false; }
                    if (!isValidPositiveNumber(inr)) { displayError('meld-inr-error', 'Valid INR.'); valid = false; }
                    if (!isValidNumber(sodium) || sodium < 100 || sodium > 180) { displayError('meld-sodium-error', 'Valid Sodium (100-180).'); valid = false; }
                    if (!valid) return;

                    // Apply UNOS/OPTN flooring/capping rules
                    if (dialysis && creat < 1.2) creat = 1.2; // Floor Cr if dialysis
                    creat = Math.max(1.0, creat); // Floor Cr at 1.0
                    creat = Math.min(4.0, creat); // Cap Cr at 4.0
                    bili = Math.max(1.0, bili);   // Floor Bili at 1.0
                    inr = Math.max(1.0, inr);    // Floor INR at 1.0
                    sodium = Math.max(125, sodium); // Floor Na at 125
                    sodium = Math.min(137, sodium); // Cap Na at 137

                    // Calculate MELD score first
                    let meld = 0.957 * Math.log(creat) + 0.378 * Math.log(bili) + 1.120 * Math.log(inr) + 0.643;
                    meld = meld * 10; // Multiply by 10

                    // Adjust for Sodium (MELD-Na)
                    let meldNa = meld;
                    if (meld > 11) { // Apply Na adjustment only if MELD > 11
                         meldNa = meld + 1.32 * (137 - sodium) - (0.033 * meld * (137 - sodium));
                    }

                    // Final score capping and rounding
                    meldNa = Math.min(40, meldNa); // Cap final score at 40
                    meldNa = Math.max(6, meldNa);  // Floor final score at 6 (though calculation usually results > 6)
                    meldNa = Math.round(meldNa);

                    setHtml('meld-na-value', `${meldNa}`);
                    setHtml('meld-na-interpretation', `MELD-Na Score (Range 6-40)`);
                    showResultBox('meld-na-result');
                });
            }

            // 46. ABG Analyzer
            const calculateAbgBtn = document.getElementById('calculate-abg');
            if (calculateAbgBtn) {
                calculateAbgBtn.addEventListener('click', () => {
                    clearErrors(['abg-ph-error', 'abg-pco2-error', 'abg-hco3-error', 'abg-na-error', 'abg-cl-error']);
                    hideResultBox('abg-result');
                    document.getElementById('abg-anion-gap-section').style.display = 'none';
                    document.getElementById('abg-delta-ratio-section').style.display = 'none';
                    document.getElementById('abg-winters-section').style.display = 'none';

                    const ph = getNumericValue('abg-ph');
                    const pco2 = getNumericValue('abg-pco2');
                    const hco3 = getNumericValue('abg-hco3');
                    const na = getNumericValue('abg-na'); // Optional
                    const cl = getNumericValue('abg-cl'); // Optional
                    let valid = true;

                    if (!isValidNumber(ph) || ph < 6.8 || ph > 7.8) { displayError('abg-ph-error', 'Valid pH (6.8-7.8).'); valid = false; }
                    if (!isValidPositiveNumber(pco2) || pco2 < 10 || pco2 > 150) { displayError('abg-pco2-error', 'Valid PaCO₂.'); valid = false; }
                    if (!isValidPositiveNumber(hco3) || hco3 < 5 || hco3 > 60) { displayError('abg-hco3-error', 'Valid HCO₃⁻.'); valid = false; }
                    if (!isNaN(na) && (!isValidPositiveNumber(na) || na < 100 || na > 180)) { displayError('abg-na-error', 'Valid Na⁺ or leave blank.'); valid = false; }
                    if (!isNaN(cl) && (!isValidPositiveNumber(cl) || cl < 70 || cl > 130)) { displayError('abg-cl-error', 'Valid Cl⁻ or leave blank.'); valid = false; }
                    if (!isNaN(na) && isNaN(cl)) { displayError('abg-cl-error', 'Need Cl⁻ if Na⁺ provided for AG.'); valid = false; }
                    if (isNaN(na) && !isNaN(cl)) { displayError('abg-na-error', 'Need Na⁺ if Cl⁻ provided for AG.'); valid = false; }

                    if (!valid) {
                         setHtml('abg-primary-disorder', 'Input Error');
                         showResultBox('abg-result');
                         return;
                    }

                    let primaryDisorder = "Normal ABG";
                    let compensation = "";
                    const normalPHLow = 7.35, normalPHHigh = 7.45;
                    const normalPCO2Low = 35, normalPCO2High = 45;
                    const normalHCO3Low = 22, normalHCO3High = 26;

                    // Determine primary disorder
                    if (ph < normalPHLow) { // Acidosis
                        if (pco2 > normalPCO2High) primaryDisorder = "Respiratory Acidosis";
                        else if (hco3 < normalHCO3Low) primaryDisorder = "Metabolic Acidosis";
                        else primaryDisorder = "Mixed Acidosis"; // Should not happen if values consistent
                    } else if (ph > normalPHHigh) { // Alkalosis
                        if (pco2 < normalPCO2Low) primaryDisorder = "Respiratory Alkalosis";
                        else if (hco3 > normalHCO3High) primaryDisorder = "Metabolic Alkalosis";
                        else primaryDisorder = "Mixed Alkalosis"; // Should not happen
                    } else { // Normal pH - check for compensated disorder or truly normal
                        if (pco2 > normalPCO2High && hco3 > normalHCO3High) primaryDisorder = "Compensated Respiratory Acidosis";
                        else if (pco2 < normalPCO2Low && hco3 < normalHCO3Low) primaryDisorder = "Compensated Respiratory Alkalosis";
                        // Note: Fully compensated metabolic disorders are less common or may represent mixed picture
                        else if (pco2 < normalPCO2Low && hco3 > normalHCO3High) primaryDisorder = "Likely Compensated Metabolic Alkalosis or Mixed";
                        else if (pco2 > normalPCO2High && hco3 < normalHCO3Low) primaryDisorder = "Likely Compensated Metabolic Acidosis or Mixed";
                    }

                    // Assess Compensation
                    if (primaryDisorder === "Metabolic Acidosis") {
                        const expectedPCO2 = 1.5 * hco3 + 8;
                        const rangeLow = expectedPCO2 - 2;
                        const rangeHigh = expectedPCO2 + 2;
                        compensation = `Expected PaCO₂ (Winter's): ${rangeLow.toFixed(1)} - ${rangeHigh.toFixed(1)} mmHg. `;
                        if (pco2 >= rangeLow && pco2 <= rangeHigh) compensation += "Compensation is appropriate.";
                        else if (pco2 < rangeLow) compensation += "Suggests superimposed Respiratory Alkalosis.";
                        else compensation += "Suggests superimposed Respiratory Acidosis.";
                         document.getElementById('abg-winters-section').style.display = 'block';
                         setHtml('abg-winters-value', `Expected PaCO₂: ${rangeLow.toFixed(1)}-${rangeHigh.toFixed(1)}`);
                         setHtml('abg-winters-interp', compensation);
                    } else if (primaryDisorder === "Metabolic Alkalosis") {
                        const expectedPCO2 = 0.7 * (hco3 - 24) + 40; // Approximate rule: PCO2 increases 0.7 for each 1 rise in HCO3
                         const rangeLow = expectedPCO2 - 5; // Wider range often used
                         const rangeHigh = expectedPCO2 + 5;
                        compensation = `Expected PaCO₂: ~${rangeLow.toFixed(1)} - ${rangeHigh.toFixed(1)} mmHg. `;
                        if (pco2 >= rangeLow && pco2 <= rangeHigh) compensation += "Compensation appears appropriate.";
                        else if (pco2 < rangeLow) compensation += "Suggests superimposed Respiratory Alkalosis.";
                        else compensation += "Suggests superimposed Respiratory Acidosis.";
                    } else if (primaryDisorder === "Respiratory Acidosis") {
                        // Acute: HCO3 increases 1 for each 10 increase in PCO2
                        // Chronic: HCO3 increases 3.5-4 for each 10 increase in PCO2
                        const deltaPCO2 = pco2 - 40;
                        const expectedHCO3_acute = 24 + (deltaPCO2 / 10) * 1;
                        const expectedHCO3_chronic = 24 + (deltaPCO2 / 10) * 3.5;
                         compensation = `Expected HCO₃⁻: Acute ~${expectedHCO3_acute.toFixed(1)}, Chronic ~${expectedHCO3_chronic.toFixed(1)}. `;
                         if (hco3 > expectedHCO3_chronic + 2) compensation += "Suggests superimposed Metabolic Alkalosis.";
                         else if (hco3 < expectedHCO3_acute - 2) compensation += "Suggests superimposed Metabolic Acidosis.";
                         else compensation += "Compensation may be appropriate depending on chronicity.";
                    } else if (primaryDisorder === "Respiratory Alkalosis") {
                         // Acute: HCO3 decreases 2 for each 10 decrease in PCO2
                         // Chronic: HCO3 decreases 4-5 for each 10 decrease in PCO2
                         const deltaPCO2 = 40 - pco2;
                         const expectedHCO3_acute = 24 - (deltaPCO2 / 10) * 2;
                         const expectedHCO3_chronic = 24 - (deltaPCO2 / 10) * 4.5; // Using 4.5 avg
                         compensation = `Expected HCO₃⁻: Acute ~${expectedHCO3_acute.toFixed(1)}, Chronic ~${expectedHCO3_chronic.toFixed(1)}. `;
                         if (hco3 > expectedHCO3_acute + 2) compensation += "Suggests superimposed Metabolic Alkalosis.";
                         else if (hco3 < expectedHCO3_chronic - 2) compensation += "Suggests superimposed Metabolic Acidosis.";
                         else compensation += "Compensation may be appropriate depending on chronicity.";
                    }

                    setHtml('abg-primary-disorder', primaryDisorder);
                    setHtml('abg-compensation', compensation);

                    // Anion Gap and Delta Ratio if applicable
                    if (!isNaN(na) && !isNaN(cl)) {
                        const anionGap = na - (cl + hco3);
                        setHtml('abg-anion-gap-value', `Anion Gap: ${anionGap.toFixed(1)} mEq/L`);
                        let agInterp = (anionGap > 12) ? "Elevated Anion Gap." : "Normal Anion Gap.";
                        setHtml('abg-anion-gap-interp', agInterp);
                        document.getElementById('abg-anion-gap-section').style.display = 'block';

                        if (primaryDisorder.includes("Metabolic Acidosis") && anionGap > 12) {
                            const deltaGap = anionGap - 12;
                            const deltaHCO3 = 24 - hco3;
                            if (deltaHCO3 !== 0) {
                                const deltaRatio = deltaGap / deltaHCO3;
                                setHtml('abg-delta-ratio-value', `Delta Ratio: ${deltaRatio.toFixed(2)}`);
                                let drInterp = "";
                                if (deltaRatio < 0.8) drInterp = "Suggests concurrent Normal Anion Gap Metabolic Acidosis.";
                                else if (deltaRatio <= 1.2) drInterp = "Suggests pure High Anion Gap Metabolic Acidosis."; // Often cited as 1-2 range
                                else drInterp = "Suggests concurrent Metabolic Alkalosis or compensated Chronic Respiratory Acidosis.";
                                setHtml('abg-delta-ratio-interp', drInterp);
                                document.getElementById('abg-delta-ratio-section').style.display = 'block';
                            }
                        }
                    }

                    showResultBox('abg-result');
                });
            }


            // --- NEW CALCULATORS (47) ---

            // 47. ASCVD Risk Calculator (2013 AHA/ACC)
            const calculateAscvdBtn = document.getElementById('calculate-ascvd');
            if (calculateAscvdBtn) {
                calculateAscvdBtn.addEventListener('click', () => {
                    clearErrors(['ascvd-age-error', 'ascvd-tc-error', 'ascvd-hdl-error', 'ascvd-sbp-error']);
                    hideResultBox('ascvd-result');
                    document.getElementById('ascvd-lifetime-value').style.display = 'none';
                    document.getElementById('ascvd-lifetime-interp').style.display = 'none';

                    const age = getNumericValue('ascvd-age');
                    const gender = getValue('ascvd-gender');
                    let race = getValue('ascvd-race');
                    if (race === 'other') race = 'white'; // Use white coefficients for 'Other'
                    const tc = getNumericValue('ascvd-tc');
                    const hdl = getNumericValue('ascvd-hdl');
                    const sbp = getNumericValue('ascvd-sbp');
                    const bpTreated = document.getElementById('ascvd-bp-treated')?.checked;
                    const diabetes = document.getElementById('ascvd-diabetes')?.checked;
                    const smoker = document.getElementById('ascvd-smoker')?.checked;
                    let valid = true;

                    if (!isValidNumber(age) || age < 40 || age > 79) { displayError('ascvd-age-error', 'Age must be 40-79.'); valid = false; }
                    if (!isValidPositiveNumber(tc) || tc < 130 || tc > 320) { displayError('ascvd-tc-error', 'Valid TC (130-320).'); valid = false; }
                    if (!isValidPositiveNumber(hdl) || hdl < 20 || hdl > 100) { displayError('ascvd-hdl-error', 'Valid HDL (20-100).'); valid = false; }
                    if (!isValidPositiveNumber(sbp) || sbp < 90 || sbp > 200) { displayError('ascvd-sbp-error', 'Valid SBP (90-200).'); valid = false; }
                    if (!valid) return;

                    const lnAge = Math.log(age);
                    const lnTc = Math.log(tc);
                    const lnHDL = Math.log(hdl);
                    const lnSBPtreated = bpTreated ? Math.log(sbp) : 0;
                    const lnSBPuntreated = !bpTreated ? Math.log(sbp) : 0;
                    const ageTc = lnAge * lnTc;
                    const ageHDL = lnAge * lnHDL;
                    const ageSBPtreated = bpTreated ? lnAge * Math.log(sbp) : 0;
                    const ageSBPuntreated = !bpTreated ? lnAge * Math.log(sbp) : 0;
                    const ageSmoker = smoker ? lnAge : 0;
                    const diabetesTerm = diabetes ? 1 : 0;
                    const smokerTerm = smoker ? 1 : 0;

                    let individualSum = 0;
                    let meanCoeff = 0;
                    let baseSurvival = 0;

                    if (gender === 'female') {
                        if (race === 'white') {
                            individualSum = -29.799 * lnAge + 4.884 * lnAge * lnAge + 13.540 * lnTc - 3.375 * ageTc +
                                            -13.578 * lnHDL + 3.149 * ageHDL + 2.019 * lnSBPuntreated + 1.957 * lnSBPtreated +
                                            7.574 * smokerTerm - 1.665 * ageSmoker + 0.661 * diabetesTerm;
                            meanCoeff = -29.18;
                            baseSurvival = 0.9665;
                        } else { // African American Female
                            individualSum = 17.114 * lnAge + 0 * lnAge * lnAge + 0.940 * lnTc + 0 * ageTc +
                                            -18.920 * lnHDL + 4.475 * ageHDL + 29.291 * lnSBPuntreated - 6.432 * ageSBPuntreated +
                                            27.820 * lnSBPtreated - 6.087 * ageSBPtreated + 0.691 * smokerTerm + 0 * ageSmoker +
                                            0.874 * diabetesTerm;
                            meanCoeff = 86.61;
                            baseSurvival = 0.9533;
                        }
                    } else { // Male
                        if (race === 'white') {
                            individualSum = 12.344 * lnAge + 0 * lnAge * lnAge + 11.853 * lnTc - 2.664 * ageTc +
                                            -7.990 * lnHDL + 1.769 * ageHDL + 1.797 * lnSBPuntreated + 1.764 * lnSBPtreated +
                                            7.837 * smokerTerm - 1.795 * ageSmoker + 0.658 * diabetesTerm;
                            meanCoeff = 61.18;
                            baseSurvival = 0.9144;
                        } else { // African American Male
                            individualSum = 2.469 * lnAge + 0 * lnAge * lnAge + 0.302 * lnTc + 0 * ageTc +
                                            -0.307 * lnHDL + 0 * ageHDL + 1.916 * lnSBPuntreated + 1.809 * lnSBPtreated +
                                            0.549 * smokerTerm + 0 * ageSmoker + 0.645 * diabetesTerm;
                            meanCoeff = 19.54;
                            baseSurvival = 0.8954;
                        }
                    }

                    const riskScore = 1 - Math.pow(baseSurvival, Math.exp(individualSum - meanCoeff));
                    const riskPercent = (riskScore * 100).toFixed(1);

                    setHtml('ascvd-value', `${riskPercent}%`);
                    let lvlClass = 'info', lvlText = 'Risk Category', interp = '';
                    if (riskPercent < 5) { lvlClass = 'normal'; lvlText = 'Low Risk'; interp = '< 5%: Lifestyle modification focus.'; }
                    else if (riskPercent < 7.5) { lvlClass = 'warning'; lvlText = 'Borderline Risk'; interp = '5% to <7.5%: Consider risk enhancers, discuss statin.'; }
                    else if (riskPercent < 20) { lvlClass = 'danger'; lvlText = 'Intermediate Risk'; interp = '7.5% to <20%: Initiate moderate-intensity statin if risk enhancers present or after discussion.'; }
                    else { lvlClass = 'danger'; lvlText = 'High Risk'; interp = '≥ 20%: Initiate high-intensity statin.'; }
                    setInterpretation('ascvd-level', 'ascvd-interpretation', lvlClass, lvlText, interp);

                    // Optional: Add lifetime risk calculation/display if needed (more complex)

                    showResultBox('ascvd-result');
                });
            }


            // --- NEW CALCULATORS (48-49) ---

            // 48. PSI/PORT Score
            const calculatePsiBtn = document.getElementById('calculate-psi');
            if (calculatePsiBtn) {
                calculatePsiBtn.addEventListener('click', () => {
                    clearErrors(['psi-age-error', 'psi-bun-error', 'psi-sodium-error', 'psi-glucose-error', 'psi-hct-error', 'psi-pao2-error', 'psi-sat-error']);
                    hideResultBox('psi-result');
                    let score = 0;
                    let valid = true;

                    const age = getNumericValue('psi-age');
                    const gender = getValue('psi-gender');
                    if (!isValidNonNegativeNumber(age)) { displayError('psi-age-error', 'Valid Age.'); valid = false; }
                    else { score += (gender === 'male' ? age : Math.max(0, age - 10)); } // Age points

                    if (document.getElementById('psi-nursing-home')?.checked) score += 10;
                    if (document.getElementById('psi-cancer')?.checked) score += 30;
                    if (document.getElementById('psi-liver')?.checked) score += 20;
                    if (document.getElementById('psi-chf')?.checked) score += 10;
                    if (document.getElementById('psi-cvd')?.checked) score += 10;
                    if (document.getElementById('psi-renal')?.checked) score += 10;
                    if (document.getElementById('psi-ams')?.checked) score += 20;
                    if (document.getElementById('psi-rr')?.checked) score += 20;
                    if (document.getElementById('psi-sbp')?.checked) score += 20;
                    if (document.getElementById('psi-temp')?.checked) score += 15;
                    if (document.getElementById('psi-hr')?.checked) score += 10;
                    if (document.getElementById('psi-ph')?.checked) score += 30;

                    let bun = getNumericValue('psi-bun');
                    const bunUnit = getValue('psi-bun-unit');
                    if (!isNaN(bun)) {
                        let bunMgDl = (bunUnit === 'mmol/L') ? bun / BUN_MG_PER_MMOL_UREA : bun;
                        if (bunMgDl >= 30) score += 20;
                    } else if (getValue('psi-bun').trim() !== '') { displayError('psi-bun-error', 'Valid BUN/Urea.'); valid = false; }

                    const sodium = getNumericValue('psi-sodium');
                    if (!isNaN(sodium)) { if (sodium < 130) score += 20; }
                    else if (getValue('psi-sodium').trim() !== '') { displayError('psi-sodium-error', 'Valid Sodium.'); valid = false; }

                    let glucose = getNumericValue('psi-glucose');
                    const glucoseUnit = getValue('psi-glucose-unit');
                    if (!isNaN(glucose)) {
                        let glucMgDl = (glucoseUnit === 'mmol/L') ? glucose * GLUC_MG_PER_MMOL : glucose;
                        if (glucMgDl >= 250) score += 10;
                    } else if (getValue('psi-glucose').trim() !== '') { displayError('psi-glucose-error', 'Valid Glucose.'); valid = false; }

                    const hct = getNumericValue('psi-hct');
                    if (!isNaN(hct)) { if (hct < 30) score += 10; }
                    else if (getValue('psi-hct').trim() !== '') { displayError('psi-hct-error', 'Valid Hct.'); valid = false; }

                    const pao2 = getNumericValue('psi-pao2');
                    const sat = getNumericValue('psi-sat');
                    if (!isNaN(pao2)) { if (pao2 < 60) score += 10; }
                    else if (!isNaN(sat)) { if (sat < 90) score += 10; }
                    else if (getValue('psi-pao2').trim() !== '' || getValue('psi-sat').trim() !== '') { displayError('psi-pao2-error', 'Valid PaO₂ or Sat.'); valid = false; }

                    if (document.getElementById('psi-pleural-effusion')?.checked) score += 10;

                    if (valid) {
                        setHtml('psi-value', `Score: ${score}`);
                        let lvlClass = 'info', lvlText = 'Risk Class', interp = '';
                        if (score <= 50) { lvlClass = 'normal'; lvlText = 'Class I'; interp = `Score ≤ 50: Very Low Risk (~0.1%). Outpatient care.`; }
                        else if (score <= 70) { lvlClass = 'normal'; lvlText = 'Class II'; interp = `Score 51-70: Low Risk (~0.6%). Outpatient care.`; }
                        else if (score <= 90) { lvlClass = 'warning'; lvlText = 'Class III'; interp = `Score 71-90: Low Risk (~0.9-2.8%). Outpatient vs Observation.`; }
                        else if (score <= 130) { lvlClass = 'danger'; lvlText = 'Class IV'; interp = `Score 91-130: Moderate Risk (~8-9%). Inpatient care.`; }
                        else { lvlClass = 'danger'; lvlText = 'Class V'; interp = `Score > 130: High Risk (~27-29%). Inpatient care (consider ICU).`; }
                        setInterpretation('psi-level', 'psi-interpretation', lvlClass, lvlText, interp);
                        showResultBox('psi-result');
                    } else {
                        setHtml('psi-value', 'Input Error');
                        setInterpretation('psi-level', 'psi-interpretation', 'danger', 'Error', 'Check input fields.');
                        showResultBox('psi-result');
                    }
                });
            }

            // 49. Sodium Correction Rate
            const nacorrFluidSelect = document.getElementById('nacorr-fluid-type');
            const nacorrCustomInput = document.getElementById('nacorr-custom-na-k');
            const calculateNacorrBtn = document.getElementById('calculate-nacorr');

            if (nacorrFluidSelect && nacorrCustomInput) {
                nacorrFluidSelect.addEventListener('change', () => {
                    nacorrCustomInput.style.display = (nacorrFluidSelect.value === 'custom') ? 'block' : 'none';
                });
            }

            if (calculateNacorrBtn) {
                calculateNacorrBtn.addEventListener('click', () => {
                    clearErrors(['nacorr-current-na-error', 'nacorr-target-na-error', 'nacorr-weight-error', 'nacorr-rate-hours-error']);
                    hideResultBox('nacorr-result');
                    setHtml('nacorr-total-volume', '');
                    document.getElementById('nacorr-total-volume').style.display = 'none';

                    const currentNa = getNumericValue('nacorr-current-na');
                    const targetNa = getNumericValue('nacorr-target-na');
                    const weight = getNumericValue('nacorr-weight');
                    const genderFactorStr = getValue('nacorr-gender');
                    const fluidTypeVal = getValue('nacorr-fluid-type');
                    const customNaK = getNumericValue('nacorr-custom-na-k');
                    const hours = getNumericValue('nacorr-rate-hours');
                    let valid = true;

                    if (!isValidNumber(currentNa) || currentNa < 100 || currentNa > 180) { displayError('nacorr-current-na-error', 'Valid Current Na⁺.'); valid = false; }
                    if (!isValidNumber(targetNa) || targetNa < 100 || targetNa > 180) { displayError('nacorr-target-na-error', 'Valid Target Na⁺.'); valid = false; }
                    if (valid && currentNa === targetNa) { displayError('nacorr-target-na-error', 'Target Na⁺ must differ from Current Na⁺.'); valid = false; }
                    if (!isValidPositiveNumber(weight)) { displayError('nacorr-weight-error', 'Valid Weight (kg).'); valid = false; }
                    if (!isValidPositiveNumber(hours)) { displayError('nacorr-rate-hours-error', 'Valid Hours.'); valid = false; }

                    let infusateNaK = 0;
                    if (fluidTypeVal === 'custom') {
                        if (!isValidNonNegativeNumber(customNaK)) { displayError('nacorr-fluid-type', 'Valid Custom Na+K.'); valid = false; }
                        else infusateNaK = customNaK;
                    } else {
                        infusateNaK = parseFloat(fluidTypeVal);
                    }

                    if (!valid) return;

                    let tbwFactor = 0.6; // Default male
                    if (genderFactorStr === 'female') tbwFactor = 0.5;
                    else if (genderFactorStr === 'elderly_male') tbwFactor = 0.5;
                    else if (genderFactorStr === 'elderly_female') tbwFactor = 0.45;

                    const tbw = weight * tbwFactor;
                    const changePerLiter = (infusateNaK - currentNa) / (tbw + 1);
                    const desiredTotalChange = targetNa - currentNa;
                    const desiredChangePerHour = desiredTotalChange / hours;

                    let infusionRate = NaN;
                    if (changePerLiter !== 0) {
                        infusionRate = (desiredChangePerHour / changePerLiter) * 1000; // Rate in mL/hr
                    }

                    setHtml('nacorr-tbw-result', `Estimated TBW: ${tbw.toFixed(1)} L`);
                    setHtml('nacorr-change-per-liter', `Est. Change in Serum Na⁺ per 1L Fluid: ${changePerLiter.toFixed(2)} mEq/L`);

                    if (!isNaN(infusionRate) && isFinite(infusionRate)) {
                         // Check if correction direction matches fluid effect
                         if ((desiredTotalChange > 0 && changePerLiter < 0) || (desiredTotalChange < 0 && changePerLiter > 0)) {
                              setHtml('nacorr-infusion-rate', `Infusion Rate: Cannot achieve target Na⁺ change direction with this fluid.`);
                         } else {
                              setHtml('nacorr-infusion-rate', `Required Infusion Rate: ${Math.abs(infusionRate).toFixed(1)} mL/hr`);
                              const totalVolume = Math.abs(infusionRate) * hours;
                              setHtml('nacorr-total-volume', `Approx. Total Volume over ${hours}h: ${totalVolume.toFixed(0)} mL`);
                              document.getElementById('nacorr-total-volume').style.display = 'block';
                         }
                    } else if (changePerLiter === 0 && desiredTotalChange !== 0) {
                         setHtml('nacorr-infusion-rate', `Infusion Rate: Cannot change Na⁺ with this fluid (Isotonic effect).`);
                    } else if (changePerLiter === 0 && desiredTotalChange === 0) {
                         setHtml('nacorr-infusion-rate', `Infusion Rate: No change needed.`);
                    } else {
                         setHtml('nacorr-infusion-rate', `Infusion Rate: Calculation Error.`);
                    }

                    showResultBox('nacorr-result');
                });
            }


            // --- NEW CALCULATORS (50-51) ---

            // 50. GRACE ACS Risk Score
            const calculateGraceBtn = document.getElementById('calculate-grace');
            if (calculateGraceBtn) {
                calculateGraceBtn.addEventListener('click', () => {
                    clearErrors(['grace-age-error', 'grace-hr-error', 'grace-sbp-error', 'grace-creat-error']);
                    hideResultBox('grace-result');
                    let score = 0;
                    let valid = true;

                    const age = getNumericValue('grace-age');
                    const hr = getNumericValue('grace-hr');
                    const sbp = getNumericValue('grace-sbp');
                    let creat = getNumericValue('grace-creat');
                    const creatUnit = getValue('grace-creat-unit');
                    const killip = parseInt(getValue('grace-killip') || '0');

                    if (!isValidNonNegativeNumber(age)) { displayError('grace-age-error', 'Valid Age.'); valid = false; }
                    if (!isValidPositiveNumber(hr)) { displayError('grace-hr-error', 'Valid Heart Rate.'); valid = false; }
                    if (!isValidPositiveNumber(sbp)) { displayError('grace-sbp-error', 'Valid SBP.'); valid = false; }
                    if (!isValidNonNegativeNumber(creat)) { displayError('grace-creat-error', 'Valid Creatinine.'); valid = false; }
                    if (!valid) return;

                    // Convert Creatinine to mg/dL if needed
                    let creatMgDl = (creatUnit === 'μmol/L') ? creat / 88.4 : creat;

                    // Age points (simplified ranges from original nomogram)
                    if (age >= 90) score += 91; else if (age >= 80) score += 75; else if (age >= 70) score += 58;
                    else if (age >= 60) score += 41; else if (age >= 50) score += 25; else if (age >= 40) score += 8;
                    // else score += 0; // < 40

                    // Heart Rate points
                    if (hr >= 200) score += 46; else if (hr >= 150) score += 38; else if (hr >= 110) score += 24;
                    else if (hr >= 90) score += 15; else if (hr >= 70) score += 7;
                    // else score += 0; // < 70

                    // SBP points
                    if (sbp < 80) score += 58; else if (sbp < 100) score += 43; else if (sbp < 120) score += 34;
                    else if (sbp < 140) score += 24; else if (sbp < 160) score += 10;
                    // else score += 0; // >= 160

                    // Creatinine points
                    if (creatMgDl >= 4.0) score += 28; else if (creatMgDl >= 2.0) score += 21; else if (creatMgDl >= 1.6) score += 13;
                    else if (creatMgDl >= 1.2) score += 10; else if (creatMgDl >= 0.8) score += 7; else if (creatMgDl >= 0.4) score += 4;
                    // else score += 1; // < 0.4

                    // Killip Class points
                    score += killip;

                    // Other factors
                    if (document.getElementById('grace-arrest')?.checked) score += 39;
                    if (document.getElementById('grace-st-deviation')?.checked) score += 28;
                    if (document.getElementById('grace-enzymes')?.checked) score += 14;

                    setHtml('grace-value', `${score}`);
                    setHtml('grace-interpretation', `GRACE Score`);

                    // Mortality estimates based on score ranges (approximate)
                    let inHospMortality = '', sixMonthMortality = '';
                    let levelClass = 'info', levelText = 'Risk';
                    if (score <= 108) { levelClass = 'normal'; levelText = 'Low Risk'; inHospMortality = '< 1%'; sixMonthMortality = '< 3%'; }
                    else if (score <= 140) { levelClass = 'warning'; levelText = 'Intermediate Risk'; inHospMortality = '1 - 3%'; sixMonthMortality = '3 - 8%'; }
                    else { levelClass = 'danger'; levelText = 'High Risk'; inHospMortality = '> 3%'; sixMonthMortality = '> 8%'; }

                    setHtml('grace-in-hospital-mortality', `In-Hospital Mortality: ${inHospMortality}`);
                    setHtml('grace-6-month-mortality', `6-Month Mortality: ${sixMonthMortality}`);
                    setInterpretation('grace-level', 'grace-in-hospital-interp', levelClass, levelText, ''); // Use level for risk category
                    setHtml('grace-6-month-interp', ''); // Clear this one

                    showResultBox('grace-result');
                });
            }

            // 51. APACHE II Score
            const calculateApacheBtn = document.getElementById('calculate-apache');
            if (calculateApacheBtn) {
                calculateApacheBtn.addEventListener('click', () => {
                    clearErrors(['apache-temp-error', 'apache-map-error', 'apache-hr-error', 'apache-rr-error', 'apache-aado2-error', 'apache-pao2-error', 'apache-ph-error', 'apache-sodium-error', 'apache-potassium-error', 'apache-creat-error', 'apache-hct-error', 'apache-wbc-error', 'apache-gcs-error', 'apache-age-error']);
                    hideResultBox('apache-result');
                    let apsScore = 0;
                    let agePoints = 0;
                    let chronicPoints = 0;
                    let valid = true;

                    function getApachePoints(value, ranges) {
                        for (const range of ranges) {
                            if ((range.low === -Infinity || value >= range.low) && (range.high === Infinity || value <= range.high)) {
                                return range.points;
                            }
                        }
                        return NaN; // Should not happen if ranges cover all possibilities
                    }

                    // Temperature
                    const temp = getNumericValue('apache-temp');
                    if (!isValidNumber(temp) || temp < 25 || temp > 45) { displayError('apache-temp-error', 'Valid Temp (25-45°C).'); valid = false; }
                    else apsScore += getApachePoints(temp, [{low:41, high:Infinity, points:4}, {low:39, high:40.9, points:3}, {low:38.5, high:38.9, points:1}, {low:36, high:38.4, points:0}, {low:34, high:35.9, points:1}, {low:32, high:33.9, points:2}, {low:30, high:31.9, points:3}, {low:-Infinity, high:29.9, points:4}]);

                    // MAP
                    const map = getNumericValue('apache-map');
                    if (!isValidPositiveNumber(map)) { displayError('apache-map-error', 'Valid MAP.'); valid = false; }
                    else apsScore += getApachePoints(map, [{low:160, high:Infinity, points:4}, {low:130, high:159, points:3}, {low:110, high:129, points:2}, {low:70, high:109, points:0}, {low:50, high:69, points:2}, {low:-Infinity, high:49, points:4}]);

                    // Heart Rate
                    const hr = getNumericValue('apache-hr');
                    if (!isValidPositiveNumber(hr)) { displayError('apache-hr-error', 'Valid HR.'); valid = false; }
                    else apsScore += getApachePoints(hr, [{low:180, high:Infinity, points:4}, {low:140, high:179, points:3}, {low:110, high:139, points:2}, {low:70, high:109, points:0}, {low:55, high:69, points:2}, {low:40, high:54, points:3}, {low:-Infinity, high:39, points:4}]);

                    // Respiratory Rate
                    const rr = getNumericValue('apache-rr');
                    if (!isValidNonNegativeNumber(rr)) { displayError('apache-rr-error', 'Valid RR.'); valid = false; }
                    else apsScore += getApachePoints(rr, [{low:50, high:Infinity, points:4}, {low:35, high:49, points:3}, {low:25, high:34, points:1}, {low:12, high:24, points:0}, {low:10, high:11, points:1}, {low:6, high:9, points:2}, {low:-Infinity, high:5, points:4}]);

                    // Oxygenation
                    const aado2 = getNumericValue('apache-aado2');
                    const pao2 = getNumericValue('apache-pao2');
                    if (!isNaN(aado2) && isValidNonNegativeNumber(aado2)) { // FiO2 >= 0.5
                        apsScore += getApachePoints(aado2, [{low:500, high:Infinity, points:4}, {low:350, high:499, points:3}, {low:200, high:349, points:2}, {low:-Infinity, high:199, points:0}]);
                    } else if (!isNaN(pao2) && isValidPositiveNumber(pao2)) { // FiO2 < 0.5
                        apsScore += getApachePoints(pao2, [{low:71, high:Infinity, points:0}, {low:61, high:70, points:1}, {low:55, high:60, points:3}, {low:-Infinity, high:54, points:4}]);
                    } else if (getValue('apache-aado2').trim() !== '' || getValue('apache-pao2').trim() !== '') {
                         displayError('apache-aado2-error', 'Valid A-aDO₂ or PaO₂.'); valid = false;
                    } else { displayError('apache-aado2-error', 'Need A-aDO₂ or PaO₂.'); valid = false; } // Need at least one

                    // pH
                    const ph = getNumericValue('apache-ph');
                    if (!isValidNumber(ph) || ph < 6.8 || ph > 7.8) { displayError('apache-ph-error', 'Valid pH.'); valid = false; }
                    else apsScore += getApachePoints(ph, [{low:7.7, high:Infinity, points:4}, {low:7.6, high:7.69, points:3}, {low:7.5, high:7.59, points:1}, {low:7.33, high:7.49, points:0}, {low:7.25, high:7.32, points:2}, {low:7.15, high:7.24, points:3}, {low:-Infinity, high:7.14, points:4}]);

                    // Sodium
                    const sodium = getNumericValue('apache-sodium');
                    if (!isValidPositiveNumber(sodium)) { displayError('apache-sodium-error', 'Valid Na⁺.'); valid = false; }
                    else apsScore += getApachePoints(sodium, [{low:180, high:Infinity, points:4}, {low:160, high:179, points:3}, {low:155, high:159, points:2}, {low:150, high:154, points:1}, {low:130, high:149, points:0}, {low:120, high:129, points:2}, {low:111, high:119, points:3}, {low:-Infinity, high:110, points:4}]);

                    // Potassium
                    const potassium = getNumericValue('apache-potassium');
                    if (!isValidPositiveNumber(potassium)) { displayError('apache-potassium-error', 'Valid K⁺.'); valid = false; }
                    else apsScore += getApachePoints(potassium, [{low:7, high:Infinity, points:4}, {low:6, high:6.9, points:3}, {low:5.5, high:5.9, points:1}, {low:3.5, high:5.4, points:0}, {low:3.0, high:3.4, points:1}, {low:2.5, high:2.9, points:2}, {low:-Infinity, high:2.4, points:4}]);

                    // Creatinine
                    let creat = getNumericValue('apache-creat');
                    const arf = document.getElementById('apache-arf')?.checked;
                    if (!isValidNonNegativeNumber(creat)) { displayError('apache-creat-error', 'Valid Creatinine.'); valid = false; }
                    else {
                        let creatPoints = getApachePoints(creat, [{low:3.5, high:Infinity, points:4}, {low:2.0, high:3.4, points:3}, {low:1.5, high:1.9, points:2}, {low:0.6, high:1.4, points:0}, {low:-Infinity, high:0.5, points:2}]);
                        if (arf) creatPoints *= 2;
                        apsScore += creatPoints;
                    }

                    // Hematocrit
                    const hct = getNumericValue('apache-hct');
                    if (!isValidPositiveNumber(hct) || hct > 100) { displayError('apache-hct-error', 'Valid Hct (%).'); valid = false; }
                    else apsScore += getApachePoints(hct, [{low:60, high:Infinity, points:4}, {low:50, high:59.9, points:2}, {low:46, high:49.9, points:1}, {low:30, high:45.9, points:0}, {low:20, high:29.9, points:2}, {low:-Infinity, high:19.9, points:4}]);

                    // WBC
                    const wbc = getNumericValue('apache-wbc');
                    if (!isValidNonNegativeNumber(wbc)) { displayError('apache-wbc-error', 'Valid WBC (K/µL).'); valid = false; }
                    else apsScore += getApachePoints(wbc, [{low:40, high:Infinity, points:4}, {low:20, high:39.9, points:2}, {low:15, high:19.9, points:1}, {low:3, high:14.9, points:0}, {low:1, high:2.9, points:2}, {low:-Infinity, high:0.9, points:4}]);

                    // GCS
                    const gcs = getNumericValue('apache-gcs');
                    if (!isValidNumber(gcs) || gcs < 3 || gcs > 15) { displayError('apache-gcs-error', 'Valid GCS (3-15).'); valid = false; }
                    else apsScore += (15 - gcs);

                    // Age Points
                    const age = getNumericValue('apache-age');
                    if (!isValidNonNegativeNumber(age)) { displayError('apache-age-error', 'Valid Age.'); valid = false; }
                    else agePoints = getApachePoints(age, [{low:75, high:Infinity, points:6}, {low:65, high:74, points:5}, {low:55, high:64, points:3}, {low:45, high:54, points:2}, {low:-Infinity, high:44, points:0}]);

                    // Chronic Health Points
                    chronicPoints = parseInt(getValue('apache-chronic') || '0');

                    if (valid) {
                        const totalScore = apsScore + agePoints + chronicPoints;
                        setHtml('apache-value', `${totalScore}`);
                        setHtml('apache-interpretation', `APACHE II Score (APS: ${apsScore}, Age: ${agePoints}, Chronic: ${chronicPoints})`);

                        // Approximate Mortality - based on original paper, varies significantly by diagnosis
                        let mortality = NaN;
                        if (totalScore <= 4) mortality = 4; else if (totalScore <= 9) mortality = 8;
                        else if (totalScore <= 14) mortality = 15; else if (totalScore <= 19) mortality = 25;
                        else if (totalScore <= 24) mortality = 40; else if (totalScore <= 29) mortality = 55;
                        else if (totalScore <= 34) mortality = 73; else mortality = 85;

                        setHtml('apache-mortality', `Approx. Mortality: ~${mortality}%`);
                        setHtml('apache-mortality-interp', '(Based on general ICU population, varies by diagnosis)');

                        showResultBox('apache-result');
                    } else {
                         setHtml('apache-value', 'Input Error');
                         setHtml('apache-interpretation', 'Check input fields.');
                         showResultBox('apache-result');
                    }
                });
            }


            // --- Existing Calculators moved down ---

             // 19. Alvarado Score (Previously 17)
             const calculateAlvaradoBtn = document.getElementById('calculate-alvarado'); if (calculateAlvaradoBtn) { calculateAlvaradoBtn.addEventListener('click', () => { hideResultBox('alvarado-result'); let score = 0; const checkboxes = ['alv-migratory', 'alv-anorexia', 'alv-nausea', 'alv-rlq-tender', 'alv-rebound', 'alv-fever', 'alv-leukocytosis', 'alv-left-shift']; checkboxes.forEach(id => { const cb = document.getElementById(id); if (cb?.checked) score += parseFloat(cb.value); }); setHtml('alvarado-value', `Score: ${score}`); let lvlClass = 'info', lvlText = 'Appendicitis Likelihood', interp = ''; if (score <= 4) { lvlClass = 'normal'; lvlText = 'Low'; interp = 'Score ≤ 4: Appendicitis unlikely. Consider alternative dx.'; } else if (score <= 6) { lvlClass = 'warning'; lvlText = 'Equivocal'; interp = 'Score 5-6: Possible appendicitis. Consider observation or imaging.'; } else { lvlClass = 'danger'; lvlText = 'High'; interp = 'Score ≥ 7: Probable appendicitis. Surgical consult +/- imaging typically indicated.'; } setInterpretation('alvarado-level', 'alvarado-interpretation', lvlClass, lvlText, interp); showResultBox('alvarado-result'); }); }
             // 20. Light's Criteria (Previously 18)
             const calculateLightBtn = document.getElementById('calculate-light'); if (calculateLightBtn) { calculateLightBtn.addEventListener('click', () => { clearErrors(['light-pf-prot-error', 'light-serum-prot-error', 'light-pf-ldh-error', 'light-serum-ldh-error', 'light-serum-ldh-uln-error']); hideResultBox('light-result'); const pfProt = getNumericValue('light-pf-prot'); const serumProt = getNumericValue('light-serum-prot'); const pfLdh = getNumericValue('light-pf-ldh'); const serumLdh = getNumericValue('light-serum-ldh'); const serumLdhUln = getNumericValue('light-serum-ldh-uln'); let valid = true; if (!isValidNonNegativeNumber(pfProt)) { displayError('light-pf-prot-error', 'Valid PF Protein.'); valid = false; } if (!isValidPositiveNumber(serumProt)) { displayError('light-serum-prot-error', 'Valid Serum Protein.'); valid = false; } if (!isValidNonNegativeNumber(pfLdh)) { displayError('light-pf-ldh-error', 'Valid PF LDH.'); valid = false; } if (!isValidPositiveNumber(serumLdh)) { displayError('light-serum-ldh-error', 'Valid Serum LDH.'); valid = false; } if (!isValidPositiveNumber(serumLdhUln)) { displayError('light-serum-ldh-uln-error', 'Valid Serum LDH ULN.'); valid = false; } if (!valid) return; const protRatio = serumProt > 0 ? pfProt / serumProt : NaN; const ldhRatio = serumLdh > 0 ? pfLdh / serumLdh : NaN; const ldhUlnRatio = serumLdhUln > 0 ? pfLdh / (serumLdhUln * (2/3)) : NaN; // Ratio to 2/3 ULN
                     const meetsProtRatio = !isNaN(protRatio) && protRatio > 0.5;
                     const meetsLdhRatio = !isNaN(ldhRatio) && ldhRatio > 0.6;
                     const meetsLdhUlnRatio = !isNaN(ldhUlnRatio) && ldhUlnRatio > 1; // Check if PF LDH > (2/3 * ULN)
                     const isExudate = meetsProtRatio || meetsLdhRatio || meetsLdhUlnRatio;
                     setHtml('light-criteria-met', isExudate ? 'Exudate' : 'Transudate');
                     setHtml('light-ratio-prot', `PF/Serum Protein Ratio: ${isNaN(protRatio) ? 'N/A' : protRatio.toFixed(2)} ${meetsProtRatio ? '<b style="color:var(--danger);">(>0.5 Met)</b>' : '(≤0.5)'}`);
                     setHtml('light-ratio-ldh', `PF/Serum LDH Ratio: ${isNaN(ldhRatio) ? 'N/A' : ldhRatio.toFixed(2)} ${meetsLdhRatio ? '<b style="color:var(--danger);">(>0.6 Met)</b>' : '(≤0.6)'}`);
                     setHtml('light-ratio-ldh-uln', `PF LDH / (2/3 ULN) Ratio: ${isNaN(ldhUlnRatio) ? 'N/A' : ldhUlnRatio.toFixed(2)} ${meetsLdhUlnRatio ? '<b style="color:var(--danger);">(>1 Met)</b>' : '(≤1)'}`);
                     setInterpretation('light-level', 'light-interpretation', isExudate ? 'warning' : 'normal', isExudate ? 'Exudative' : 'Transudative', isExudate ? 'At least one criterion met.' : 'No criteria met.'); showResultBox('light-result'); }); }


        }); // End DOMContentLoaded
    </script>

</body>
</html>
